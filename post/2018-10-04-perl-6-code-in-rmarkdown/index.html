<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="ohmysummer">
    <meta name="description" content="ohmysummer&#39;s personal website">
    <meta name="keywords" content="Perl6,Rakudo">

    <base href="http://ohmysummer.github.io/">
    <title>
  Rmarkdown 中的 Perl 6 代码 · 焉知非鱼
</title>

    <link rel="canonical" href="http://ohmysummer.github.io/post/2018-10-04-perl-6-code-in-rmarkdown/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.cd087ace86754b082dec94545567f8361cba42e84f8e15edbc4a9f6e52bd1f6a.css" integrity="sha256-zQh6zoZ1Swgt7JRUVWf4Nhy6QuhPjhXtvEqfblK9H2o=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://ohmysummer.github.io/css/style.css">
    

    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://ohmysummer.github.io/">
      焉知非鱼
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/post">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/page/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags">标签</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Rmarkdown 中的 Perl 6 代码</h1>
    </header>

    

<h1 id="安装">安装</h1>

<p>首先，首先安装 <code>R</code> 编程语言。在此之后，运行 <code>R</code> 并执行以下命令来安装 <code>rmarkdown</code>: <code>install.packages(&quot;rmarkdown&quot;)</code>。在安装 rmarkdown 时，我收到以下错误消息:</p>

<pre><code>Error: .onLoad failed in loadNamespace() for 'tcltk', details:
  call: dyn.load(file, DLLpath = DLLpath, ...)
  error: unable to load shared object '/usr/lib/R/library/tcltk/libs/tcltk.so':
  libtk8.6.so: cannot open shared object file: No such file or directory
</code></pre>

<p>这可以通过安装包 <code>tk</code> 来解决，然后继续安装 rmarkdown。</p>

<h1 id="rmarkdown-的代码块">Rmarkdown 的代码块</h1>

<p>你可以用 rmarkdown 做的几乎所有都可以用“常规” markdown 来做的事情。然而，rmarkdown 的一个突出特性是它能够执行代码块并返回结果。为此，rmarkdown 使用了 <a href="https://yihui.name/knitr/">knitr</a> 包，这是一个使用 R 生成动态报告的引擎，除了 R 之外，它还支持其他语言引擎，您可以使用这些引擎来计算来自其他语言的代码。要列出可用引擎的名称，请在 R REPL 中执行 <code>names(knitr::knit_engines$get())</code> 命令。就像“常规” markdown 一样，代码块可以用三个反勾号创建，然后是代码，最后是另外三个反勾号。如果希望计算代码块，请在花括号 <code>{}</code> 中指定语言，该语言位于前三个反勾号之后。例如，要执行 Perl 5 代码，可以在 <code>{}</code> 中指定 <code>perl</code>:</p>

<pre><code>```{perl}
sub factorial {
    my ($n) = @_;
    return 1 if $n == 0;
    return factorial($n - 1) * $n;
}

for (1..4) {
    print &quot;Factorial of $_: &quot;, factorial($_), &quot;\n&quot;;
} 
```
</code></pre>

<p>如果任何表达式求值了，将按照如下方式处理，结果将显示在源代码下面:</p>

<pre><code>sub factorial {
    my ($n) = @_;
    return 1 if $n == 0;
    return factorial($n - 1) * $n;
}

for (1..4) {
    print &quot;Factorial of $_: &quot;, factorial($_), &quot;\n&quot;;
} 
## Factorial of 1: 1
## Factorial of 2: 2
## Factorial of 3: 6
## Factorial of 4: 24
</code></pre>

<p>代码块的选项可以在花括号中指定。例如，为了防止对代码块的计算，您必须将 <code>eval</code> 设置为 <code>FALSE</code>:</p>

<pre><code>```{perl, eval=FALSE}
my $name = 'Nemy';
print &quot;Hello, $name!\n&quot;;
```
</code></pre>

<p>这阻止了代码块的求值，只显示源代码:</p>

<pre><code>my $name = 'Nemy';
print &quot;Hello, $name!\n&quot;;
</code></pre>

<p>要隐藏源代码并且仍然显示它的求值，可以将 <code>echo</code> 设置为 <code>FALSE</code>:</p>

<pre><code>```{perl, echo=FALSE}
my $name = 'Nemy';
print &quot;Hello, $name!\n&quot;;
```
</code></pre>

<p>只有结果被展示出来：</p>

<pre><code>## Hello, Nemy!
</code></pre>

<p>在花括号中可以指定一些选项。下面是我常用的一些选项的小列表:</p>

<ul>
<li><strong>engine</strong>-默认为<code>R</code>。<code>knitr</code> 将用命名语言计算这个块，例如 <code>engine = 'python'</code>。</li>
<li><strong>eval</strong>-默认情况下为 <code>TRUE</code>。如果为 <code>FALSE</code>, knitr 将不会在代码块中运行代码。</li>
<li><strong>echo</strong>-默认情况下为 <code>TRUE</code>。如果为 <code>FALSE</code>, knitr 将不会在最终文档中显示其结果上面的代码块中的代码。</li>
<li><strong>collapse</strong>-默认为 <code>FALSE</code>。如果为 <code>TRUE</code>，knitr 将把该块创建的所有源代码块和输出块折叠成单个块。</li>
<li><strong>comment</strong>-默认情况下是 <code>##</code>。knitr 将在最终文档的每行结果的开头添加的一个字符串，例如 <code>comment = '#=&gt;'</code>。</li>
</ul>

<p>在这里可以找到关于<a href="https://yihui.name/knitr/options/">不同选项</a>的更多信息。</p>

<h1 id="rmarkdown-中的-perl-6">Rmarkdown 中的 Perl 6</h1>

<p>到目前为止，knitr 不支持 Perl 6 的语言引擎。但是，您可以使用 knitr 的引擎语言可扩展性来执行 rmarkdown 中的 Perl 6 代码块，方法是在您的文件中添加以下 R 代码块:</p>

<pre><code>```{r setup}
library(knitr)
eng_perl6 &lt;- function(options) {
  # create a temporary file
  f &lt;- basename(tempfile(&quot;perl6&quot;, '.', paste('.', &quot;perl6&quot;, sep = '')))
  on.exit(unlink(f)) # cleanup temp file on function exit
  writeLines(options$code, f)
  out &lt;- ''

  # if eval != FALSE compile/run the code, preserving output
  if (options$eval) {
    out &lt;- system(sprintf('perl6 %s', paste(f, options$engine.opts)), intern=TRUE)
  }

  # spit back stuff to the user
  engine_output(options, options$code, out)
}

knitr::knit_engines$set(perl6=eng_perl6)
```
</code></pre>

<p>这个变通方法是从<a href="https://stackoverflow.com/questions/45857934/executing-perl-6-code-in-rmarkdown/45864801#45864801">这里</a>和<a href="https://www.r-bloggers.com/running-go-language-chunks-in-r-markdown-rmd-files/">这里</a> 得到的。</p>

<p>这将允许你这样做:</p>

<pre><code>```{r, engine='perl6'}
say [*] 1..5;
```
</code></pre>

<p>但是，您可以使用 Perl 5 的引擎语言并通过将 <code>engine.path</code> 设置为 <code>perl6</code> 使其路径更改为 Perl 6 可执行文件的路径，而不是在每个正在处理 Perl 6 代码的文件中添加这段 R 代码。然后，您可以通过如下方式处理 Perl 6 代码:</p>

<pre><code>```{perl, engine.path='perl6'}
say [*] 1..5;
```
</code></pre>

<p>现在您应该能够计算 Perl 6 代码块:</p>

<pre><code>```{perl, engine.path='perl6', comment='#=&gt;', collapse=TRUE}
class Point {
    has $.x = 0;
    has $.y = 0;
    method distance-to-center() {
        return sqrt($!x**2 + $!y**2);
    }
}

my $p = Point.new(x =&gt; 3, y =&gt; 4);
say $p.distance-to-center();
```
</code></pre>

<p>会被处理成如下这样：</p>

<pre><code>class Point {
    has $.x = 0;
    has $.y = 0;
    method distance-to-center() {
        return sqrt($!x**2 + $!y**2);
    }
}

my $p = Point.new(x =&gt; 3, y =&gt; 4);
say $p.distance-to-center();

#=&gt; 5
</code></pre>

<h1 id="补遗">补遗</h1>

<p>这篇文章是受我的启发，我希望有一个简单的设置，转录课堂笔记使用 <code>vim</code>。注释可能闪烁着 <code>LATEX</code>，一些代码片段，并转换为 <code>.pdf</code> 文件，以便在此过程中进行审阅。rmarkdown 的易用性和广泛的功能使其成为这项工作的合适工具。</p>

<p>要从 vim 直接将 <code>.rmd</code> 转换为 <code>.pdf</code> 文件，我的 <code>.vimrc</code> 中有以下一行映射到 F5，以简化过程:</p>

<pre><code>autocmd Filetype rmd map &lt;F5&gt; :!echo&lt;space&gt;&quot;require(rmarkdown);
&lt;space&gt;render('&lt;c-r&gt;%')&quot;&lt;space&gt;\|&lt;space&gt;R&lt;space&gt;--vanilla&lt;enter&gt;
</code></pre>

<p>如您所见，这只是在 R 中加载 rmarkdown 包，将当前 .rmd 文件传递给函数 <code>render</code>，并将其结果传递给 <code>R --vanilla</code> 以使程序非交互式。</p>

<p>注意，您可能需要安装 <code>pandoc</code> 才能正常工作。对于 pandoc latex 模板，我使用了 <a href="https://github.com/Wandmalfarbe/pandoc-latex-template">eisvogel.latex</a> 的一个稍微改进版本。</p>

<p>以下是所有注释的 YAML 前言(元数据)的示例:</p>

<pre><code>---
title: &quot;Perl 6 in rmarkdown&quot;
author: &quot;Luis F. Uceta&quot;
date: Aug 13, 2018

output: 
    pdf_document:
        latex_engine: pdflatex
        toc: true
        template: eisvogel.latex

fontsize: 12pt
geometry: margin=1in 
linkcolor: red
urlcolor: blue
---
</code></pre>

<p>这是这个文件的 <code>pdf</code>，使用了之前的 <code>YAML</code> 前言和前面提到的 latex 模板。请注意，此 pdf 可能不反映对本文所做的最新更改。</p>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>ohmysummer ❤ Perl 6</p>
    
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
