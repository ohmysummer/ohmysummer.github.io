<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="ohmysummer">
    <meta name="description" content="ohmysummer&#39;s personal website">
    <meta name="keywords" content="Perl6,Rakudo">

    <base href="http://ohmysummer.github.io/">
    <title>
  DateTime · 焉知非鱼
</title>

    <link rel="canonical" href="http://ohmysummer.github.io/post/2018-05-05-datetime/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.cd087ace86754b082dec94545567f8361cba42e84f8e15edbc4a9f6e52bd1f6a.css" integrity="sha256-zQh6zoZ1Swgt7JRUVWf4Nhy6QuhPjhXtvEqfblK9H2o=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://ohmysummer.github.io/css/style.css">
    

    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://ohmysummer.github.io/">
      焉知非鱼
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/post">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/page/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags">标签</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>DateTime</h1>
    </header>

    

<h1 id="datetime-https-docs-perl6-org-type-datetime"><a href="https://docs.perl6.org/type/DateTime">DateTime</a></h1>

<pre><code class="language-perl6">class DateTime does Dateish {}
</code></pre>

<p>对于在国内处理点数，<code>DateTime</code> 对象存储年，月，日，小时，分钟（全部为 <a href="https://docs.perl6.org/type/Int">Int</a>），秒（可能为小数）和时区。</p>

<p>它提供了用日期和时间计算的方法。</p>

<p><code>DateTime</code> 方法是不可变的;如果你试图修改它，请改为创建修改后的副本。</p>

<p>时区的处理时间为以 UTC 为单位的<a href="https://docs.perl6.org/type/Int">整数</a>，而不是时区名称。</p>

<pre><code class="language-perl6">use v6.c;
my $dt = DateTime.new(
    year    =&gt; 2015,
    month   =&gt; 11,
    day     =&gt; 21,
    hour    =&gt; 16,
    minute  =&gt; 1,
);

say $dt;                            # OUTPUT: «2015-11-21T16:01:00Z␤»
say $dt.later(days =&gt; 20);          # OUTPUT: «2015-12-11T16:01:00Z␤»
say $dt.truncated-to('hour');       # OUTPUT: «2015-11-21T16:00:00Z␤»
say $dt.in-timezone(-8 * 3600);     # OUTPUT: «2015-11-21T08:01:00-0800␤»

my $now = DateTime.now(formatter =&gt; { sprintf &quot;%02d:%02d&quot;, .hour, .minute });
say $now;
</code></pre>

<h2 id="方法">方法</h2>

<h3 id="new-方法">new 方法</h3>

<p>定义为:</p>

<pre><code class="language-perl6">multi method new(Int :$year!, Int :$month = 1, Int :$day = 1,
                 Int :$hour = 0, Int :$minute = 0, :$second = 0,
                 Int :$timezone = 0, :&amp;formatter)
multi method new(Date :$date!,
                 Int :$hour = 0, Int :$minute = 0, :$second = 0,
                 Int :$timezone = 0, :&amp;formatter)
multi method new(Int() $year, Int() $month, Int() $day,
                 Int() $hour, Int $minute, $second,
                 Int() :$timezone = 0, :&amp;formatter)
multi method new(Instant:D $i,  :$timezone=0, :&amp;formatter)
multi method new(Int:D $posix,  :$timezone=0, :&amp;formatter)
multi method new(Str:D $format, :$timezone=0, :&amp;formatter)
</code></pre>

<p>创建一个新的 <code>DateTime</code> 对象。另外一个​​选项是分别从组件（年，月，日，小时&hellip;）创建新的 <code>DateTime</code> 对象。另一种方法是为 date 组件传递一个 <a href="https://docs.perl6.org/type/Date">Date</a> 对象，并以 component-wise 方式指定时间。另一种方法是从 <a href="https://docs.perl6.org/type/Instant">Instant</a> 获取时间，并仅提供时区和 formatter。或者，您可以提供 <a href="https://docs.perl6.org/type/Int">Int</a> 作为 UNIX 时间戳，而不是 Instant。</p>

<p>您还可以提供格式为 ISO 8601 时间戳记符号或完整 <a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a> 日期和时间的 <a href="https://docs.perl6.org/type/Str">Str</a>。字符串格式应为 <code>yyyy-mm-ddThh:mm:ssZ</code> 或 <code>yyyy-mm-ddThh:mm:ss+0100</code>。由于我们允许使用 Unicode 数字和混合浓缩和扩展时间格式，因此我们的限制性比 ISO 8601 标准少一些。</p>

<p>无效的输入字符串将引发 <a href="https://docs.perl6.org/type/X::Temporal::InvalidFormat">X::Temporal::InvalidFormat</a> 类型的异常。如果您提供的字符串包含时区并提供 <code>timezone</code> 具名参数，则会引发 <a href="https://docs.perl6.org/type/X::Temporal::InvalidFormat">X::DateTime::TimezoneClash</a> 类型的异常。</p>

<pre><code class="language-perl6">my $datetime = DateTime.new(year =&gt; 2015,
                            month =&gt; 1,
                            day =&gt; 1,
                            hour =&gt; 1,
                            minute =&gt; 1,
                            second =&gt; 1,
                            timezone =&gt; 1);
$datetime = DateTime.new(date =&gt; Date.new('2015-12-24'),
                         hour =&gt; 1,
                         minute =&gt; 1,
                         second =&gt; 1,
                         timezone =&gt; 1);
$datetime = DateTime.new(2015, 1, 1, # First January of 2015
                         1, 1, 1);   # Hour, minute, second with default timezone
$datetime = DateTime.new(now);                       # Instant.
# from a Unix timestamp
say $datetime = DateTime.new(1470853583);            # OUTPUT: «2016-08-10T18:26:23Z␤»
$datetime = DateTime.new(&quot;2015-01-01T03:17:30+0500&quot;) # Formatted string
</code></pre>

<h3 id="now-方法">now 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method now(:$timezone = $*TZ, :&amp;formatter --&gt; DateTime:D)
</code></pre>

<p>从当前系统时间创建一个新的 <code>DateTime</code> 对象。可以提供自定义 <a href="https://docs.perl6.org/routine/formatter">formatter</a> 和 <a href="https://docs.perl6.org/routine/timezone">timezone</a>。 <code>:$timezone</code> 是 GMT 的偏移量（<strong>以秒为单位</strong>），默认为 <a href="https://docs.perl6.org/language/variables#index-entry-%2524%2ATZ">$*TZ</a> 变量的值。</p>

<pre><code class="language-perl6">say DateTime.now; # OUTPUT: «2018-01-08T13:05:32.703292-06:00␤»
</code></pre>

<p>请注意，可以使用链接到 <code>.now</code> 的以下方法轻松表示当前值，例如，</p>

<pre><code class="language-perl6">say DateTime.now.year; # OUTPUT: «2018␤»
</code></pre>

<h3 id="clone-方法">clone 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method clone(:$year, :$month, :$day, :$hour, :$minute, :$second, :$timezone, :&amp;formatter)
</code></pre>

<p>根据 invocant 创建一个新的 <code>DateTime</code> 对象，但给定的参数会覆盖 invocant 中的值。</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00Z').clone(hour =&gt; 0);
# OUTPUT: «2015-12-24T00:23:00Z␤»
</code></pre>

<p>请注意，在某些情况下，这可能会导致日期无效：</p>

<pre><code class="language-perl6">say DateTime.new(&quot;2012-02-29T12:34:56Z&quot;).clone(year =&gt; 2015);
CATCH { default { put .^name, ': ', .Str } };
# OUTPUT: «X::OutOfRange: Day out of range. Is: 29, should be in 1..28␤»
</code></pre>

<h3 id="hh-mm-ss-方法">hh-mm-ss 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method hh-mm-ss(DateTime:D: --&gt; Str:D)
</code></pre>

<p>以 24 小时 HH:MM:SS 格式返回对象以字符串形式表示的时间：</p>

<pre><code class="language-perl6">say DateTime.new(&quot;2052-02-29T22:34:56Z&quot;).hh-mm-ss;
# OUTPUT: «22:34:56␤»
</code></pre>

<h3 id="hour-方法">hour 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method hour(DateTime:D: --&gt; Int:D)
</code></pre>

<p>返回小时组件。</p>

<pre><code class="language-perl6">say DateTime.new('2012-02-29T12:34:56Z').hour;      # OUTPUT: «12␤»
</code></pre>

<h3 id="minute-方法">minute 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method minute(DateTime:D: --&gt; Int:D)
</code></pre>

<p>返回分钟组件。</p>

<pre><code class="language-perl6">say DateTime.new('2012-02-29T12:34:56Z').minute;     # OUTPUT: «34␤»
</code></pre>

<h3 id="second-方法">second 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method second(DateTime:D:)
</code></pre>

<p>返回秒组件，可能包括小数秒。</p>

<pre><code class="language-perl6">say DateTime.new('2012-02-29T12:34:56Z').second;     # OUTPUT: «56␤»
say DateTime.new('2012-02-29T12:34:56.789Z').second; # OUTPUT: «56.789␤»
say DateTime.new('2012-02-29T12:34:56,789Z').second; # comma also ok
</code></pre>

<h3 id="whole-second">whole-second</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method whole-second(DateTime:D:)
</code></pre>

<p>返回秒组件，向下舍入为 <a href="https://docs.perl6.org/type/Int">Int</a>。</p>

<pre><code class="language-perl6">say DateTime.new('2012-02-29T12:34:56.789Z').whole-second;      # OUTPUT: «56␤»
</code></pre>

<h3 id="timezone-方法">timezone 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method timezone(DateTime:D: --&gt; Int:D)
</code></pre>

<p><strong>以秒为单位</strong> 返回时区，作为与 UTC 的偏移量。</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00+0200').timezone;          # OUTPUT: «7200␤»
</code></pre>

<h3 id="offset-方法">offset 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method offset(DateTime:D: --&gt; Int:D)
</code></pre>

<p><strong>以秒为单位</strong> 返回时区，作为与UTC的偏移量。这是<a href="https://docs.perl6.org/type/DateTime#method_timezone">方法时区</a>的别名。</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00+0200').offset;            # OUTPUT: «7200␤»
</code></pre>

<h3 id="offset-in-minutes-方法">offset-in-minutes 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method offset-in-minutes(DateTime:D: --&gt; Real:D)
</code></pre>

<p>以 UTC 为单位返回以小时为单位的时区。</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00+0200').offset-in-hours;   # OUTPUT: «2␤»
</code></pre>

<h3 id="str-方法">Str 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method Str(DateTime:D: --&gt; Str:D)
</code></pre>

<p>返回调用者的字符串表示形式，由格式化程序完成。如果未指定格式化程序，则会返回ISO 8601时间戳。</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00+0200').Str; # OUTPUT: «2015-12-24T12:23:00+02:00␤»
</code></pre>

<h3 id="instant-方法">Instant 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method Instant(DateTime:D: --&gt; Instant:D)
</code></pre>

<p>基于调用者返回一个Instant对象。</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00+0200').Instant; # OUTPUT: «2015-12-24T12:23:00+02:00␤»
</code></pre>

<h3 id="posix-方法">posix 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method posix(DateTime:D: $ignore-timezone = False --&gt; Int:D)
</code></pre>

<p>将日期和时间作为POSIX / UNIX时间戳（自Epoch，1970年1月1日UTC以来的秒数）返回。</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00Z').posix;       # OUTPUT: «1450959780␤»
</code></pre>

<h3 id="later-方法">later 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method later(DateTime:D: *%unit)
</code></pre>

<p>返回基于当前日期对象的DateTime对象，但应用了时间增量。时间增量可以作为参数名称为单位的命名参数传递。</p>

<p>除非给定的单位是秒或秒，否则给定的值将被转换为Int。</p>

<p>允许的单位是秒，秒，分，分，小时，小时，日，星期，星期，月，月，年，年。请注意，复数形式只能用于较晚和较早的方法。</p>

<p>第二种形式的结构可以用作指定三角洲的紧凑和自我记录方式：</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00Z').later(:2years); # OUTPUT: «2017-12-24T12:23:00Z␤»
</code></pre>

<p>由于添加几个不同的时间单位不可交换，所以只能传递一个单位。</p>

<pre><code class="language-perl6">my $d = DateTime.new(date =&gt; Date.new('2015-02-27'));
say $d.later(month =&gt; 1).later(:2days);  # OUTPUT: «2015-03-29T00:00:00Z␤»
say $d.later(days =&gt; 2).later(:1month);  # OUTPUT: «2015-04-01T00:00:00Z␤»
say $d.later(days =&gt; 2).later(:month);   # same, as +True === 1
</code></pre>

<p>如果结果时间的值为60秒，但实际上当前没有闰秒，则秒数将设置为59：</p>

<pre><code class="language-perl6">say DateTime.new('2008-12-31T23:59:60Z').later: :1day;
# OUTPUT: «2009-01-01T23:59:59Z␤»
</code></pre>

<p>负偏移是允许的，虽然早些时候更习惯于此。</p>

<h3 id="earlier-方法">earlier 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method earlier(DateTime:D: *%unit)
</code></pre>

<p>返回基于当前日期对象的日期时间对象，但是应用了过去的时间差值。除非给定的单位是秒或秒，否则给定的值将被转换为Int。请参阅后面的使用方法。</p>

<pre><code class="language-perl6">my $d = DateTime.new(date =&gt; Date.new('2015-02-27'));
say $d.earlier(month =&gt; 1).earlier(:2days);  # OUTPUT: «2015-01-25T00:00:00Z␤»
</code></pre>

<p>如果结果时间的值为60秒，但实际上当前没有闰秒，则秒数将设置为59：</p>

<pre><code class="language-perl6">say DateTime.new('2008-12-31T23:59:60Z').earlier: :1day;
# OUTPUT: «2008-12-30T23:59:59Z␤»
</code></pre>

<p>负偏移是允许的，尽管后来更加习惯于此。</p>

<h3 id="truncated-to-方法">truncated-to 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method truncated-to(DateTime:D: Cool $unit)
</code></pre>

<p>返回调用者的副本，将小于指定单位的所有内容截断为尽可能最小的值。</p>

<pre><code class="language-perl6">my $d = DateTime.new(&quot;2012-02-29T12:34:56.946314Z&quot;);
say $d.truncated-to('second');      # OUTPUT: «2012-02-29T12:34:56Z␤»
say $d.truncated-to('minute');      # OUTPUT: «2012-02-29T12:34:00Z␤»
say $d.truncated-to('hour');        # OUTPUT: «2012-02-29T12:00:00Z␤»
say $d.truncated-to('day');         # OUTPUT: «2012-02-29T00:00:00Z␤»
say $d.truncated-to('month');       # OUTPUT: «2012-02-01T00:00:00Z␤»
say $d.truncated-to('year');        # OUTPUT: «2012-01-01T00:00:00Z␤»
</code></pre>

<p>使用.truncated-to（&rsquo;second&rsquo;）可以将小数秒的日期时间截断为整秒。</p>

<h3 id="date-方法">Date 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">multi method Date(DateTime:U --&gt; Date:U)
multi method Date(DateTime:D --&gt; Date:D)
</code></pre>

<p>将调用者转换为 <a href="https://docs.perl6.org/type/Date">Date</a></p>

<pre><code class="language-perl6">say DateTime.new(&quot;2012-02-29T12:34:56.946314Z&quot;).Date; # OUTPUT: «2012-02-29␤»
say DateTime.Date;                                    # OUTPUT: «(Date)␤»
</code></pre>

<h3 id="datetime-方法">DateTime 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method DateTime(--&gt; DateTime)
</code></pre>

<p>返回调用者。</p>

<pre><code class="language-perl6">say DateTime.new(&quot;2012-02-29T12:34:56.946314Z&quot;).DateTime; # 2012-02-29T12:34:56.946314Z
say DateTime.DateTime;                                    # OUTPUT: «(DateTime)␤»
</code></pre>

<h3 id="utc-方法">utc 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method utc(DateTime:D: --&gt; DateTime:D)
</code></pre>

<p>同时返回一个 DateTime 对象，但是在 UTC 时区。</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00+0200').utc;  # OUTPUT: «2015-12-24T10:23:00Z␤»
</code></pre>

<h3 id="in-timezone-方法">in-timezone 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method in-timezone(DateTime:D: $timezone = 0 --&gt; DateTime:D)
</code></pre>

<p>同一时间返回一个DateTime对象，但在指定的$ timezone中，这是距离GMT的偏移量（以秒为单位）。</p>

<pre><code class="language-perl6">say DateTime.new('2015-12-24T12:23:00Z').in-timezone(3600 + 1800); # OUTPUT: «2015-12-24T13:53:00+0130␤»
</code></pre>

<h3 id="local-方法">local 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method local(DateTime:D: --&gt; DateTime:D)
</code></pre>

<p>同时返回DateTime对象，但在本地时区（$ * TZ）中。</p>

<pre><code class="language-perl6">my $*TZ = -3600;
say DateTime.new('2015-12-24T12:23:00+0200').local; # OUTPUT: «2015-12-24T09:23:00-0100␤»
</code></pre>

<h3 id="infix">infix:&lt;-&gt;</h3>

<p>定义为：</p>

<pre><code class="language-perl6">multi sub infix:&lt;-&gt; (DateTime:D, Duration:D --&gt; DateTime:D)
multi sub infix:&lt;-&gt; (DateTime:D, DateTime:D --&gt; Duration:D)
</code></pre>

<p>将DateTime从持续时间或另一个DateTime对象中减去。分别返回一个新的DateTime对象或两个日期之间的持续时间。当减去持续时间时，原始DateTime的时区保留在返回的DateTime对象中。</p>

<pre><code class="language-perl6">say perl DateTime.new(:2016year) - DateTime.new(:2015year):;           # OUTPUT: «Duration.new(31536001.0)␤»
say DateTime.new(:2016year, :3600timezone) - Duration.new(31536001.0); # OUTPUT: «2015-01-01T00:00:00+01:00␤»
</code></pre>

<h3 id="infix-方法">infix:&lt;+&gt; 方法</h3>

<p>定义为：</p>

<pre><code class="language-perl6">multi sub infix:&lt;+&gt; (DateTime:D, Duration:D --&gt; DateTime:D)
multi sub infix:&lt;+&gt; (Duration:D, DateTime:D --&gt; DateTime:D)
</code></pre>

<p>采用日期时间并按给定持续时间增加它，以保留时区。</p>

<pre><code class="language-perl6">say DateTime.new(:2015year) + Duration.new(31536001.0);        # OUTPUT: «2016-01-01T00:00:00Z␤»
say Duration.new(42) + DateTime.new(:2015year, :3600timezone); # OUTPUT: «2015-01-01T00:00:42+01:00␤»
</code></pre>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>ohmysummer ❤ Perl 6</p>
    
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
