<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="ohmysummer">
    <meta name="description" content="ohmysummer&#39;s personal website">
    <meta name="keywords" content="Perl6,Rakudo">

    <base href="http://ohmysummer.github.io/">
    <title>
  Perl 6 中的 *, $_ 和 $ · 焉知非鱼
</title>

    <link rel="canonical" href="http://ohmysummer.github.io/post/2017-02-04-whatever-star-vs.-_-vs-/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.cd087ace86754b082dec94545567f8361cba42e84f8e15edbc4a9f6e52bd1f6a.css" integrity="sha256-zQh6zoZ1Swgt7JRUVWf4Nhy6QuhPjhXtvEqfblK9H2o=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://ohmysummer.github.io/css/style.css">
    

    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://ohmysummer.github.io/">
      焉知非鱼
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/post">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/page/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags">标签</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Perl 6 中的 *, $_ 和 $</h1>
    </header>

    

<h2 id="cale2-问了一个很难的问题">cale2 问了一个很难的问题</h2>

<p>今天卡尔2<a href="https://irclog.perlgeek.de/perl6/2017-02-01#i_14028041">拒绝</a>问简单的问题。我们来看它今天问了什么难题：</p>

<blockquote>
<p><cale2> 我需要一份关于 * vs $_ vs $ 的指南。</p>
</blockquote>

<p>这个问题问得多么好。那三种东西都是语法糖, 因为上下文转换, 它们能很好地避免折行和更少的 bugs。</p>

<p>我们从我们的老朋友主题变量 <code>$_</code> 开始。在 Perl 5 中它刚好出现在每个 sub 的外面。在 Perl 6 中它出现在块的默认值之外。</p>

<pre><code class="language-perl6">my &amp;block =  { 'oi?' };
&amp;block.signature.say;
# OUTPUT?(;; $_? is raw)??

</code></pre>

<p>块的默认签名是一个名为 <code>$_</code> 的位置参数。因此每个块都有一个主题变量 <code>$_</code>。还有其他设置 <code>$_</code> 主题变量的语句，而不引入一个新的块，像 <em>with</em> 和 <em>given</em> （<em>given</em> 的确引入了一个块，但它是特殊的，我在这里不说明细节）。</p>

<pre><code class="language-perl6">say $_ with 42;
# OUTPUT ?42??
</code></pre>

<p>因为它是默认的, Perl 6 会在很多地方期待它的出现。最突出的是当没有对象方法调用时。</p>

<pre><code class="language-perl6">$_ = 42; say 'oi?' when 42;
.say;
# OUTPUT?oi??42??
</code></pre>

<p>一个单独的 <code>$</code> 实际上是两个（有一点）的东西。在签名中，它是一个我们永远不能使用的位置参数标记（也许是因为我们不在乎），因为它没有名字，因此在它所应用的例程中不引入符号。它对于 protos 和免费的浮点签名很有用。它的第二个用途实际上引入了一个容器，也没有符号。它也是一个状态变量，它的初始化器（如果有一个）不被处理为状态，并将被调用多于一次。我们可以使用匿名状态变量来计数东西。</p>

<pre><code>my @a = &lt;a b c d&gt;;
for @a { say @a[$++] };

# OUTPUT?a?b?c?d??
</code></pre>

<p>我们可以滥用匿名变量 <code>$</code> 在列表赋值中跳过我们不想要的值。当我们从一个子例程中得到一个短的列表时会很简洁。</p>

<pre><code class="language-perl6">my ($,$,$c) = &lt;a b c d&gt;;
say $c;
# OUTPUT?c??
</code></pre>

<p>我很享受这样的事实，我懒得给一次性变量起名字。认知负荷越小越好。</p>

<p>Whatever <code>*</code> 是问题的难点。有时它是一个语法糖标记，我们用它来告诉 Perl 6 我们不关心什么将被选中。在其他时候，它意味着 Inf, 意思是它们中的所有。</p>

<pre><code class="language-perl6">my @a = &lt;a b c d&gt;;
put @a.pick(*);

# OUTPUT?c d b a??
</code></pre>

<p>如果在参数列表中使用一个单独的 <code>*</code>，它将变成单例 Whatever。由于我们可以要求签名中的值，我们可以为 <code>muiti</code>s 提供接口。</p>

<pre><code>multi sub foo(Int $i){ $i * 42 };
multi sub foo(Whatever){ &lt;42 oi? ?&gt;.pick };
say foo(*);
# OUTPUT???? (your results may vary)
</code></pre>

<p>如果我们在包含运算符或调用的语句中使用 <code>*</code>，它会形成一个没有作用域的块，并像一个占位符变量一样运行，而不会丢失该块由 <code>*</code> 生成的信息。生成的 Callable 的类型是 Wh??ateverCode 并且当提供了 Sub 或方法时, 例程可以在它上面采取不同的行动。与真正的占位符变量相反, Whatever 可以用在 where 子句中。</p>

<pre><code class="language-perl6">sub foo($a where * &lt; 10){}
</code></pre>

<p>对于他的问题, 这不是一个完整的答案。这就是为什么我建议卡尔2去阅读文档。</p>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>ohmysummer ❤ Perl 6</p>
    
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
