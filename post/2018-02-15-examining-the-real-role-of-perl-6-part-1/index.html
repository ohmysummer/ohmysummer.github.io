<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="ohmysummer">
    <meta name="description" content="ohmysummer&#39;s personal website">
    <meta name="keywords" content="Perl6,Rakudo">

    <base href="http://ohmysummer.github.io/">
    <title>
  Examining the Real role of Perl 6, part 1 · 焉知非鱼
</title>

    <link rel="canonical" href="http://ohmysummer.github.io/post/2018-02-15-examining-the-real-role-of-perl-6-part-1/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.cd087ace86754b082dec94545567f8361cba42e84f8e15edbc4a9f6e52bd1f6a.css" integrity="sha256-zQh6zoZ1Swgt7JRUVWf4Nhy6QuhPjhXtvEqfblK9H2o=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://ohmysummer.github.io/css/style.css">
    

    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://ohmysummer.github.io/">
      焉知非鱼
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/post">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/page/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags">标签</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Examining the Real role of Perl 6, part 1</h1>
    </header>

    <p>在过去的几天里，我们谈了很多关于 <code>Real</code> 这个角色。让我们更仔细地看看它。该代码位于 <code>src/core/Real.pm</code> 文件中。</p>

<p>它包含角色本身和一些实现不同中缀的子例程。<code>Real</code> 角色又实现了 <code>Numeric</code> 角色：</p>

<pre><code class="language-perl6">my role Real does Numeric {
    . . .
}
</code></pre>

<p>有趣的是，类定义还需要关于 <code>Complex</code> 类的一些知识，这就是为什么在文件的第一行有一个前向类声明：</p>

<pre><code class="language-perl6">my class Complex { ... }
</code></pre>

<p><code>Real</code> 角色将许多三角函数定义为方法，正如我们已经看到的，他们<a href="https://perl6.online/2018/02/11/53-going-over-the-bridge-part-1/">正在使用 Bridge 方法</a>：</p>

<pre><code class="language-perl6">method sqrt() { self.Bridge.sqrt }
method rand() { self.Bridge.rand }
method sin() { self.Bridge.sin }
method asin() { self.Bridge.asin }
method cos() { self.Bridge.cos }
method acos() { self.Bridge.acos }
method tan() { self.Bridge.tan }
method atan() { self.Bridge.atan }
</code></pre>

<p>另一组方法包括直接操纵值的泛型方法：</p>

<pre><code class="language-perl6">method abs() { self &lt; 0 ?? -self !! self }
proto method round(|) {*}
multi method round(Real:D:) {
    (self + 1/2).floor; # Rat NYI here, so no .5
}
multi method round(Real:D: Real() $scale) {
    (self / $scale + 1/2).floor * $scale;
}
method truncate(Real:D:) {
    self == 0 ?? 0 !! self &lt; 0 ?? self.ceiling !! self.floor
}
</code></pre>

<p><code>round</code> 方法有一个非常有趣且有用的变体，它允许您将数字与您需要的网格对齐：</p>

<pre><code class="language-perl6">&gt; 11.5.round(3)
12
&gt; 10.1.round(3)
9
</code></pre>

<p>另一组方法用于将数字转换为不同的数据类型：</p>

<pre><code class="language-perl6">method Rat(Real:D: Real $epsilon = 1.0e-6) { self.Bridge.Rat($epsilon) }
method Complex() { Complex.new(self.Num, 0e0) }
multi method Real(Real:D:) { self }
multi method Real(Real:U:) {
    self.Mu::Real; # issue a warning;
    self.new
}
method Bridge(Real:D:) { self.Num }
method Int(Real:D:) { self.Bridge.Int }
method Num(Real:D:) { self.Bridge.Num }
multi method Str(Real:D:) { self.Bridge.Str }
</code></pre>

<p>这里我们在矩阵中有一个问题。 <code>Bridge</code> 方法以调用 <code>Num</code> 方法这样的方式被定义。反过来，<code>Num</code> 调用 <code>Bridge</code>, 而 Bridge 调用 <code>Num</code>。</p>

<p>运行以下代码行之一，Rakudo 将挂起：</p>

<pre><code class="language-perl6">Real.new.say;
</code></pre>

<pre><code class="language-perl6">Real.new.Str;
</code></pre>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>ohmysummer ❤ Perl 6</p>
    
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
