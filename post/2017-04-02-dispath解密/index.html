<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Perl 6 Dispatch è§£å¯†</title>
  <meta property="og:title" content="Perl 6 Dispatch è§£å¯†" />
  <meta name="twitter:title" content="Perl 6 Dispatch è§£å¯†" />
  <meta name="description" content="But Here&#39;s My Dispatch, So callwith Maybe">
  <meta property="og:description" content="But Here&#39;s My Dispatch, So callwith Maybe">
  <meta name="twitter:description" content="But Here&#39;s My Dispatch, So callwith Maybe">
  <meta name="author" content="ç„‰çŸ¥éé±¼"/>
  <link href='https://ohmysummer.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://ohmysummer.github.io/img/rakudo.png" />
  <meta name="twitter:image" content="https://ohmysummer.github.io/img/rakudo.png" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://ohmysummer.github.io/post/2017-04-02-dispath%E8%A7%A3%E5%AF%86/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Rakudo Perl 6" />

  <meta name="generator" content="Hugo 0.53" />
  <link rel="canonical" href="https://ohmysummer.github.io/post/2017-04-02-dispath%E8%A7%A3%E5%AF%86/" />
  <link rel="alternate" href="https://ohmysummer.github.io/index.xml" type="application/rss+xml" title="Rakudo Perl 6">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://ohmysummer.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://ohmysummer.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://ohmysummer.github.io/css/codeblock.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'ohmycloudy', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://ohmysummer.github.io/">Rakudo Perl 6</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="åšå®¢" href="/">åšå®¢</a>
            </li>
          
        
          
            <li>
              <a title="å½’æ¡£" href="/categories">å½’æ¡£</a>
            </li>
          
        
          
            <li>
              <a title="å…³äº" href="/page/about/">å…³äº</a>
            </li>
          
        
          
            <li>
              <a title="æ ‡ç­¾" href="/tags">æ ‡ç­¾</a>
            </li>
          
        

        

        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">Search</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Rakudo Perl 6" href="https://ohmysummer.github.io/">
            <img class="avatar-img" src="https://ohmysummer.github.io/img/rakudo.png" alt="Rakudo Perl 6" />
          </a>
        
      </div>
    </div>

  </div>
</nav>



  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Search Rakudo Perl 6</h4>
        </div>
        <div class="modal-body">
          <gcse:search></gcse:search>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>Perl 6 Dispatch è§£å¯†</h1>
                
                  
                    <h2 class="post-subheading">But Here&#39;s My Dispatch, So callwith Maybe</h2>
                  
                
                
                  <span class="post-meta">
  
  
  <i class="fa fa-calendar-o"></i>&nbsp; Posted on April 2, 2017
  
  
  &nbsp;|&nbsp;
  <i class="fa fa-clock-o"></i> 8 minutes (1564 words)
  
  
</span>

                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<p>Perl 6 çš„ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§æ˜¯ <em>multi-dispatch</em>, å³å¤šé‡åˆ†æ´¾ã€‚å®ƒå…è®¸ä½ åœ¨å‡½æ•°, æ–¹æ³•æˆ– <a href="https://docs.perl6.org/language/grammars">Grammar</a> token ä¸­ä½¿ç”¨ç›¸åŒçš„åå­—å¹¶è®©å®ƒä»¬æ‰€å¤„ç†çš„æ•°æ®çš„ç±»å‹æ¥å†³å®šæ‰§è¡Œå“ªä¸€ä¸ªã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª <a href="https://en.wikipedia.org/wiki/Factorial">factorial</a> postfix æ“ä½œç¬¦, ç”¨ä¸¤ä¸ª multies æ¥å®ç°:</p>

<pre><code class="language-perl6">multi postfix:&lt;!&gt; (0) { 1 }
multi postfix:&lt;!&gt; (UInt \n) { n Ã— samewith n âˆ’ 1 }

say 5!

# OUTPUT: 120
</code></pre>

<p>è™½ç„¶ multi-dispatch çš„ä¸»é¢˜å¾ˆæ˜æ˜¾å¹¶ä¸”å®ƒè¿˜æœ‰ä¸€äº›è¯´æ˜<a href="https://docs.perl6.org/language/functions#Multi-dispatch">æ–‡æ¡£</a>, æˆ‘ä»Šå¤©æƒ³è®²çš„æ˜¯ 7 ä¸ªç‰¹æ®Šçš„å­ä¾‹ç¨‹, è®©ä½ èƒ½å¤Ÿè¡Œèµ°åœ¨ dispatch è¿·å®«ä¸­ã€‚å®ƒä»¬æ˜¯ <code>nextwith</code>, <code>nextsame</code>, <code>samewith</code>, <code>callwith</code>, <code>callsame</code>, <code>nextcallee</code> å’Œ <code>lastcall</code>.</p>

<h2 id="è®¾ç«‹å®éªŒå®¤">è®¾ç«‹å®éªŒå®¤</h2>

<p>Multies ä»æœ€çª„åˆ°æœ€å¹¿çš„å€™é€‰è€…è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å½“ä¸€ä¸ª multi è¢«è°ƒç”¨æ—¶ï¼Œç»‘å®šå™¨å°è¯•æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…å¹¶è°ƒç”¨ç¬¬ä¸€ä¸ªåŒ¹é…çš„å€™é€‰è€…ã€‚ æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›è°ƒç”¨æˆ–ç®€å•åœ°ç§»åŠ¨åˆ°é“¾ä¸­çš„ä¸‹ä¸€ä¸ªåŒ¹é…å€™é€‰è€…ï¼Œå¯é€‰åœ°ä½¿ç”¨ä¸åŒçš„å‚æ•°ã€‚ ä¸ºäº†è§‚å¯Ÿè¿™äº›æ“ä½œçš„æ•ˆæœï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹è®¾ç½®ï¼š</p>

<pre><code class="language-perl6">class Wide             { }
class Middle is Wide   { }
class Narrow is Middle { }

multi foo (Narrow $v) { say 'Narrow ', $v; 'from Narrow' }
multi foo (Middle $v) { say 'Middle ', $v; 'from Middle' }
multi foo (Wide   $v) { say 'Wide   ', $v; 'from Wide'   }

foo Narrow; # OUTPUT: Narrow (Narrow)
foo Middle; # OUTPUT: Middle (Middle)
foo Wide;   # OUTPUT: Wide   (Wide)
</code></pre>

<p>æˆ‘ä»¬æœ‰ä¸‰ä¸ªç±»ï¼Œæ¯ä¸ªç±»éƒ½ç»§æ‰¿è‡ªå‰ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ <code>Narrow</code> ç±» å¯ä»¥é€‚åº” <code>Middle</code> å’Œ <code>Wide</code>  multi å€™é€‰è€…; <code>Middle</code> ä¹Ÿå¯ä»¥é€‚åº” <code>Wide</code>ï¼Œä½†ä¸èƒ½é€‚åº” <code>Narrow</code>; è€Œ <code>Narrow</code> æ—¢ä¸é€‚ç”¨äº <code>Middle</code>ï¼Œä¹Ÿä¸é€‚ç”¨äº <code>Narrow</code>ã€‚è¯·è®°ä½ï¼ŒPerl 6 ä¸­çš„æ‰€æœ‰ç±»ä¹Ÿéƒ½æ˜¯ <a href="https://docs.perl6.org/type/Any">Any</a> ç±»å‹ï¼Œå› æ­¤ä¹Ÿé€‚ç”¨äºä»»ä½•æ¥å— <a href="https://docs.perl6.org/type/Any">Any</a> çš„å€™é€‰è€…ã€‚</p>

<p>å¯¹äºæˆ‘ä»¬çš„ <a href="https://docs.perl6.org/type/Callable.html">Callables</a>ï¼Œæˆ‘ä»¬åœ¨ foo å­ä¾‹ç¨‹ä¸Šä½¿ç”¨ä¸‰ä¸ª multi å€™é€‰è€…ï¼šæ¯ä¸ªç±»ä¸€ä¸ªã€‚åœ¨ç±»çš„ä¸»ä½“ä¸­ï¼Œæˆ‘ä»¬æ‰“å°ä»€ä¹ˆæˆ‘ä»¬æ‰€è°ƒç”¨çš„ multi çš„ç±»å‹ï¼Œä»¥åŠä½œä¸ºå‚æ•°ä¼ é€’çš„å€¼ã€‚å¯¹äºå®ƒä»¬çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬åªä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ¥å‘Šè¯‰æˆ‘ä»¬è¿”å›å€¼æ¥è‡ªå“ªä¸ª multi;æˆ‘ä»¬ç¨åä¼šä½¿ç”¨è¿™äº›ã€‚</p>

<p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‰ä¸ªç±»å‹çš„å¯¹è±¡ä¸æˆ‘ä»¬çš„è‡ªå®šä¹‰ç±»è¿›è¡Œä¸‰æ¬¡è°ƒç”¨ã€‚ä»è¾“å‡ºæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªå€™é€‰è€…ä¸­çš„æ¯ä¸€ä¸ªå€™é€‰è€…éƒ½æŒ‰é¢„æœŸè¢«è°ƒç”¨äº†ã€‚</p>

<p>è¿™ä¸€åˆ‡éƒ½æ˜¯å¹³æ·¡è€Œæ— èŠçš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒå‘³ï¼åœ¨è¿™äº›ä¾‹ç¨‹çš„å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶è°ƒç”¨ <code>nextsame</code>ï¼Œ<code>samewith</code>ï¼Œ<code>callwith</code> æˆ– <code>callame</code> æ¥è°ƒç”¨å…·æœ‰ç›¸åŒæˆ–ä¸åŒå‚æ•°çš„å¦ä¸€ä¸ªå€™é€‰è€…ã€‚ä½†é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å¼„æ¸…æ¥šå®ƒä»¬éƒ½åšä»€ä¹ˆï¼Ÿ</p>

<h2 id="ä¸»é¢˜">ä¸»é¢˜</h2>

<p>æˆ‘ä»¬è¦æµ‹è¯•çš„å‰ 5 ä¸ªä¾‹ç¨‹çš„å‘½åéµå¾ªå¦‚ä¸‹çº¦å®š:</p>

<ul>
<li><code>call____</code> â€” <strong>è°ƒç”¨</strong>é“¾ä¸­çš„ä¸‹ä¸€ä¸ªåŒ¹é…çš„å€™é€‰è€…å¹¶å›åˆ°æ­¤å¤„</li>
<li><code>next____</code> - è·³è½¬åˆ°é“¾ä¸­çš„<strong>ä¸‹ä¸€ä¸ª</strong>åŒ¹é…çš„å€™é€‰è€…å¹¶ä¸”ä¸å›åˆ°æ­¤å¤„</li>
<li><code>____same</code> - ä½¿ç”¨ <strong>åŒä¸€ä¸ª</strong>å‚æ•°å°±åƒç”¨äºå½“å‰å€™é€‰è€…ä¸€æ ·</li>
<li><code>____with</code> - ä½¿ç”¨æä¾›çš„è¿™äº›æ–°å‚æ•°è¿›è¡Œæ“ä½œ</li>
<li><code>samewith</code> - ä»å¤´å¼€å§‹ä¸€ä¸ª<strong>åŒæ ·çš„</strong>è°ƒç”¨, éµå¾ªä¸€ä¸ªæ–°çš„åˆ†æ´¾é“¾, ä½¿ç”¨è¿™äº›æ–°çš„å‚æ•°å¹¶ä¸”å›åˆ°æ­¤å¤„</li>
</ul>

<p><code>samesame</code> ä¸æ˜¯ä»€ä¹ˆç¨€å¥‡çš„ä¸œè¥¿, è¿™ç§æƒ…å†µæœ€å¥½ç”±å¸¸è§„å¾ªç¯ä»£æ›¿ã€‚ä¸»è¦çš„å¤–å–æ˜¯â€œcallâ€ï¼Œå°±æ˜¯è¯´ä½ è°ƒç”¨å€™é€‰è€…å¹¶å›åˆ°åŸåœ°, ä½¿ç”¨å®ƒçš„è¿”å›å€¼æˆ–åšæ›´å¤šçš„äº‹æƒ…; â€œnextâ€æ„å‘³ç€å‰å¾€ä¸‹ä¸€ä¸ªå€™é€‰è€…ï¼Œå¹¶ä½¿ç”¨å…¶è¿”å›å€¼ä½œä¸ºå½“å‰å€™é€‰è€…çš„è¿”å›å€¼; ç„¶è€Œæœ«å°¾çš„ <code>same</code> å’Œ <code>with</code> ä»…ä»…æ§åˆ¶ä½ æ˜¯å¦æƒ³è¦ä½¿ç”¨åŒæ ·çš„å‚æ•°å°±åƒä½ åœ¨å½“å‰å€™é€‰è€…ä¸­ä½¿ç”¨çš„é‚£æ ·, æˆ–è€…æä¾›ä¸€ä¸ªæ–°çš„é›†åˆã€‚</p>

<p>è®©æˆ‘ä»¬æ¥ç©ç©è¿™äº›ä¸œè¥¿å§ï¼</p>

<h2 id="it-s-all-called-the-same">It&rsquo;s all called the same&hellip;</h2>

<p>æˆ‘ä»¬å°è¯•çš„ç¬¬ä¸€ä¸ªä¾‹ç¨‹æ˜¯ <code>callsame</code>ã€‚å®ƒä½¿ç”¨å’Œå½“å‰å€™é€‰è€…<strong>åŒæ ·çš„</strong>å‚æ•°<strong>è°ƒç”¨</strong>ä¸‹ä¸€ä¸ªåŒ¹é…çš„å€™é€‰è€…å¹¶è¿”å›è¯¥å€™é€‰è€…çš„è¿”å›å€¼ã€‚</p>

<p>è®©æˆ‘ä»¬æ¥ä¿®æ”¹ä¸‹æˆ‘ä»¬çš„ <code>Middle</code> å€™é€‰è€…ä»¥è°ƒç”¨ <code>callsame</code> ç„¶åæ‰“å°å‡ºå®ƒçš„è¿”å›å€¼:</p>

<pre><code class="language-perl6">calss Wide             {}
calss Middle is Wide   {}
class Narrow is Middle {}

multi foo(Narrow $v) { say 'Narrow', $v, 'from Narrow' }
multi foo(Middle $v) {
    say 'Middle', $v;

    my $result = callsame;
    say &quot;We're back! The Return value is $result&quot;;

    'from Middle'
}

multi foo(Wide $v) { say 'Wide ', $v; 'from Wide' }

foo Middle;

# OUTPUT:
# Middle (Middle)
# Wide   (Middle)
# We're back! The return value is from Wide
</code></pre>

<p>ç°åœ¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å•ä¸ª <code>foo</code> è°ƒç”¨å¯¼è‡´äº†ä¸¤æ¬¡è°ƒç”¨ã€‚ç¬¬ä¸€æ¬¡åˆ°äº† <code>Middle</code>, å› ä¸ºå®ƒæ˜¯æˆ‘ä»¬ç»™  <code>foo</code> è°ƒç”¨çš„ç±»å‹å¯¹è±¡ã€‚ç¬¬äºŒæ¬¡åˆ°äº† <code>Wide</code>, å› ä¸ºå®ƒæ˜¯ä¸‹ä¸€ä¸ªèƒ½æ¥æ”¶ <code>Middle</code> ç±»å‹çš„å€™é€‰è€…; åœ¨è¾“å‡ºä¸­æˆ‘ä»¬çœ‹åˆ° <code>Wide</code> è¢«è°ƒç”¨æ—¶ä»æ—§ä½¿ç”¨äº†æˆ‘ä»¬åŸæ¥çš„  <code>Middle</code> ç±»å‹å¯¹è±¡ã€‚æœ€å, æˆ‘ä»¬å›åˆ°äº†æˆ‘ä»¬çš„ <code>Middle</code> å€™é€‰è€…ä¸­, å¹¶æŠŠ <code>Wide</code> å€™é€‰è€…çš„è¿”å›å€¼è®¾ç½®ç»™ <code>$result</code> å˜é‡ã€‚</p>

<p>ç›®å‰ä¸ºæ­¢éå¸¸æ¸…æ™°, è®©æˆ‘ä»¬è¯•è¯•ä¿®æ”¹ä¸‹å‚æ•°!</p>

<h2 id="have-you-tried-to-call-them-with">Have you tried to call them with&hellip;</h2>

<p>æ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥, <code>__with</code> å˜ä½“å…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸åŒçš„å‚æ•°ã€‚æˆ‘ä¼šä½¿ç”¨å’Œä¹‹å‰çš„ä¾‹å­ç›¸åŒçš„ä»£ç , åŒºåˆ«å°±æ˜¯ç°åœ¨æˆ‘ä¼šæ‰§è¡Œ <code>callwith</code>, å¹¶ä½¿ç”¨ <code>Narrow</code> ç±»å‹å¯¹è±¡ä½œä¸ºæ–°çš„å‚æ•°:</p>

<pre><code class="language-perl6">class Wide             {}
class Middle is Wide   {}
class Narrow is Middle {}
multi foo(Narrow $v) { say 'Narrow', $v; 'from Narrow' }
multi foo(Middle $v) {
    say 'Middle', $v;

    my $result = callwith Narrow;
    say &quot;We're back! The return value is $result&quot;;

    'from Middle'
}
multi foo(Wide $v) { say 'Wide ', $v; 'from Wide' }

foo Middle;

# OUTPUT:
# Middle (Middle)
# Wide   (Narrow)
# We're back! The return value is from Wide
</code></pre>

<p>è¾“å‡ºçš„ç¬¬ä¸€éƒ¨åˆ†å¾ˆæ¸…æ¥š: æˆ‘ä»¬ä»æ—§ä½¿ç”¨ <code>Middle</code> è°ƒç”¨ <code>foo</code>,   å¹¶ä¸”å…ˆå‡»ä¸­ <code>Middle</code> å€™é€‰è€…ã€‚ç„¶è€Œ, ä¸‹ä¸€è¡Œè¾“å‡ºæœ‰ç‚¹å¤æ€ªã€‚æˆ‘ä»¬åœ¨ <code>callwith</code> ä¸­ä½¿ç”¨äº† <code>Narrow</code> å‚æ•°, æ‰€ä»¥ç©¶ç«Ÿ <code>Wide</code> å€™é€‰è€…æ˜¯æ€ä¹ˆå¾—åˆ°è°ƒç”¨çš„è€Œä¸æ˜¯è°ƒç”¨ <code>Narrow</code> å€™é€‰è€…å‘¢?</p>

<p>åŸå› æ˜¯ <code>call____</code> å’Œ <code>next____</code> ä¾‹ç¨‹ä½¿ç”¨ä¸åŸå§‹è°ƒç”¨ç›¸åŒçš„è°ƒåº¦é“¾ã€‚ç”±äº <code>Narrow</code> å€™é€‰è€…æ¯” <code>Middle</code> å€™é€‰è€…æ›´çª„, æ‰€ä»¥è¢«æ‹’ç», åœ¨å½“å‰çš„é“¾æ¡ä¸­ä¸ä¼šè¢«è€ƒè™‘ã€‚ä¸‹ä¸€ä¸ª <code>callwith</code> å°†ä¼šè°ƒç”¨çš„å€™é€‰è€…å°†æ˜¯ä¸‹ä¸€ä¸ªåŒ¹é… <code>Middle</code> çš„å€™é€‰è€… &ndash; è€Œä¸æ˜¯ç¬”è¯¯ï¼š<code>Middle</code> æ˜¯æˆ‘ä»¬ç”¨äºå‘èµ·è°ƒåº¦çš„å‚æ•°, å› æ­¤ä¸‹ä¸€ä¸ªå€™é€‰è€…å°†æ˜¯ä»ç„¶å¯ä»¥æ¥å—è¯¥åŸå§‹è°ƒç”¨çš„å‚æ•°çš„å€™é€‰è€…ã€‚ä¸€æ—¦å‘ç°ä¸‹ä¸€ä¸ªå€™é€‰è€…ï¼Œä¼ é€’ç»™ <code>callwith</code> çš„æ–°å‚æ•°å°±ä¼šç»‘å®šåˆ°å®ƒèº«ä¸Š, è¿™æ˜¯ä½ çš„å·¥ä½œ, ä»¥ç¡®ä¿å®ƒä»¬å¯ä»¥ã€‚</p>

<p>è®©æˆ‘ä»¬åœ¨å®æˆ˜ä¸­çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ã€‚</p>

<h2 id="kicking-it-up-a-notch">Kicking It Up a Notch</h2>

<p>æˆ‘ä»¬ä¼šä½¿ç”¨æ›´å¤šçš„ multies å’Œç±»å‹æ¥æ‰©å±•æˆ‘ä»¬åŸæ¥çš„ä¾‹å­:</p>

<pre><code class="language-perl6">class Wide             {}
class Middle is Wide   {}
class Narrow is Middle {}

subset Prime where .?is-prime;
subset NotPrime where not .?is-prime;

multi foo(Narrow   $v) { say 'Narrow   ', $v; 'from Narrow'  }
multi foo(Middle   $v) { say 'Middle   ', $v; 'from Middle'  }
multi foo(Wide     $v) { say 'Wide     ', $v; 'from Wide'    }
multi foo(Prime    $v) { say 'Prime    ', $v; 'from Prime'   }
multi foo(NotPrime $v) { say 'Non-Prime', $v; 'from Prime'   }

foo Narrow; # OUTPUT: Narrow    (Narrow)
foo Middle; # OUTPUT: Middle    (Middle)
foo Wide;   # OUTPUT: Wide      (Wide)
foo 42;     # OUTPUT: Non-Prime 42
foo 31337;  # OUTPUT: Prime     31337
</code></pre>

<p>æˆ‘ä»¬åŸæ¥çš„ä¸‰ä¸ªç±»éƒ½æ˜¯ <strong>Any</strong> ç±»å‹å¹¶ä¸”æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸¤ä¸ª <strong>Any</strong> çš„å­é›†(subset): <code>Prime</code> å’Œ <code>NotPrime</code>ã€‚å…¶ä¸­  <code>Prime</code> åœ¨ç±»å‹ä¸ŠåŒ¹é…ç´ æ•°è€Œ <code>NotPrime</code> åœ¨ç±»å‹ä¸ŠåŒ¹é…ä¸æ˜¯ç´ æ•°çš„æ•°å­—æˆ–è€…åŒ¹é…ä¸å« <code>.is-prime</code> æ–¹æ³•çš„æ•°å­—ã€‚å› ä¸ºæˆ‘ä»¬çš„ä¸‰ä¸ªè‡ªå®šä¹‰ç±»æ²¡æœ‰ <code>.is-prime</code> æ–¹æ³•, æ‰€ä»¥å®ƒä»¬éƒ½åœ¨ç±»å‹ä¸ŠåŒ¹é… <code>NotPrime</code>ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™ç§æ–°æ ¼å±€é‡å»ºä¹‹å‰çš„ä¾‹å­, æˆ‘ä»¬ä¼šå¾—åˆ°å’Œä¹‹å‰åŒæ ·çš„ç»“æœ:</p>

<pre><code class="language-perl6">class Wide             { }
class Middle is Wide   { }
class Narrow is Middle { }

subset    Prime where     .?is-prime;
subset NotPrime where not .?is-prime;

multi foo (Narrow   $v) { say 'Narrow    ', $v; 'from Narrow'   }
multi foo (Middle   $v) {
    say 'Middle    ', $v;

    my $result = callwith Narrow;
    say &quot;We're back! The return value is $result&quot;;

    'from Middle'
}
multi foo (Wide     $v) { say 'Wide      ', $v; 'from Wide'     }
multi foo (Prime    $v) { say 'Prime     ', $v; 'from Prime'    }
multi foo (NotPrime $v) { say 'Non-Prime ', $v; 'from NotPrime' }

foo Middle;

# OUTPUT:
# Middle    (Middle)
# Wide      (Narrow)
# We're back! The return value is from Wide
</code></pre>

<p>åŸæ¥çš„è°ƒç”¨æ¥åˆ° <code>Middle</code> å€™é€‰è€…ï¼Œå®ƒç”¨ <code>Narrow</code> ç±»å‹å¯¹è±¡ <code>callwith</code> åˆ° <code>Wide</code> å€™é€‰è€…ä¸­ã€‚</p>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ··åˆä¸€ä¸‹, ç”¨ <code>42</code> è€Œä¸æ˜¯ <code>Narrow</code> æ¥è°ƒç”¨ã€‚æˆ‘ä»¬ç¡®å®æœ‰ä¸€ä¸ª <code>NotPrime</code> å€™é€‰è€…ã€‚ <code>42</code> å’ŒåŸæ¥çš„ <code>Middle</code> éƒ½å¯ä»¥é€‚åº”è¿™ä¸ªå€™é€‰è€…ã€‚è€Œä¸”æ¯”åŸæ¥çš„ <code>Middle</code> å€™é€‰è€…æ›´å®½, å¹¶ä¸”å®ƒè¿˜å¤„åœ¨è°ƒåº¦é“¾çš„ä¸Šæ¸¸ã€‚è¿™å¯èƒ½ä¼šå‡ºé”™!</p>

<pre><code class="language-perl6">class Wide             { }
class Middle is Wide   { }
class Narrow is Middle { }

subset    Prime where     .?is-prime;
subset NotPrime where not .?is-prime;

multi foo (Narrow   $v) { say 'Narrow    ', $v; 'from Narrow'   }
multi foo (Middle   $v) {
    say 'Middle    ', $v;

    my $result = callwith 42;
    say &quot;We're back! The return value is $result&quot;;

    'from Middle'
}
multi foo (Wide     $v) { say 'Wide      ', $v; 'from Wide'     }
multi foo (Prime    $v) { say 'Prime     ', $v; 'from Prime'    }
multi foo (NotPrime $v) { say 'Non-Prime ', $v; 'from NotPrime' }

foo Middle;

# OUTPUT:
# Middle    (Middle)
# Type check failed in binding to $v; expected Wide but got Int (42)
#   in sub foo at z2.p6 line 15
#   in sub foo at z2.p6 line 11
#   in block &lt;unit&gt; at z2.p6 line 19
</code></pre>

<p>å“¦ï¼Œå¯¹ï¼Œé‚£ä¸ªï¼æˆ‘ä»¬ç»™ <code>callwith</code> çš„æ–°å‚æ•°ä¸ä¼šå½±å“è°ƒåº¦, æ‰€ä»¥å°½ç®¡æœ‰ä¸€ä¸ªå€™é€‰è€…å¯ä»¥åœ¨è°ƒç”¨é“¾ä¸­è¿›ä¸€æ­¥åœ°å¤„ç†æˆ‘ä»¬çš„æ–°å‚æ•°, ä½†ä¸æ˜¯ä¸‹ä¸€ä¸ªå€™é€‰è€…å¯ä»¥å¤„ç†<strong>åŸå§‹çš„ args</strong>, è¿™æ˜¯ <code>callwith</code> æ‰€è°ƒç”¨çš„ã€‚ç»“æœæ˜¯æŠ›å‡ºå¼‚å¸¸, ç”±äºæˆ‘ä»¬çš„æ–°å‚æ•°ç»‘å®šç»™ä¸‹ä¸€ä¸ªè°ƒç”¨è€…æ—¶å¤±è´¥äº†ã€‚</p>

<h2 id="è°æ˜¯ä¸‹ä¸€ä¸ª">è°æ˜¯ä¸‹ä¸€ä¸ª?</h2>

<p>è¿™ä¸ªèƒ½è®©æˆ‘ä»¬åœ¨è°ƒåº¦é“¾ä¸ŠæŠ“ä½ä¸‹ä¸€ä¸ªåŒ¹é…çš„å€™é€‰è€…çš„è¶æ‰‹çš„å°å­ä¾‹ç¨‹æ˜¯ <code>nextcallee</code>ã€‚å®ƒä¸ä»…è¿”å›è¯¥å€™é€‰è€…çš„ <code>Callable</code>ï¼Œè€Œä¸”å®ƒå°†å…¶ä»é“¾ä¸Šç§»å‡ºï¼Œä»¥ä¾¿ä¸‹ä¸€ä¸ª <code>next____</code> å’Œ <code>call____</code> ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªå€™é€‰è€…ï¼Œä¸‹ä¸€ä¸ª <code>nextcallee</code> å°†ä¼šç§»å‡ºå¹¶è¿”å› next-next å€™é€‰è€…ã€‚æ‰€ä»¥, è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­, ä½œç‚¹å¼Šï¼</p>

<pre><code class="language-perl6">class Wide             { }
class Middle is Wide   { }
class Narrow is Middle { }

subset    Prime where     .?is-prime;
subset NotPrime where not .?is-prime;

multi foo (Narrow   $v) { say 'Narrow    ', $v; 'from Narrow'   }
multi foo (Middle   $v) {
    say 'Middle    ', $v;

    nextcallee;
    my $result = callwith 42;
    say &quot;We're back! The return value is $result&quot;;

    'from Middle'
}
multi foo (Wide     $v) { say 'Wide      ', $v; 'from Wide'     }
multi foo (Prime    $v) { say 'Prime     ', $v; 'from Prime'    }
multi foo (NotPrime $v) { say 'Non-Prime ', $v; 'from NotPrime' }

foo Middle;

# OUTPUT:
# Middle    (Middle)
# Non-Prime 42
# We're back! The return value is from NotPrime
</code></pre>

<p>å•Šå“ˆï¼æœ‰ç”¨ï¼ä»£ç å‡ ä¹å®Œå…¨ä¸€æ ·ã€‚å”¯ä¸€çš„å˜åŒ–æ˜¯æˆ‘ä»¬åœ¨è°ƒç”¨ <code>callwith</code> ä¹‹å‰å¼¹å‡ºäº† <code>nextcallee</code> è°ƒç”¨ã€‚å®ƒç§»é™¤äº†æ— æ³•å¤„ç†æ–°çš„ <code>42</code> å‚æ•°çš„ <code>Wide</code> å€™é€‰è€…ï¼Œæ‰€ä»¥ï¼Œä»è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çš„è°ƒç”¨è¿›å…¥äº† <code>NotPrime</code> å€™é€‰è€…ã€‚</p>

<p><code>nexcallee</code> æ˜¯ç²¾æ¹›çš„ï¼Œæ‰€ä»¥å¾ªç¯æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œå› ä¸ºå®ƒä¼šä½¿ç”¨å¾ªç¯æˆ–thunkçš„è°ƒåº¦ç¨‹åºæ¥æŸ¥æ‰¾è¢«è°ƒç”¨è€…ã€‚æ‰€ä»¥å®ƒæœ€å¸¸è§å’Œæœ€ç®€å•çš„ç”¨æ³•æ˜¯è·å¾—&hellip;ä¸‹ä¸€ä¸ªè¢«è°ƒç”¨è€…ã€‚å¦‚æœä½ éœ€è¦ä¼ é€’ä¸‹ä¸€ä¸ªè¢«è°ƒç”¨è€…, ä½ å¾—å…ˆè¿™æ ·åš:</p>

<pre><code class="language-perl6">multi pick-winner (Int \s) {
    my &amp;nextone = nextcallee;
    Promise.in(Ï€Â²).then: { nextone s }
}
multi pick-winner { say &quot;Woot! $^w won&quot; }

with pick-winner ^5 .pick -&gt; \result {
    say &quot;And the winner is...&quot;;
    await result;
}

# OUTPUT:
# And the winner is...
# Woot! 3 won
</code></pre>

<p><code>Int</code> å€™é€‰è€…æ¥æ”¶ <code>nextcallee</code> ç„¶åå¯åŠ¨ä¸€ä¸ªä¼šè¢«å¹¶è¡Œæ‰§è¡Œçš„ <strong>Promise</strong>, åœ¨è¶…æ—¶åè¿”å›ã€‚æˆ‘ä»¬ä¸èƒ½åœ¨è¿™å„¿ä½¿ç”¨ <code>nextsame</code>, å› ä¸ºå®ƒä¼šå°è¯• <code>nextsame</code> <a href="https://docs.perl6.org/language/concurrency">Promise</a> çš„ä»£ç å—è€Œéæˆ‘ä»¬åŸæ¥çš„å­ä¾‹ç¨‹, å› æ­¤, <code>nextcallee</code> èŠ‚çœäº†æˆ‘ä»¬ä¸€æ•´å¤©æ—¶é—´ã€‚</p>

<p>æˆ‘æƒ³æˆ‘ä»¬å·²ç»åˆ°è¾¾äº†ä»¤äººçœ¼èŠ±ç¼­ä¹±çš„ä¾‹å­çš„å·…å³°ï¼Œæˆ‘å¯ä»¥å¬åˆ°è§‚ä¼—çš„å‘¼å–Šã€‚ â€œè¿™ç§ä¸œè¥¿æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Œåæ­£ï¼Ÿåªæ˜¯åˆ¶é€ äº†æ›´å¤šçš„ subs, è€Œä¸æ˜¯æ··ä¹±çš„ multis!â€œ æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ›´å¤šçš„çœŸå®ä¸–ç•Œçš„ä¾‹å­ï¼Œä»¥åŠæ¥ä¸‹æ¥é‡è§çš„ <code>nextsame</code> å’Œ <code>nextwith</code>ï¼</p>

<h2 id="next-one-in-line-please">Next one in line, please</h2>

<p>æˆ‘ä»¬æ¥å†™ä¸€ä¸ªç±»ï¼ä¸€ä¸ªèƒ½åšäº‹çš„ç±»ï¼</p>

<pre><code class="language-perl6">role Things {
    multi method do-it($place) {
        say &quot;I am {&lt;eating sleeping coding weeping&gt;.pick} at $place&quot;
    }
}

class Doer does Things {}

Doer.do-it: 'home' # è¾“å‡º: I am coding at home
</code></pre>

<p>æˆ‘ä»¬ç¢°ä¸åˆ°<a href="https://docs.perl6.org/language/objects#Roles">role</a>ï¼Œå› ä¸ºå®ƒæ˜¯åˆ«äººä¸ºæˆ‘ä»¬è€Œåšçš„ï¼Œä¿æŒå®ƒä»¬æœ¬æ¥çš„é¢ç›®å§ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ class èƒ½åšæ›´å¤šçš„äº‹æƒ…ï¼å¯¹äºæŸäº›<code>$place</code>ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒå‘Šè¯‰æˆ‘ä»¬ä¸€äº›æ›´å…·ä½“çš„ä¸œè¥¿ã€‚å¦å¤–ï¼Œå¦‚æœè¿™ä¸ªåœ°æ–¹æ˜¯ <code>my new place</code>ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“å“ªäº›åœ°æ–¹æ˜¯æ–°çš„ã€‚ä»¥ä¸‹æ˜¯ä»£ç ï¼š</p>

<pre><code class="language-perl6">role Things {
    multi method do-it($place) {
        say &quot;I am {&lt;eating sleeping coding weeping&gt;.pick} at $place&quot;
    }
}

class Doer does Things {
    multi method do-it($place where .contains: 'home') {
        nextsame if $place.contains: 'large';
        nextwith &quot;home with $&lt;color&gt; roof&quot;
          if $place ~~ /$&lt;color&gt;=[red|green|blue]/;

        samewith method 'my new place';
    }

    multi method do-it('my new place') {
        nextwith 'red home'
    }
}

Doer.do-it: 'the bus';       # OUTPUT: I am eating at the bus
Doer.do-it: 'home';          # OUTPUT: I am sleeping at red home
Doer.do-it: 'large home';    # OUTPUT: I am sleeping at large home
Doer.do-it: 'red home';      # OUTPUT: I am eating at home with red roof
Doer.do-it: 'some new home'; # OUTPUT: I am eating at red home
Doer.do-it: 'my new place';  # OUTPUT: I am coding at red home
</code></pre>

<p>å¤šäº†ä¸€ç‚¹é¢å¤–çš„ä»£ç ï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹æä¾›è¯¥æ–¹æ³•çš„ role è¿›è¡Œå•ä¸ªæ›´æ”¹ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€å¤§å †æ–°åŠŸèƒ½ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬ä½¿ç”¨çš„ä¸‰ä¸ªæ–°çš„è°ƒåº¦æ›´æ”¹ä¾‹ç¨‹ã€‚</p>

<p><code>nextsame</code> å’Œ <code>nextwith</code> å‡½æ•°ä¸å®ƒä»¬çš„ <code>callsame</code> å’Œ <code>callwith</code> å¯¹åº”å‡½æ•°éå¸¸ç›¸ä¼¼ï¼Œé™¤äº†<strong>å®ƒä»¬ä¸å›åˆ°è¢«è°ƒç”¨çš„ä½ç½®</strong>ï¼Œå®ƒä»¬çš„è¿”å›å€¼å°†è¢«ç”¨ä½œå½“å‰ä¾‹ç¨‹çš„è¿”å›å€¼ã€‚æ‰€ä»¥ä½¿ç”¨ <code>nextsame</code> å°±åƒä½¿ç”¨ <code>return callsame</code>ï¼Œä½†æ˜¯ä½¿ç”¨è¾ƒå°‘çš„é”®å…¥ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨èƒ½å¤Ÿè¿›è¡Œæ›´å¤šçš„ä¼˜åŒ–ã€‚</p>

<p>æˆ‘ä»¬æ·»åŠ åˆ°ç±»ä¸­çš„ç¬¬ä¸€ä¸ª multi æ–¹æ³•è¢«è°ƒåº¦åˆ° <code>$place</code> .contains å•è¯ <code>home</code> çš„ä½ç½®ã€‚åœ¨æ–¹æ³•çš„ä¸»ä½“ä¸­ï¼Œå¦‚æœ <code>$place</code> ä¹ŸåŒ…å«å•è¯ <code>large</code>ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>nextsame</code>ï¼Œå³ä½¿ç”¨ä¸å½“å‰æ–¹æ³•ç›¸åŒçš„å‚æ•°è°ƒç”¨ä¸‹ä¸€ä¸ªåŒ¹é…çš„å€™é€‰è€…ã€‚è¿™æ˜¯è¿™é‡Œçš„å…³é”®ã€‚æˆ‘ä»¬ä¸èƒ½å…¨éƒ¨å†æ¬¡è°ƒç”¨æˆ‘ä»¬çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒå°†è¿›å…¥æ— é™å¾ªç¯é‡æ–°åˆ†æ´¾ç»™è‡ªå·±ã€‚ç„¶è€Œï¼Œç”±äº <code>nextsame</code> åœ¨åŒä¸€ä¸ªè°ƒåº¦é“¾ä¸­ä½¿ç”¨ä¸‹ä¸€ä¸ªå€™é€‰è€…ï¼Œæ‰€ä»¥æ²¡æœ‰å¾ªç¯å‘ç”Ÿï¼Œæˆ‘ä»¬æ­£å¥½å¾—åˆ° <code>role Things</code> ä¸­çš„å€™é€‰è€…ã€‚</p>

<p>å¾€ä¸‹è¯»ä»£ç ä¸­ï¼Œ<code>nextwith</code> ä¹Ÿéšä¹‹è€Œæ¥ã€‚å½“ <code>$place</code> æåˆ°ä¸‰ç§é¢œè‰²ä¹‹ä¸€æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒã€‚ç±»ä¼¼äº <code>nextsame</code>ï¼Œå®ƒå»ä¸‹ä¸€ä¸ªå€™é€‰è€…ï¼Œé™¤äº†æˆ‘ä»¬ç»™å®ƒä¸€ä¸ªæ–°çš„å‚æ•°ä½¿ç”¨ä¹‹å¤–ã€‚</p>

<p>æœ€åï¼Œæˆ‘ä»¬æ¥åˆ° <code>samewith</code>ã€‚ä¸ä»¥å‰ä½¿ç”¨çš„ä¾‹ç¨‹ä¸åŒï¼Œè¿™ä¸ªå®¶ä¼™ä»å¤´å¼€å§‹<strong>é‡æ–°</strong>å¯åŠ¨è°ƒåº¦ï¼Œæ‰€ä»¥å®ƒåŸºæœ¬ä¸Šå°±åƒå†æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ä¸€æ ·ï¼Œé™¤äº†ä½ ä¸å¿…çŸ¥é“æˆ–ä½¿ç”¨å®ƒçš„å®é™…åç§°ã€‚æˆ‘ä»¬ç”¨ä¸€ç»„æ–°çš„å‚æ•°æ¥è°ƒç”¨ <code>samewith</code>ï¼Œä»è¾“å‡ºä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–°çš„è°ƒåº¦è·¯å¾„é€šè¿‡æˆ‘ä»¬æ·»åŠ åˆ°æˆ‘ä»¬çš„ç±»ä¸­çš„ç¬¬äºŒä¸ª multi è·¯å¾„ï¼Œè€Œä¸æ˜¯ç»§ç»­ä» role çš„ multiï¼Œå°±åƒæˆ‘ä»¬çš„ <code>next____</code> ç‰ˆæœ¬æ‰€åšçš„é‚£æ ·ã€‚</p>

<h2 id="last-call">Last Callï¼</h2>

<p>åŒ…ä¸­çš„æœ€åä¸€ä¸ªæ–¹æ³•æ˜¯ <code>lastcall</code>ã€‚è°ƒç”¨å®ƒæˆªæ–­å½“å‰çš„è°ƒåº¦é“¾ï¼Œä»¥ä¾¿ <code>next____</code> å’Œ <code>call____</code> ä¾‹ç¨‹ä¸ä¼šæœ‰å…¶å®ƒä»»ä½•åœ°æ–¹å¯å»ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>

<pre><code class="language-perl6">multi foo (Int $_) {
    say &quot;Int: $_&quot;;
    lastcall   when *.is-prime;
    nextsame   when *  %% 2;
    samewith 6 when * !%% 2;
}
multi foo (Any $x) { say &quot;Any $x&quot; }

foo 6; say '----';
foo 2; say '----';
foo 1;

# OUTPUT:
# Int: 6
# Any 6
# ----
# Int: 2
# ----
# Int: 1
# Int: 6
# Any 6
</code></pre>

<p>æˆ‘ä»¬æ‰€æœ‰çš„å¯¹ <code>foo</code> çš„è°ƒç”¨éƒ½ä¼šé¦–å…ˆè¿›å…¥ <code>Int</code> å€™é€‰è€…ã€‚å½“æ•°å­—ä¸º .is-primeï¼Œæˆ‘ä»¬è°ƒç”¨ <code>lastcall</code>; å½“å®ƒæ˜¯ä¸€ä¸ªå¶æ•°ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>nextsame</code>; è€Œå½“è¿™æ˜¯ä¸€ä¸ªå¥‡æ•°æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>6</code> ä½œä¸ºå‚æ•°æ¥è°ƒç”¨<code>samewith</code>ã€‚</p>

<p>æˆ‘ä»¬è°ƒç”¨ <code>foo</code> çš„ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯6ï¼Œè¿™ä¸æ˜¯ç´ æ•°ï¼Œæ‰€ä»¥ <code>lastcall</code> ä»ä¸è¢«è°ƒç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªå¶æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è°ƒç”¨ <code>nextsame</code>ï¼Œä»è¾“å‡ºæˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬å·²ç»è¾¾åˆ°<a href="https://docs.perl6.org/type/Any">Any</a>å€™é€‰è€…ã€‚</p>

<p>æ¥ä¸‹æ¥ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>2</code> è°ƒç”¨ <code>foo</code> æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªç´ æ•°å’Œå¶æ•°ï¼Œæˆ‘ä»¬è°ƒç”¨ <code>lastcall</code> å’Œ <code>nextcall</code>ã€‚ç„¶è€Œï¼Œå› ä¸º <code>lastcall</code> è¢«è°ƒç”¨å¹¶æˆªæ–­äº†è°ƒåº¦é“¾ï¼Œæ‰€ä»¥ <code>nextcall</code> ä»ä¸ä¼šçœ‹åˆ° Any å€™é€‰è€…ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæœ‰åœ¨è¾“å‡ºä¸­è°ƒç”¨ <code>Int</code> å€™é€‰è€…ã€‚</p>

<p>åœ¨æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨ä¸€ä¸ªç´ æ•°ï¼Œæ‰€ä»¥ <code>lastcall</code> å†ä¸€æ¬¡è¢«è°ƒç”¨ã€‚ç„¶è€Œï¼Œæ•°å­—æ˜¯ä¸€ä¸ªå¥‡æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>samewith</code> è€Œä¸æ˜¯ <code>nextwith</code>ã€‚ç”±äº <code>samewith</code> ä»å¤´å¼€å§‹é‡æ–°è°ƒåº¦ï¼Œå®ƒä¸åœ¨ä¹æˆ‘ä»¬ç”¨ <code>lastcall</code> æˆªæ–­äº†ä»¥å‰çš„é“¾ã€‚å› æ­¤ï¼Œè¾“å‡ºæ˜¾ç¤ºæˆ‘ä»¬ç»è¿‡ <code>Int</code> å€™é€‰è€…ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨ä½¿ç”¨ <code>nextsame</code> åˆ°è¾¾ Any å€™é€‰è€…ï¼Œå› ä¸º <code>samewith</code> ä¸Šä½¿ç”¨çš„æ•°å­—ä¸æ˜¯ç´ æ•°ï¼Œè€Œæ˜¯å¶æ•°ã€‚</p>

<h2 id="wrapping-it-up">Wrapping It Up</h2>

<p>ä¸ºäº†æ•´ç†è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†è€ƒå¯Ÿå¦ä¸€ä¸ªé¢†åŸŸï¼Œæˆ‘ä»¬å­¦åˆ°çš„ä¾‹ç¨‹å¯ä»¥æ´¾ä¸Šç”¨åœºï¼šåŒ…è£…ä¸œè¥¿ï¼ä»¥ä¸‹æ˜¯ä»£ç ï¼š</p>

<pre><code class="language-perl6">use soft;

sub meower (\ãƒƒ, |c) {
    nextwith &quot;ğŸ± says {ãƒƒ}&quot;, |c when ãƒƒ.gist.contains: 'meow';
    nextsame
}

&amp;say.wrap: &amp;meower;
say 'chirp';
say 'moo';
say 'meows!';

# OUTPUT:
# chirp
# moo
# ğŸ± says meows!
</code></pre>

<p>æˆ‘ä»¬ä½¿ç”¨ <code>soft</code> pragma æ¥ç¦æ­¢å†…è”ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„åŒ…è£…æ˜¯ç†æ™ºçš„ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>meower</code> sub æ¥ä¿®æ”¹ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœå®ƒ .contains å•è¯ <code>meow</code>ï¼Œä¼ é€’å…¶ä½™çš„å‚æ•°ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œé€šè¿‡ä¸€ä¸ª <a href="https://docs.perl6.org/type/Capture">Capture</a>ï¼ˆå°±æ˜¯ <code>|c</code> è¿™ä¸ªä¸œè¥¿ï¼‰æœªä¿®æ”¹ã€‚æ‰€æœ‰å‰©ä¸‹çš„è°ƒç”¨éƒ½æ˜¯ä½¿ç”¨ <code>nextsame</code> åŸæ ·ä¼ é€’çš„ï¼Œæˆ‘ä»¬ <strong>.wrap</strong> <code>meower</code> åˆ° <code>say</code> ç¨‹åºä¸Šï¼Œä»è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œä¸€åˆ‡éƒ½æŒ‰ç…§æˆ‘ä»¬çš„æ„æ„¿å·¥ä½œã€‚</p>

<p>è¿™æ˜¯ä»£ç çš„ä¸»è¦åŠŸèƒ½ï¼š<code>meower</code> <strong>ä¸çŸ¥é“ä»€ä¹ˆ sub è¢«åŒ…è£…äº†ï¼</strong> ç„¶è€Œï¼Œå®ƒä»ç„¶å¯ä»¥åœ¨ä¸å‘ç”Ÿé—®é¢˜çš„æƒ…å†µä¸‹è®¾æ³•è°ƒç”¨å®ƒã€‚</p>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨ <a href="https://docs.perl6.org/routine/put">put</a> ä¾‹ç¨‹ä¸Šï¼Œè€Œä¸”å®ƒæ²¡æœ‰ä»»ä½•ä¿®æ”¹å°±å¯ä»¥æ­£å¸¸å·¥ä½œï¼š</p>

<pre><code class="language-perl6">use soft;

sub meower (\ãƒƒ, |c) {
    nextwith &quot;ğŸ± says {ãƒƒ}&quot;, |c when ãƒƒ.gist.contains: 'meow';
    nextsame
}

&amp;put.wrap: &amp;meower;
put 'chirp';
put 'moo';
put 'meows!';

# OUTPUT:
# chirp
# moo
# ğŸ± says meows!
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å­¦åˆ°äº†ä¸€äº›å¼ºå¤§çš„ä¾‹ç¨‹ï¼Œè®©æ‚¨å¯ä»¥ä»å…¶ä»–å€™é€‰è€…ä¸­é‡ç”¨ç°æœ‰çš„å¤šä¸ªå€™é€‰è€…ã€‚ <code>callsame</code> å’Œ <code>callwith</code> å…è®¸æ‚¨è°ƒç”¨å½“å‰è°ƒåº¦é“¾ä¸­çš„ä¸‹ä¸€ä¸ªåŒ¹é…å€™é€‰è€…ï¼Œä½¿ç”¨ç›¸åŒçš„å‚æ•°æˆ–æ–°é›†åˆã€‚<code>nextsame</code> å’Œ <code>nextwith</code> å®ŒæˆåŒæ ·çš„äº‹æƒ…ï¼Œè€Œä¸è¿”å›åˆ°è°ƒç”¨ç°åœºã€‚</p>

<p><code>samewith</code> å­è®©æ‚¨ä»å¤´å¼€å§‹é‡æ–°å¯åŠ¨è°ƒåº¦é“¾ï¼Œè€Œæ— éœ€çŸ¥é“å½“å‰ä¾‹ç¨‹çš„åç§°ã€‚è€Œ <code>lastcall</code> å’Œ <code>nextcallee</code> å¯ä»¥é€šè¿‡æˆªæ–­å½“å‰çš„è°ƒåº¦é“¾ï¼Œæˆ–è€…ç§»å‡ºå’Œæ“ä½œä¸‹ä¸€ä¸ªè¢«è°ƒç”¨è€…æ¥æ“ä½œå½“å‰çš„è°ƒåº¦é“¾ã€‚</p>

<p>å¥½å¥½ä½¿ç”¨å®ƒä»¬å§ï¼</p>

<p>-Ofun</p>

<p>åŸæ–‡ï¼š</p>

<p><a href="https://rakudo.party/post/Perl6-But-Heres-My-Dispatch-So-Callwith-Maybe">Perl6-But-Heres-My-Dispatch-So-Callwith-Maybe</a></p>


        
          <div class="blog-tags">
            
              <a href="https://ohmysummer.github.io//tags/nextwith/">nextwith</a>&nbsp;
            
              <a href="https://ohmysummer.github.io//tags/nextsame/">nextsame</a>&nbsp;
            
              <a href="https://ohmysummer.github.io//tags/samewith/">samewith</a>&nbsp;
            
              <a href="https://ohmysummer.github.io//tags/callwith/">callwith</a>&nbsp;
            
              <a href="https://ohmysummer.github.io//tags/callsame/">callsame</a>&nbsp;
            
              <a href="https://ohmysummer.github.io//tags/nextcallee/">nextcallee</a>&nbsp;
            
              <a href="https://ohmysummer.github.io//tags/lastcall/">lastcall</a>&nbsp;
            
          </div>
        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://ohmysummer.github.io/post/2017-03-18-regexes/" data-toggle="tooltip" data-placement="top" title="Regexes">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://ohmysummer.github.io/post/2017-05-19-sheet/" data-toggle="tooltip" data-placement="top" title="Perl 6 Sheet">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ohmysummer" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            
            <a href="https://ohmysummer.github.io/index.xml" title="RSS">
            
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://ohmysummer.github.io/">ç„‰çŸ¥éé±¼</a>
            
          

          <span style="color: red;">â¤</span>&nbsp;Perl 6
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.53</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://ohmysummer.github.io/js/main.js"></script>
<script src="https://ohmysummer.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="https://ohmysummer.github.io/js/load-photoswipe.js"></script>


<script>
  (function() {
    var cx = '009072066163920799339:qwme9vkotxk';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>





  </body>
</html>

