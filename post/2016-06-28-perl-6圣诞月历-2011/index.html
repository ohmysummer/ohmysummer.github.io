<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="ohmysummer">
    <meta name="description" content="ohmysummer&#39;s personal website">
    <meta name="keywords" content="Perl6,Rakudo">

    <base href="http://ohmysummer.github.io/">
    <title>
  Perl 6 圣诞月历-(2011) · 焉知非鱼
</title>

    <link rel="canonical" href="http://ohmysummer.github.io/post/2016-06-28-perl-6%E5%9C%A3%E8%AF%9E%E6%9C%88%E5%8E%86-2011/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.cd087ace86754b082dec94545567f8361cba42e84f8e15edbc4a9f6e52bd1f6a.css" integrity="sha256-zQh6zoZ1Swgt7JRUVWf4Nhy6QuhPjhXtvEqfblK9H2o=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://ohmysummer.github.io/css/style.css">
    

    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://ohmysummer.github.io/">
      焉知非鱼
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/post">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/page/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags">标签</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Perl 6 圣诞月历-(2011)</h1>
    </header>

    

<h1 id="2011">2011</h1>

<hr />

<h2 id="the-flip-flop-operator">The Flip-Flop operator</h2>

<hr />

<p>Perl5有一个二元操作符叫做flip-flop,它为假直到它的第一个参数被计算为真，然后它保持真(反转)，直到第二个参数计算为真，然后在那里它又变成假(flop)。 这真是太有用了，以至于Perl6也有flip-flop,只是它拼写为ff,并有一些变异：</p>

<pre><code class="language-perl6">    ff
    ff^
    ^ff
    ^ff^
</code></pre>

<p>音调符号^意味着在那个结尾跳过结尾。
…或许一些例子更能说明问题…</p>

<pre><code class="language-perl6">for 1..20 { .say if $_ == 9  ff  $_ == 13; }     # 9 10 11 12 13
for 1..20 { .say if $_ == 9  ff^ $_ == 13; }     # 9 10 11 12
for 1..20 { .say if $_ == 9 ^ff  $_ == 13; }     # 10 11 12 13
for 1..20 { .say if $_ == 9 ^ff^ $_ == 13; }     # 10 11 12
</code></pre>

<p>每个例子中，我们遍历从1到20的数字范围，并且在flip-flop返回真时输出那些数字。每次循环中，flip-flop 操作符的左边(<code>$_ == 9</code>) 和 flip-flop操作符的右边 (<code>$_ == 13</code>)都会被计算。 (这里我已经在 flip-flop操作符的两侧使用了简单的数字比较，但是，一般任何布尔表达式都能使用。</p>

<p>每个 flip-flop 操作符的实例维护它们的内部状态以决定什么时候返回TRUE或False.所有的flip-flop操作符在它们的内部状态被设置为返回False时出现，直到它们被反转然后开始返回 TRUE.</p>

<p>在第一个和第二个例子中，当<code>$_ == 9</code> 时，flip-flop 操作符反转它们的内部状态为 TRUE ，然后立即返回 TRUE.在第三个和第四个例子中，当<code>$_== 9</code>时，flip-flop操作符将它们的内部状态设置为 TRUE,但是它们在那次遍历中返回 False ，因为前置的 ^符号。
类似地，在上面的第一个和第三个例子中，一旦RHS求值为真时， flip-flop操作符在下一次循环中将它们的内部状态反转回FALSE,然后返回True.在第三个和第四个例子中，flip-flop操作符在RHS返回真时立即反转为FALSE.
让flip-flop操作符反转但从不flop,在RHS上使用*：</p>

<pre><code class="language-perl6">    for 1..20 { .say if $_ == 15 ff *; }     # 15 16 17 18 19 20
</code></pre>

<p>Perl6有另外一套 flip-flop操作符，功能与上面提到的差不多，除了，在LHS变成真的时候，RHS不被求值。这很有用，当flip-flop操作符的RHS 和LHS 都同时求值为真的时候，These operators are spelled 这些操作符被拼写为  fff, fff^, ^fff, and ^fff^.</p>

<h2 id="idiomatic-perl-6">Idiomatic Perl 6</h2>

<hr />

<p>December 23, 2011</p>

<p>下面大多数的例子使用 4 种版本展示代码：</p>

<ul>
<li>Non-idiomatic Perl 5,</li>
<li>then made idiomatic.</li>
<li>Perl 5 idiom, naively translated into Perl 6,</li>
<li>then made idiomatic.</li>
</ul>

<p>从 1 到 4 越来越清晰和简洁</p>

<ul>
<li>随机选择数组元素</li>
</ul>

<pre><code class="language-perl6">$z = $array[ int(rand scalar(@array)) ];
$z = $array[ rand @array ];
</code></pre>

<pre><code class="language-perl6">$z = @array[ rand*@array ];
$z = @array.pick;
</code></pre>

<ul>
<li>循环遍历数组的键（索引）</li>
</ul>

<pre><code class="language-perl6">for ( my $i=0; $i&lt;@array; $i++ ) {...}
for my $i ( 0 .. $#array )       {...}
</code></pre>

<pre><code class="language-perl6">for 0 .. @array.end -&gt; $i {...}
for @array.keys -&gt; $i     {...}
</code></pre>

<ul>
<li>整除</li>
</ul>

<pre><code class="language-perl6">( ($x - ($x % 3) ) / 3 )
int( $x / 3 )
</code></pre>

<pre><code class="language-perl6">Int( $x / 3 )   # 首字母需大写
$x div 3        # 整除运算符
</code></pre>

<ul>
<li>打印数组元素的个数</li>
</ul>

<pre><code class="language-perl6">say scalar @array;
say 0+@array;
</code></pre>

<pre><code class="language-perl6">say 0+@array;          # Identical in Perl 6
say +@array;           # + 强制新的“数值”上下文
say @array.elems;      # .elems 方法更清楚.
</code></pre>

<ul>
<li>每隔5 次 做些事情</li>
</ul>

<pre><code class="language-perl6">if ( ($x/5) == int($x/5) ) {...}
if ( !($x % 5) )           {...}
</code></pre>

<pre><code class="language-perl6">if !($x % 5) {...}
if $x %% 5   {...}     # %% means &quot;is evenly divisible by&quot;
</code></pre>

<ul>
<li>Do something $n times, 直到 $n-1</li>
</ul>

<pre><code class="language-perl6">for ( $_=0; $_ &lt; $n; $_++ ) {...}
for ( 0 .. ($n-1) )         {...}
</code></pre>

<pre><code class="language-perl6">for 0 ..^ $n {...}
for ^$n      {...}     # ^9 means 0 ..^ 9, or 0..8
</code></pre>

<p>eg：</p>

<pre><code>&gt; .say for ^5
</code></pre>

<p>0
1
2
3
4</p>

<p>Bare method calls are <em>always</em> methods on $<em>, eliminating Perl 5&rsquo;s confusion on which functions default to $</em>.</p>

<ul>
<li>按空白分割</li>
</ul>

<pre><code class="language-perl6">@words = split /\s+/, $_;
@words = split;           # Default is useful, but not intuitive
</code></pre>

<pre><code class="language-perl6">@words = .split(/\s+/);  # split() 现在没有默认的模式
@words = .words;         # split 的旧的行为现在成为了一个单独的方法.words
</code></pre>

<ul>
<li>将字符串分割成单独的字符</li>
</ul>

<pre><code class="language-perl6">@chars = map { substr $word, $_, 1 } 0..length($word);
@chars = split '', $word;# Split on nothingness
</code></pre>

<pre><code class="language-perl6">@chars = $word.split('');
@chars = $word.comb;     # Default is to &quot;keep everything&quot;
</code></pre>

<p>eg：</p>

<pre><code class="language-perl6">&gt; my $word='Perl6'
Perl6
&gt; my @chars=$word.split('')
P e r l 6
&gt; my @chars=$word.split('').join('-&gt;')
P-&gt;e-&gt;r-&gt;l-&gt;6
&gt; my @chars=$word.comb
P e r l 6
&gt; my @chars=$word.comb.join(':')
P:e:r:l:6
</code></pre>

<ul>
<li>无限循环</li>
</ul>

<pre><code class="language-perl6">for (;;)  {...}    # Spoken with a 'C' accent
while (1) {...}
</code></pre>

<pre><code class="language-perl6">while 1   {...}
loop      {...}   # 没有给出限定条件，所以默认无止尽
</code></pre>

<ul>
<li>按原来的顺序返回列表中的唯一元素</li>
</ul>

<pre><code class="language-perl6">my %s, @r; for @a  { push @r, $_ if !$s{$_}; $s{$_}++; } return @r;
my %s; return grep { !$s{$_}++ } @a;    # or List::MoreUtils::uniq
</code></pre>

<pre><code class="language-perl6">my %s; return grep { !%s{$_}++ }, @a;
return @a.uniq;
</code></pre>

<ul>
<li>将列表中的所有元素求和</li>
</ul>

<pre><code class="language-perl6">my $sum = 0; for my $num (@a) { $sum += $num }
my $sum; $sum += $_ for @a;    # or List::Util::sum
</code></pre>

<pre><code class="language-perl6">my $sum = @a.reduce(*+*);
my $sum = [+] @a;              # [op] 将op操作符应用到整个列表
</code></pre>

<pre><code class="language-perl6">@alpha = 'A' .. 'Z';
@a = qw{ able baker charlie };
%meta = ( foo =&gt; 'bar', baz =&gt; 'quz' );
@squares = map { $_ * $_ }, @a;
@starts_with_number = grep { /^\d/ }, @a;
</code></pre>

<p>钻石操作符还在：</p>

<ul>
<li>Process each line from STDIN or from command-line files.</li>
</ul>

<pre><code class="language-perl6">for my $file (@ARGV) { open FH, $file; while (&lt;FH&gt;) {...} }
while (&lt;&gt;) {...}               # Null filehandle is magical
</code></pre>

<pre><code class="language-perl6">for $*ARGFILES.lines {...}
for lines()          {...}     # lines() defaults to $fh = $*ARGFILES
</code></pre>

<ul>
<li>将散列初始化为一个常量</li>
</ul>

<pre><code class="language-perl6">my %h;   for (@a) { $h{$_} = 1 }
my %h = map { $_ =&gt; 1 } @a;
</code></pre>

<pre><code class="language-perl6">my %h = map { $_ =&gt; 1 }, @a;
my %h = @a X=&gt; 1;
</code></pre>

<p>eg：</p>

<pre><code class="language-perl6">&gt; my @a=&lt;Perl Python Ruby Perl6&gt;
Perl Python Ruby Perl6
&gt; my %h= @a X=&gt; 1
(&quot;Perl&quot; =&gt; 1, &quot;Python&quot; =&gt; 1, &quot;Ruby&quot; =&gt; 1, &quot;Perl6&quot; =&gt; 1).hash
</code></pre>

<ul>
<li>Hash initialization for enumeration</li>
</ul>

<pre><code class="language-perl6">my %h;   for (0..$#a) { $h{ $a[$_] } = $_ }
my $c;   my %h = map  { $_ =&gt; ++$c } @a;
</code></pre>

<pre><code class="language-perl6">my $c;   my %h = map { $_ =&gt; ++$c }, @a;
(&quot;Perl&quot; =&gt; 1, &quot;Python&quot; =&gt; 2, &quot;Ruby&quot; =&gt; 3, &quot;Perl6&quot; =&gt; 4).hash
</code></pre>

<pre><code class="language-perl6">my %h = @a Z=&gt; 1..*;       # (&quot;Perl&quot; =&gt; 1, &quot;Python&quot; =&gt; 2, &quot;Ruby&quot; =&gt; 3, &quot;Perl6&quot; =&gt; 4).hash
my %h = @a.pairs».invert;  # if zero based , (&quot;Perl&quot; =&gt; 0, &quot;Python&quot; =&gt; 1, &quot;Ruby&quot; =&gt; 2, &quot;Perl6&quot; =&gt; 3).hash
</code></pre>

<blockquote>
<p>@a.pairs
0 =&gt; &ldquo;Perl&rdquo; 1 =&gt; &ldquo;Python&rdquo; 2 =&gt; &ldquo;Ruby&rdquo; 3 =&gt; &ldquo;Perl6&rdquo;</p>
</blockquote>

<ul>
<li>Hash initialization from parallel arrays</li>
</ul>

<pre><code class="language-perl6">my %h;   for (@a) { $h{$_} = shift @b }
my %h;   @h{@a} = @b;
</code></pre>

<pre><code class="language-perl6">my %h;   %h{@a} = @b;
my %h = @a Z=&gt; @b;
</code></pre>

<p>eg:</p>

<pre><code class="language-perl6">&gt; my @b=&lt;Larry Gao Mztiz Larry_Wall&gt;
Larry Gao Mztiz Larry_Wall
&gt; my %h= @a Z=&gt; @b
(&quot;Perl&quot; =&gt; &quot;Larry&quot;, &quot;Python&quot; =&gt; &quot;Gao&quot;, &quot;Ruby&quot; =&gt; &quot;Mztiz&quot;, &quot;Perl6&quot; =&gt; &quot;Larry_Wall&quot;).hash
</code></pre>

<ul>
<li>交换两个变量</li>
</ul>

<pre><code class="language-perl6">my $temp = $x; $x = $y; $y = $temp;
( $x, $y ) = ( $y, $x );
</code></pre>

<pre><code class="language-perl6"> ( $x, $y )  = $y, $x;
 ( $x, $y ) .= reverse;   # .= makes reverse into a &quot;mutating&quot; method
 # Tastes great on array swaps, too!   @a[ $j, $k ] .= reverse;
</code></pre>

<ul>
<li>Rotate array left by 1 element</li>
</ul>

<pre><code class="language-perl6">my $temp = shift @a; push @a, $temp;
push @a, shift @a;
</code></pre>

<pre><code class="language-perl6">@a.push: @a.shift;
@a .= rotate; # Python Ruby Perl6 Perl
</code></pre>

<ul>
<li>创建一个对象</li>
</ul>

<pre><code class="language-perl6">my $pet = new Dog;
my $pet = Dog-&gt;new;
</code></pre>

<pre><code class="language-perl6">my $pet = Dog.new;
my Dog $pet .= new;    # $pet *always* isa Dog; Compiler can optimize!
</code></pre>

<p>Combining transformation with selection was an advanced idiom in Perl 5. The new return values for if provide a bite-sized idiom.</p>

<ul>
<li>Three copies of elements &gt; 5</li>
</ul>

<pre><code class="language-perl6"> @z = map { ($_) x 3 } grep { $_ &gt; 5 } @y;    # map,grep
 @z = map { $_ &gt; 5 ? ($_) x 3 : () } @y;      # map as grep
</code></pre>

<pre><code class="language-perl6">@z = map { $_ &gt; 5 ?? ($_) xx 3 !! Nil }, @y;
@z = @y.map: { $_ xx 3 if $_ &gt; 5 };          # !if == Empty list
@z = ($_ xx 3 if $_ &gt; 5 for @y);             # List comprehension
</code></pre>

<ul>
<li>3到7之间的随机整数，包含3和7</li>
</ul>

<pre><code class="language-perl6">do { $z = int rand 8 } until $z &gt;= 3;
$z = 3 + int rand 5;
</code></pre>

<pre><code class="language-perl6">$z = 3 + Int(5.rand);
$z = (3..7).pick;
</code></pre>

<ul>
<li>在无限循环中每次循环加 3</li>
</ul>

<pre><code class="language-perl6">for ( my $i = 1; ; $i++ ) { my $n = 3 * $i; ... }
for ( my $n = 3; ; $n += 3 ) {...}
</code></pre>

<pre><code class="language-perl6">loop ( my $n = 3; ; $n += 3 ) {...}
for 3, * + 3 ... * -&gt; $n      {...}      # `...` is the &quot;sequence&quot; operator
for 3, 6, 9 ... * -&gt; $n       {...}      # `...` can infer from example list
</code></pre>

<ul>
<li>遍历区间, 不包含开始点和结束点</li>
</ul>

<pre><code class="language-perl6">for my $i ( $start .. $limit ) { next if $i == $start or $i == $limit; ... }
for my $i ( ($start+1) .. ($limit-1) ) {...}
</code></pre>

<pre><code class="language-perl6">for ($start+1) .. ($limit-1) -&gt; $i {...}
for $start    ^..^ $limit    -&gt; $i {...}
</code></pre>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>ohmysummer ❤ Perl 6</p>
    
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
