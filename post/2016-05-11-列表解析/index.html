<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="ohmysummer">
    <meta name="description" content="ohmysummer&#39;s personal website">
    <meta name="keywords" content="Perl6,Rakudo">

    <base href="http://ohmysummer.github.io/">
    <title>
  列表解析 · 焉知非鱼
</title>

    <link rel="canonical" href="http://ohmysummer.github.io/post/2016-05-11-%E5%88%97%E8%A1%A8%E8%A7%A3%E6%9E%90/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.cd087ace86754b082dec94545567f8361cba42e84f8e15edbc4a9f6e52bd1f6a.css" integrity="sha256-zQh6zoZ1Swgt7JRUVWf4Nhy6QuhPjhXtvEqfblK9H2o=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://ohmysummer.github.io/css/style.css">
    

    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://ohmysummer.github.io/">
      焉知非鱼
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/post">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/page/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags">标签</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>列表解析</h1>
    </header>

    

<h2 id="列表解析">列表解析</h2>

<p>列表解析即 List Comprehensions。</p>

<p>生成 <code>1x1, 2x2, 3x3, ..., 10x10</code> 的列表：</p>

<pre><code class="language-perl6">($_**2 for 1..10);
</code></pre>

<p><code>for</code> 语句前面还可以添加 if 修饰符，这样我们就可以仅筛选出偶数的平方：</p>

<pre><code class="language-perl6">($_**2 if !($_ % 2) for 1..10)
($_**2 if $_ % 2 == 1 for 1..10) # 同上
</code></pre>

<p>组合多个 if 条件:</p>

<pre><code class="language-perl6">my @list = ($_ if $_ %2 == 1 &amp;&amp; $_ &gt; 2 for 1..6 )     # [3 5]   
</code></pre>

<p>还可以生成全排列：</p>

<pre><code class="language-perl6">($_ for &quot;ABC&quot;.comb X~ &quot;XYZ&quot;.comb) # (&quot;AX&quot;, &quot;AY&quot;, &quot;AZ&quot;, &quot;BX&quot;, &quot;BY&quot;, &quot;BZ&quot;, &quot;CX&quot;, &quot;CY&quot;, &quot;CZ&quot;)

my @a = (1,3,4)                                                                       
my @b = (2,4,6)                                                                     
my @list = (@a X @b)    # 这儿也可以用圆括号, 也可以不用                                                      
# [(1 2) (1 4) (1 6) (3 2) (3 4) (3 6) (4 2) (4 4) (4 6)]
</code></pre>

<pre><code class="language-perl6">&gt; ($_ when /7$/ for 1..99)
(7 17 27 37 47 57 67 77 87 97)
</code></pre>

<p>大小写转换：</p>

<pre><code class="language-perl6">my @a = &lt;Hello World IBM Apple&gt;;
(.lc for @a)                # hello world ibm apple
</code></pre>

<p>删除字符串末尾的空白：</p>

<pre><code class="language-perl6">my @freshfruit = ' banana', ' loganberry ', 'passion fruit ';
(.trim for @freshfruit)     # &quot;banana&quot; &quot;loganberry&quot; &quot;passion fruit&quot;
</code></pre>

<p>向量运算：</p>

<pre><code class="language-perl6">my @vec = 2,4,6;
(3*$_ for @vec)                     # 6 12 18
(3*$_ if $_ &gt; 3 for @vec)   # 12 18
(3*$_ if $_ &lt; 2 for @vec)   # ()
</code></pre>

<p>嵌套数组：</p>

<pre><code class="language-perl6">my @vec = 2,4,6;
([$_, $_**2].perl for @vec)       # [2, 4] [4, 16] [6, 36]
([$_, $_**2].WHAT for @vec) # (Array) (Array) (Array)
</code></pre>

<p>Parcel:</p>

<pre><code class="language-perl6">(($_, $_**2).perl for @vec)       # (2, 4) (4, 16) (6, 36)
(($_, $_**2).WHAT for @vec) # (Parcel) (Parcel) (Parcel)
</code></pre>

<p>多个列表之间的列表解析</p>

<pre><code class="language-perl6">my @vec1 = 2,4,6;
my @vec2 = 4,3,-9;
($_ for @vec1 X* @vec2)           # 8 6 -18 16 12 -36 24 18 -54
($_ for @vec1 X+ @vec2)          # 5 -7 8 7 -5 10 9 -3
($_ for @vec1 Z* @vec2)           # 8 12 -54
($_ for @vec1 &gt;&gt;*&lt;&lt; @vec2)  # 8 12 -54
</code></pre>

<p>使用列表解析处理矩阵:</p>

<pre><code class="language-perl6">&gt; my @a = ([1,2,3], [4,5,6], [7,8,9]);
&gt; @a[0]                                    # 1 2 3
&gt; @a[0][1]                              # 2
&gt; @a[0][2]                             # 3
&gt; ($_[1] for @a)                   # 2 5 8
&gt; ($_[2] for @a)                  # 3 6 9
&gt; ($_[2]-1 for @a)               # 2 5 8
&gt; (@a[$_][$_] for 0..2)     # 1 5 9
</code></pre>

<p>矩阵转置</p>

<pre><code class="language-perl6">sub transpose (@m) {
    @m[0].keys.map: {[ @m»[$_] ]};
}

my @a = [&lt; a b c d e &gt;],
        [&lt; f g h i j &gt;],
        [&lt; k l m n o &gt;],
        [&lt; p q r s t &gt;];

(.say for @a.&amp;transpose);
</code></pre>

<pre><code class="language-perl">a f k p
b g l q
c h m r
d i n s
e j o t
</code></pre>

<p>一丢丢解释： <code>@m[0].keys</code> 获取 <code>column index</code> , 根据获取到的列索引, 使用超运算符 <code>»</code> 遍历数组中对应列索引位置的元素。注意 <code>[]</code> 实际上是后缀操作符, 原来使用 <code>».[]</code> 的语法是错误的。</p>

<p>使用 gather 进行列表解析：</p>

<pre><code class="language-perl6">my @s = gather { for ^100 { take 2 * $_ if $_ ** 2 &gt; 3 } };
</code></pre>

<pre><code class="language-perl6"># 1到20之间哪些数字组成直角？
my $n = 20;
my @a = gather for 1..$n -&gt; $x {
         for $x..$n -&gt; $y {
           for $y..$n -&gt; $z {
             take $x,$y,$z if $x*$x + $y*$y == $z*$z;
           }
         }
       };
say &quot;@a[]&quot;;

# 3 4 5 5 12 13 6 8 10 8 15 17 9 12 15 12 16 20       
</code></pre>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>ohmysummer ❤ Perl 6</p>
    
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
