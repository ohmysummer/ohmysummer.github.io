<!DOCTYPE html>
<html lang="zh" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>第二十四天 - 使用 Raku 进行主题建模 - Raku Programming</title>
  <meta name="description" content="嗨，大家好。">
  <meta name="author" content="焉知非鱼"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Raku Programming",
    
    "url": "https:\/\/ohmysummer.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/ohmysummer.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/ohmysummer.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/ohmysummer.github.io\/post\/what-is-advent\/",
          "name": "第二十四天 使用 raku 进行主题建模"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "焉知非鱼"
  },
  "headline": "第二十四天 - 使用 Raku 进行主题建模",
  "description" : "嗨，大家好。",
  "inLanguage" : "zh",
  "wordCount":  3113 ,
  "datePublished" : "2018-12-24T08:09:24",
  "dateModified" : "2018-12-24T08:09:24",
  "image" : "https:\/\/ohmysummer.github.io\/img\/rakudo.png",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/ohmysummer.github.io\/post\/what-is-advent\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/ohmysummer.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/ohmysummer.github.io\/img\/rakudo.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="第二十四天 - 使用 Raku 进行主题建模" />
<meta property="og:description" content="嗨，大家好。">
<meta property="og:image" content="https://ohmysummer.github.io/img/rakudo.png" />
<meta property="og:url" content="https://ohmysummer.github.io/post/what-is-advent/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Raku Programming" />

  <meta name="twitter:title" content="第二十四天 - 使用 Raku 进行主题建模" />
  <meta name="twitter:description" content="嗨，大家好。">
  <meta name="twitter:image" content="https://ohmysummer.github.io/img/rakudo.png" />
  <meta name="twitter:card" content="summary" />
  <link href='https://ohmysummer.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.63.2" />
  <link rel="alternate" href="https://ohmysummer.github.io/index.xml" type="application/rss+xml" title="Raku Programming"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://ohmysummer.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://ohmysummer.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://ohmysummer.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'ohmycloudy', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://ohmysummer.github.io/">Raku Programming</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="博客" href="/">博客</a>
            </li>
          
        
          
            <li>
              <a title="归档" href="/categories">归档</a>
            </li>
          
        
          
            <li>
              <a title="关于" href="/page/about/">关于</a>
            </li>
          
        
          
            <li>
              <a title="标签" href="/tags">标签</a>
            </li>
          
        

        

        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg"></span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Raku Programming" href="https://ohmysummer.github.io/">
            <img class="avatar-img" src="https://ohmysummer.github.io/img/rakudo.png" alt="Raku Programming" />
          </a>
        </div>
      </div>
    

  </div>
</nav>



  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title"></h4>
        </div>
        <div class="modal-body">
          <gcse:search></gcse:search>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal"></button>
        </div>
      </div>
    </div>
  </div>


    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>第二十四天 - 使用 Raku 进行主题建模</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;15&nbsp;
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;3113&nbsp;
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;焉知非鱼
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>嗨，大家好。</p>
<p>今天，让我介绍<a href="https://github.com/titsuki/p6-Algorithm-LDA">Algorithm :: LDA</a>。
该模块是用于主题建模的Latent Dirichlet Allocation（即LDA）实现。</p>
<h1 id="介绍">介绍</h1>
<p>什么是LDA？LDA是一种流行的无监督机器学习方法。
它模拟文档生成过程，并将每个文档表示为主题的混合。</p>
<p>那么，“混合主题”是什么意思呢？图1显示了一篇文章，其中一些单词以三种颜色突出显示：黄色，粉红色和蓝色。关于遗传学的词语用黄色标出; 关于进化生物学的文字用粉红色标出; 有关数据分析的文字标有蓝色。想象一下，本文中的所有单词都是彩色的，然后我们可以将这篇文章表示为主题（即颜色）的混合。</p>
<p>图1 :( 此图片来自“概率主题模型”。（David Blei 2012））
<a href="https://camo.githubusercontent.com/464a19ca7cf15ea83e712cd8145afacc46c55cae/68747470733a2f2f7065726c36616476656e742e66696c65732e776f726470726573732e636f6d2f323031382f31322f73637265656e73686f742d66726f6d2d323031382d31322d31302d30302d31342d33312e706e673f773d363830"><img src="https://camo.githubusercontent.com/464a19ca7cf15ea83e712cd8145afacc46c55cae/68747470733a2f2f7065726c36616476656e742e66696c65732e776f726470726573732e636f6d2f323031382f31322f73637265656e73686f742d66726f6d2d323031382d31322d31302d30302d31342d33312e706e673f773d363830" alt="图。1"></a></p>
<p>好的，那么我将在下一节中演示如何使用Algorithm :: LDA。</p>
<h1 id="建模报价">建模报价</h1>
<p>在本文中，我们将探索<a href="https://www.wikiquote.org/">Wikiquote</a>。Wikiquote是一个提供源代码报价的云源平台。
通过使用Wikiquote API，我们获得用于LDA估计的报价。之后，我们执行LDA并绘制结果。
最后，我们使用生成的模型创建信息检索应用程序。</p>
<h2 id="初步">初步</h2>
<h3 id="wikiquote-api">Wikiquote API</h3>
<p>Wikiquote具有<a href="https://en.wikiquote.org/w/api.php?action=help&amp;modules=query">动作API</a>，提供获取Wikiquote资源的方法。
例如，您可以按如下方式获取主页面的内容：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ curl <span class="s2">&#34;https://en.wikiquote.org/w/api.php?action=query&amp;prop=revisions&amp;titles=Main%20Page&amp;rvprop=content&amp;format=json&#34;</span>
</code></pre></div><p>上述命令的结果是：</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">{&#34;batchcomplete&#34;:&#34;&#34;,&#34;warnings&#34;:{&#34;main&#34;:{&#34;*&#34;:&#34;Subscribe to the mediawiki-api-announce mailing list at <span class="p">&lt;</span><span class="nt">https:</span><span class="err">/</span><span class="err">/</span><span class="na">lists</span><span class="err">.</span><span class="na">wikimedia</span><span class="err">.</span><span class="na">org</span><span class="err">/</span><span class="na">mailman</span><span class="err">/</span><span class="na">listinfo</span><span class="err">/</span><span class="na">mediawiki-api-announce</span><span class="p"></span><span class="p">&gt;</span> for notice of API deprecations and breaking changes. Use [[Special:ApiFeatureUsage]] to see usage of deprecated features by your application.&#34;},&#34;revisions&#34;:{&#34;*&#34;:&#34;Because \&#34;rvslots\&#34; was not specified, a legacy format has been used for the output. This format is deprecated, and in the future the new format will always be used.&#34;}},&#34;query&#34;:{&#34;pages&#34;:{&#34;1&#34;:{&#34;pageid&#34;:1,&#34;ns&#34;:0,&#34;title&#34;:&#34;Main Page&#34;,&#34;revisions&#34;:[{&#34;contentformat&#34;:&#34;text/x-wiki&#34;,&#34;contentmodel&#34;:&#34;wikitext&#34;,&#34;*&#34;:&#34;\n
{{Main page header}}
\n
{{Main Page Quote of the day}}
\n<span class="p">&lt;</span><span class="p">/</span><span class="nt">div</span><span class="p">&gt;</span>\n\n \n{{Main Page Selected pages}}\n{{Main categories}}\n\n\n \n{{New pages}}\n{{Main Page Community}}\n\n\n\n==Wikiquote&#39;s sister projects==\n{{otherwiki}}\n\n==Wikiquote languages==\n{{Wikiquotelang}}\n\n__NOTOC__ __NOEDITSECTION__\n{{noexternallanglinks:ang|simple}}\n[[Category:Main page]]&#34;}]}}}}
</code></pre></div><h3 id="www">WWW</h3>
<p><a href="https://github.com/zoffixznet/raku-WWW">WWW</a>通过Zoffix Znet是它提供了易于使用的API，包括获取和解析JSON非常简单的库。
例如，正如README所说，您可以轻松地按<code>jget(URL)&lt;HASHKEY&gt;</code>样式获取内容：</p>
<pre><code class="language-raku" data-lang="raku">say jget('https://httpbin.org/get?foo=42&amp;bar=x')&lt;args&gt;&lt;foo&gt;;
</code></pre><p>要安装WWW：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">zef install WWW
</code></pre></div><h3 id="chartgnuplot">Chart::Gnuplot</h3>
<p><a href="https://github.com/titsuki/p6-Chart-Gnuplot">Chart::Gnuplot</a> by titsuki是<a href="http://www.gnuplot.info/">gnuplot</a>的绑定。</p>
<p>要安装 Chart::Gnuplot：</p>
<pre><code>$ zef install Chart::Gnuplot
</code></pre><p>在本文中，我们使用此模块; 但是，如果你不熟悉gnuplot，有很多选择：<a href="https://github.com/moritz/svg-plot">SVG::Plot</a>，<a href="https://github.com/azawawi/raku-graphics-plplot">Graphics::PLplot</a>，<a href="https://0racle.info/articles/matplotlib_in_p6_intro">通过Inline::Python调用matplotlib函数</a>。</p>
<h3 id="来自nltk的stopwords">来自NLTK的Stopwords</h3>
<p>NLTK是一个用于自然语言处理的工具包。
不仅是 API，它还提供语料库。
您可以通过“70”获得英语的停用词。关键词语料库“：<a href="http://www.nltk.org/nltk_data/">http</a>：//www.nltk.org/nltk_data/</p>
<h2 id="练习1获取报价并创建已清理的文档">练习1：获取报价并创建已清理的文档</h2>
<p>一开始，我们必须从Wikiquote获取引用并创建干净的文档。</p>
<p>本部分的主要目标是根据以下格式创建文档：</p>
<pre><code>&lt;docid&gt; &lt;personid&gt; &lt;word&gt; &lt;word&gt; &lt;word&gt; ...
&lt;docid&gt; &lt;personid&gt; &lt;word&gt; &lt;word&gt; &lt;word&gt; ...
&lt;docid&gt; &lt;personid&gt; &lt;word&gt; &lt;word&gt; &lt;word&gt; ...
</code></pre><p>整个源代码是：</p>
<pre><code class="language-raku" data-lang="raku">use v6.c;
use WWW;
use URI::Escape;

sub get-members-from-category(Str $category --&gt; List) {
    my $member-url = &quot;https://en.wikiquote.org/w/api.php?action=query&amp;list=categorymembers&amp;cmtitle={$category}&amp;cmlimit=100&amp;format=json&quot;;
    @(jget($member-url)&lt;query&gt;&lt;categorymembers&gt;.map(*&lt;title&gt;));
}

sub get-pages(Str @members, Int $batch = 50 --&gt; List) {
    my Int $start = 0;
    my @pages;
    while $start &lt; @members {
        my $list = @members[$start..^List($start + $batch, +@members).min].map({ uri_escape($_) }).join('%7C');
        my $url = &quot;https://en.wikiquote.org/w/api.php?action=query&amp;prop=revisions&amp;rvprop=content&amp;format=json&amp;formatversion=2&amp;titles={$list}&quot;;
        @pages.push($_) for jget($url)&lt;query&gt;&lt;pages&gt;.map({ %(body =&gt; .&lt;revisions&gt;[0]&lt;content&gt;, title =&gt; .&lt;title&gt;) });
        $start += $batch;
    }
    @pages;
}

sub create-documents-from-pages(@pages, @members --&gt; List) {
    my @documents;
    for @pages -&gt; $page {
        my @quotations = $page&lt;body&gt;.split(&quot;\n&quot;)\
        .map(*.subst(/\[\[$&lt;text&gt;=(&lt;-[\[\]|]&gt;+?)\|$&lt;link&gt;=(&lt;-[\[\]|]&gt;+?)\]\]/, { $&lt;text&gt; }, :g))\
        .map(*.subst(/\[\[$&lt;text&gt;=(&lt;-[\[\]|]&gt;+?)\]\]/, { $&lt;text&gt; }, :g))\
        .map(*.subst(&quot;[&quot;, &quot;[&quot;, :g))\
        .map(*.subst(&quot;]&quot;, &quot;]&quot;, :g))\
        .map(*.subst(&quot;&amp;amp;&quot;, &quot;&amp;&quot;, :g))\
        .map(*.subst(&quot;&amp;nbsp;&quot;, &quot;&quot;, :g))\
        .map(*.subst(/:i [ \&lt;\/?\s?br\&gt; | \&lt;br\s?\/?\&gt; ]/, &quot; &quot;, :g))\
        .grep(/^\*&lt;-[*]&gt;/)\
        .map(*.subst(/^\*\s+/, &quot;&quot;));

        # Note: The order of array wikiquote API returned is agnostic.
        my Int $index = @members.pairs.grep({ .value eq $page&lt;title&gt; }).map(*.key).head;
        @documents.push(%(body =&gt; $_, personid =&gt; $index)) for @quotations;
    }
    @documents.sort({ $^a&lt;personid&gt; &lt;=&gt; $^b&lt;personid&gt; }).pairs.map({ %(docid =&gt; .key, personid =&gt; .value&lt;personid&gt;, body =&gt; .value&lt;body&gt;) }).list
}

my Str @members = get-members-from-category(&quot;Category:1954_births&quot;);
my @pages = get-pages(@members);
my @documents = create-documents-from-pages(@pages, @members);

my $docfh = open &quot;documents.txt&quot;, :w;
$docfh.say((.&lt;docid&gt;, .&lt;personid&gt;, .&lt;body&gt;).join(&quot; &quot;)) for @documents;
$docfh.close;

my $memfh = open &quot;members.txt&quot;, :w;
$memfh.say($_) for @members;
$memfh.close;
</code></pre><p>首先，我们获得“Category：1954births”页面中列出的成员。我选择了Raku设计师诞生的那一年：</p>
<pre><code class="language-raku" data-lang="raku">my Str @members = get-members-from-category(&quot;Category:1954_births&quot;);
</code></pre><p>其中，<code>get-members-from-category</code>通过维基语录API获取成员：</p>
<pre><code class="language-raku" data-lang="raku">sub get-members-from-category(Str $category --&gt; List) {
    my $member-url = &quot;https://en.wikiquote.org/w/api.php?action=query&amp;list=categorymembers&amp;cmtitle={$category}&amp;cmlimit=100&amp;format=json&quot;;
    @(jget($member-url)&lt;query&gt;&lt;categorymembers&gt;.map(*&lt;title&gt;));
}
</code></pre><p>接下来，调用<code>get-pages</code>：</p>
<pre><code class="language-raku" data-lang="raku">my @pages = get-pages(@members);
</code></pre><p><code>get-pages</code> 获取给定标题（即成员）页面的子例程：</p>
<pre><code class="language-raku" data-lang="raku">sub get-pages(Str @members, Int $batch = 50 --&gt; List) {
    my Int $start = 0;
    my @pages;
    while $start &lt; @members {
        my $list = @members[$start..^List($start + $batch, +@members).min].map({ uri_escape($_) }).join('%7C');
        my $url = &quot;https://en.wikiquote.org/w/api.php?action=query&amp;prop=revisions&amp;rvprop=content&amp;format=json&amp;formatversion=2&amp;titles={$list}&quot;;
        @pages.push($_) for jget($url)&lt;query&gt;&lt;pages&gt;.map({ %(body =&gt; .&lt;revisions&gt;[0]&lt;content&gt;, title =&gt; .&lt;title&gt;) });
        $start += $batch;
    }
    @pages;
}
</code></pre><p>其中<code>@members[$start..^List($start + $batch, +@members).min]</code>是一段长度<code>$batch</code>，并且切片的元素由百分比编码<code>uri_escase</code>和联合<code>%7C</code>（即，编码的管道符号百分比）。
在这种情况下，结果之一<code>$list</code>是</p>
<pre><code>Mumia%20Abu-Jamal%7CRene%20Balcer%7CIain%20Banks%7CGerard%20Batten%7CChristie%20Brinkley%7CJames%20Cameron%20%28director%29%7CEugene%20Chadbourne%7CJackie%20Chan%7CChang%20Yu-hern%7CLee%20Child%7CHugo%20Ch%C3%A1vez%7CDon%20Coscarelli%7CElvis%20Costello%7CDaayiee%20Abdullah%7CThomas%20H.%20Davenport%7CGerardine%20DeSanctis%7CAl%20Di%20Meola%7CKevin%20Dockery%20%28author%29%7CJohn%20Doe%20%28musician%29%7CF.%20J.%20Duarte%7CIain%20Duncan%20Smith%7CHerm%20Edwards%7CAbdel%20Fattah%20el-Sisi%7CRob%20Enderle%7CRecep%20Tayyip%20Erdo%C4%9Fan%7CAlejandro%20Pe%C3%B1a%20Esclusa%7CHarvey%20Fierstein%7CCarly%20Fiorina%7CGary%20L.%20Francione%7CAshrita%20Furman%7CMary%20Gaitskill%7CGeorge%20Galloway%7C%C5%BDeljko%20Glasnovi%C4%87%7CGary%20Hamel%7CFran%C3%A7ois%20Hollande%7CKazuo%20Ishiguro%7CJean-Claude%20Juncker%7CAnish%20Kapoor%7CGuy%20Kawasaki%7CRobert%20Francis%20Kennedy%2C%20Jr.%7CLawrence%20M.%20Krauss%7CAnatoly%20Kudryavitsky%7CAnne%20Lamott%7CJoep%20Lange%7CAng%20Lee%7CLi%20Bin%7CRay%20Liotta%7CPeter%20Lipton%7CJames%20D.%20Macdonald%7CKen%20MacLeod
</code></pre><p>请注意，<code>get-pages</code>子例程使用哈希上下文相关器<code>%()</code>来创建哈希序列：</p>
<pre><code class="language-raku" data-lang="raku">@pages.push($_) for jget($url)&lt;query&gt;&lt;pages&gt;.map({ %(body =&gt; .&lt;revisions&gt;[0]&lt;content&gt;, title =&gt; .&lt;title&gt;) });
</code></pre><p>在那之后，我们调用 <code>create-documents-from-pages</code>：</p>
<pre><code class="language-raku" data-lang="raku">my @documents = create-documents-from-pages(@pages, @members);
</code></pre><p><code>create-documents-from-pages</code> 从每个页面创建文档：</p>
<pre><code class="language-raku" data-lang="raku">sub create-documents-from-pages(@pages, @members --&gt; List) {
    my @documents;
    for @pages -&gt; $page {
        my @quotations = $page&lt;body&gt;.split(&quot;\n&quot;)\
        .map(*.subst(/\[\[$&lt;text&gt;=(&lt;-[\[\]|]&gt;+?)\|$&lt;link&gt;=(&lt;-[\[\]|]&gt;+?)\]\]/, { $&lt;text&gt; }, :g))\
        .map(*.subst(/\[\[$&lt;text&gt;=(&lt;-[\[\]|]&gt;+?)\]\]/, { $&lt;text&gt; }, :g))\
        .map(*.subst(&quot;[&quot;, &quot;[&quot;, :g))\
        .map(*.subst(&quot;]&quot;, &quot;]&quot;, :g))\
        .map(*.subst(&quot;&amp;amp;&quot;, &quot;&amp;&quot;, :g))\
        .map(*.subst(&quot;&amp;nbsp;&quot;, &quot;&quot;, :g))\
        .map(*.subst(/:i [ \&lt;\/?\s?br\&gt; | \&lt;br\s?\/?\&gt; ]/, &quot; &quot;, :g))\
        .grep(/^\*&lt;-[*]&gt;/)\
        .map(*.subst(/^\*\s+/, &quot;&quot;));

        # Note: The order of array wikiquote API returned is agnostic.
        my Int $index = @members.pairs.grep({ .value eq $page&lt;title&gt; }).map(*.key).head;
        @documents.push(%(body =&gt; $_, personid =&gt; $index)) for @quotations;
    }
    @documents.sort({ $^a&lt;personid&gt; &lt;=&gt; $^b&lt;personid&gt; }).pairs.map({ %(docid =&gt; .key, personid =&gt; .value&lt;personid&gt;, body =&gt; .value&lt;body&gt;) }).list
}
</code></pre><p>其中<code>.map(*.subst(/\[\[$&lt;text&gt;=(&lt;-[\[\]|]&gt;+?)\|$&lt;link&gt;=(&lt;-[\[\]|]&gt;+?)\]\]/, { $&lt;text&gt; }, :g))</code>和<code>.map(*.subst(/\[\[$&lt;text&gt;=(&lt;-[\[\]|]&gt;+?)\]\]/, { $&lt;text&gt; }, :g))</code>是隐藏命令，提取文本以显示和删除文本，以便从锚文本进行内部链接。例如，<code>[[Perl]]</code>被缩减为<code>Perl</code>。有关更多语法信息，请参阅：<a href="https://docs.raku.org/language/regexes#Named_captures">https</a>：<a href="https://docs.raku.org/language/regexes#Named_captures">//docs.raku.org/language/regexes#Named_captures</a>或<a href="https://docs.raku.org/routine/subst">https://docs.raku.org/routine/subst</a></p>
<p>经过一些清理操作（.eg，<code>.map(*.subst(&quot;[&quot;, &quot;[&quot;, :g))</code>）后，我们提取引号线。</p>
<p><code>.grep(/^\*&lt;-[*]&gt;/)</code>查找以单星号开头的行，因为大多数引号都出现在这种行中。</p>
<p>接下来，<code>.map(*.subst(/^\*\s+/, &quot;&quot;))</code>删除每个星号，因为星号本身不是每个报价的组成部分。</p>
<p>最后，我们保存文档和成员（即标题）：</p>
<pre><code class="language-raku" data-lang="raku">my $docfh = open &quot;documents.txt&quot;, :w;
$docfh.say((.&lt;docid&gt;, .&lt;personid&gt;, .&lt;body&gt;).join(&quot; &quot;)) for @documents;
$docfh.close;

my $memfh = open &quot;members.txt&quot;, :w;
$memfh.say($_) for @members;
$memfh.close;
</code></pre><h2 id="练习2执行lda并可视化结果">练习2：执行LDA并可视化结果</h2>
<p>在上一节中，我们保存了已清理的文档。
在本节中，我们使用文档进行LDA估计并将结果可视化。
本部分的目标是绘制文档主题分布并编写主题词表。</p>
<p>整个源代码是：</p>
<pre><code class="language-raku" data-lang="raku">use v6.c;
use Algorithm::LDA;
use Algorithm::LDA::Formatter;
use Algorithm::LDA::LDAModel;
use Chart::Gnuplot;
use Chart::Gnuplot::Subset;

sub create-model(@documents --&gt; Algorithm::LDA::LDAModel) {
    my $stopwords = &quot;stopwords/english&quot;.IO.lines.Set;
    my &amp;tokenizer = -&gt; $line { $line.words.map(*.lc).grep(-&gt; $w { ($stopwords !(cont) $w) and $w !~~ /^[ &lt;:S&gt; | &lt;:P&gt; ]+$/ }) };
    my ($documents, $vocabs) = Algorithm::LDA::Formatter.from-plain(@documents.map({ my ($, $, *@body) = .words; @body.join(&quot; &quot;) }), &amp;tokenizer);
    my Algorithm::LDA $lda .= new(:$documents, :$vocabs);
    my Algorithm::LDA::LDAModel $model = $lda.fit(:num-topics(10), :num-iterations(500), :seed(2018));
    $model
}

sub plot-topic-distribution($model, @members, @documents, $search-regex = rx/Larry/) {
    my $target-personid = @members.pairs.grep({ .value ~~ $search-regex }).map(*.key).head;
    my $docid = @documents.map({ my ($docid, $personid, *@body) = .words; %(docid =&gt; $docid, personid =&gt; $personid, body =&gt; @body.join(&quot; &quot;)) })\
    .grep({ .&lt;personid&gt; == $target-personid and .&lt;body&gt; ~~ /:i &lt;&lt; perl &gt;&gt;/}).map(*&lt;docid&gt;).head;

    note(&quot;@documents[$docid] is selected&quot;);
    my ($row-size, $col-size) = $model.document-topic-matrix.shape;
    my @doc-topic = gather for ($docid X ^$col-size) -&gt; ($i, $j) { take $model.document-topic-matrix[$i;$j]; }
    my Chart::Gnuplot $gnu .= new(:terminal(&quot;png&quot;), :filename(&quot;topics.png&quot;));
    $gnu.command(&quot;set boxwidth 0.5 relative&quot;);
    my AnyTicsTic @tics = @doc-topic.pairs.map({ %(:label(.key), :pos(.key)) });
    $gnu.legend(:off);
    $gnu.xlabel(:label(&quot;Topic&quot;));
    $gnu.ylabel(:label(&quot;P(z|theta,d)&quot;));
    $gnu.xtics(:tics(@tics));
    $gnu.plot(:vertices(@doc-topic.pairs.map({ @(.key, .value.exp) })), :style(&quot;boxes&quot;), :fill(&quot;solid&quot;));
    $gnu.dispose;
}

sub write-nbest($model) {
  my $topics := $model.nbest-words-per-topic(10);
  for ^(10/5) -&gt; $part-i {
    say &quot;|&quot; ~ (^5).map(-&gt; $t { &quot;topic { $part-i * 5 + $t }&quot; }).join(&quot;|&quot;) ~ &quot;|&quot;;
    say &quot;|&quot; ~ (^5).map({ &quot;----&quot; }).join(&quot;|&quot;) ~ &quot;|&quot;;
    for ^10 -&gt; $rank {
        say &quot;|&quot; ~ gather for ($part-i * 5)..^($part-i * 5 + 5) -&gt; $topic {
            take @($topics)[$topic;$rank].key;
        }.join(&quot;|&quot;) ~ &quot;|&quot;;
    }
    &quot;&quot;.say;
  }
}

sub save-model($model) {
  my @document-topic-matrix := $model.document-topic-matrix;
  my ($document-size, $topic-size) = @document-topic-matrix.shape;
  my $doctopicfh = open &quot;document-topic.txt&quot;, :w;

  $doctopicfh.say: ($document-size, $topic-size).join(&quot; &quot;);
  for ^$document-size -&gt; $doc-i {
    $doctopicfh.say: gather for ^$topic-size -&gt; $topic { take @document-topic-matrix[$doc-i;$topic] }.join(&quot; &quot;);
  }
  $doctopicfh.close;

  my @topic-word-matrix := $model.topic-word-matrix;
  my ($, $word-size) = @topic-word-matrix.shape;
  my $topicwordfh = open &quot;topic-word.txt&quot;, :w;

  $topicwordfh.say: ($topic-size, $word-size).join(&quot; &quot;);
  for ^$topic-size -&gt; $topic-i {
    $topicwordfh.say: gather for ^$word-size -&gt; $word { take @topic-word-matrix[$topic-i;$word] }.join(&quot; &quot;);
  }
  $topicwordfh.close;

  my @vocabulary := $model.vocabulary;
  my $vocabfh = open &quot;vocabulary.txt&quot;, :w;

  $vocabfh.say($_) for @vocabulary;
  $vocabfh.close;
}

my @documents = &quot;documents.txt&quot;.IO.lines;
my $model = create-model(@documents);
my @members = &quot;members.txt&quot;.IO.lines;
plot-topic-distribution($model, @members, @documents);
write-nbest($model);
save-model($model);
</code></pre><p>首先，我们加载已清理的文档并调用<code>create-model</code>：</p>
<pre><code class="language-raku" data-lang="raku">my @documents = &quot;documents.txt&quot;.IO.lines;
my $model = create-model(@documents);
</code></pre><p><code>create-model</code>通过加载给定文档来创建LDA模型：</p>
<pre><code class="language-raku" data-lang="raku">sub create-model(@documents --&gt; Algorithm::LDA::LDAModel) {
    my $stopwords = &quot;stopwords/english&quot;.IO.lines.Set;
    my &amp;tokenizer = -&gt; $line { $line.words.map(*.lc).grep(-&gt; $w { ($stopwords !(cont) $w) and $w !~~ /^[ &lt;:S&gt; | &lt;:P&gt; ]+$/ }) };
    my ($documents, $vocabs) = Algorithm::LDA::Formatter.from-plain(@documents.map({ my ($, $, *@body) = .words; @body.join(&quot; &quot;) }), &amp;tokenizer);
    my Algorithm::LDA $lda .= new(:$documents, :$vocabs);
    my Algorithm::LDA::LDAModel $model = $lda.fit(:num-topics(10), :num-iterations(500), :seed(2018));
    $model
}
</code></pre><p><code>$stopwords</code>来自NLTK的一组英语停用词在哪里（我提到了初步部分），并且<code>&amp;tokenizer</code>是一个自定义标记器<code>Algorithm::LDA::Formatter.from-plain</code>。标记器转换给定句子如下：</p>
<ul>
<li>
<ol>
<li>通过空格拆分句子并生成令牌列表。</li>
</ol>
</li>
<li>
<ol>
<li>用小写字符替换标记的每个字符。</li>
</ol>
</li>
<li>
<ol>
<li>删除停用词列表中存在的令牌或分类为符号或标点符号的单长令牌。</li>
</ol>
</li>
</ul>
<p><code>Algorithm::LDA::Formatter.from-plain</code> 创建数字原生文档（即，文档中的每个单词被映射到其对应的词汇表id，并且该id由C int32表示）和来自文本列表的词汇表。</p>
<p>在<code>Algorithm::LDA</code>使用上述数值文档创建实例后，我们可以通过启动LDA估计<code>Algorithm::LDA.fit</code>。在此示例中，我们将主题数设置为10，将迭代次数设置为100，将srand的种子设置为2018。</p>
<p>接下来，我们绘制文档主题分布。在此绘图之前，我们加载已保存的成员</p>
<pre><code class="language-raku" data-lang="raku">my @members = &quot;members.txt&quot;.IO.lines;
plot-topic-distribution($model, @members, @documents);
</code></pre><p><code>plot-topic-distribution</code> 使用Chart :: Gnuplot绘制主题分布：</p>
<pre><code class="language-raku" data-lang="raku">sub plot-topic-distribution($model, @members, @documents, $search-regex = rx/Larry/) {
    my $target-personid = @members.pairs.grep({ .value ~~ $search-regex }).map(*.key).head;
    my $docid = @documents.map({ my ($docid, $personid, *@body) = .words; %(docid =&gt; $docid, personid =&gt; $personid, body =&gt; @body.join(&quot; &quot;)) })\
    .grep({ .&lt;personid&gt; == $target-personid and .&lt;body&gt; ~~ /:i &lt;&lt; perl &gt;&gt;/}).map(*&lt;docid&gt;).head;

    note(&quot;@documents[$docid] is selected&quot;);
    my ($row-size, $col-size) = $model.document-topic-matrix.shape;
    my @doc-topic = gather for ($docid X ^$col-size) -&gt; ($i, $j) { take $model.document-topic-matrix[$i;$j]; }
    my Chart::Gnuplot $gnu .= new(:terminal(&quot;png&quot;), :filename(&quot;topics.png&quot;));
    $gnu.command(&quot;set boxwidth 0.5 relative&quot;);
    my AnyTicsTic @tics = @doc-topic.pairs.map({ %(:label(.key), :pos(.key)) });
    $gnu.legend(:off);
    $gnu.xlabel(:label(&quot;Topic&quot;));
    $gnu.ylabel(:label(&quot;P(z|theta,d)&quot;));
    $gnu.xtics(:tics(@tics));
    $gnu.plot(:vertices(@doc-topic.pairs.map({ @(.key, .value.exp) })), :style(&quot;boxes&quot;), :fill(&quot;solid&quot;));
    $gnu.dispose;
}
</code></pre><p>在这个例子中，我们绘制了Larry Wall的引文的主题分布（“虽然Perl口号是不仅仅有一种方法可以做到这一点，但我还是犹豫了10种方法来做某事。”）：</p>
<p><img src="https://camo.githubusercontent.com/787f04318d3c341aa81deaa2c2793054d48403ee/68747470733a2f2f7065726c36616476656e742e66696c65732e776f726470726573732e636f6d2f323031382f31322f746f706963732d312e706e673f773d363430" alt="img"></p>
<p>在绘图之后，我们称之为<code>write-nbest</code>：</p>
<pre><code class="language-raku" data-lang="raku">write-nbest($model);
</code></pre><p>在LDA中，XXX表示的主题表示为单词列表。<code>write-nbest</code>写一个降价风格的主题词分配表：</p>
<pre><code class="language-raku" data-lang="raku">sub write-nbest($model) {
  my $topics := $model.nbest-words-per-topic(10);
  for ^(10/5) -&gt; $part-i {
    say &quot;|&quot; ~ (^5).map(-&gt; $t { &quot;topic { $part-i * 5 + $t }&quot; }).join(&quot;|&quot;) ~ &quot;|&quot;;
    say &quot;|&quot; ~ (^5).map({ &quot;----&quot; }).join(&quot;|&quot;) ~ &quot;|&quot;;
    for ^10 -&gt; $rank {
        say &quot;|&quot; ~ gather for ($part-i * 5)..^($part-i * 5 + 5) -&gt; $topic {
            take @($topics)[$topic;$rank].key;
        }.join(&quot;|&quot;) ~ &quot;|&quot;;
    }
    &quot;&quot;.say;
  }
}
</code></pre><p>结果是：</p>
<table>
<thead>
<tr>
<th>topic 0</th>
<th>topic 1</th>
<th>topic 2</th>
<th>topic 3</th>
<th>topic 4</th>
</tr>
</thead>
<tbody>
<tr>
<td>would</td>
<td>scotland</td>
<td>black</td>
<td>could</td>
<td>one</td>
</tr>
<tr>
<td>itâ€™s</td>
<td>country</td>
<td>mr.</td>
<td>first</td>
<td>work</td>
</tr>
<tr>
<td>believe</td>
<td>one</td>
<td>lot</td>
<td>law</td>
<td>new</td>
</tr>
<tr>
<td>one</td>
<td>political</td>
<td>play</td>
<td>college</td>
<td>human</td>
</tr>
<tr>
<td>took</td>
<td>world</td>
<td>official</td>
<td>basic</td>
<td>process</td>
</tr>
<tr>
<td>much</td>
<td>need</td>
<td>new</td>
<td>speak</td>
<td>business</td>
</tr>
<tr>
<td>donâ€™t</td>
<td>must</td>
<td>reacher</td>
<td>language</td>
<td>becomes</td>
</tr>
<tr>
<td>ever</td>
<td>national</td>
<td>five</td>
<td>every</td>
<td>good</td>
</tr>
<tr>
<td>far</td>
<td>many</td>
<td>car</td>
<td>matter</td>
<td>world</td>
</tr>
<tr>
<td>fighting</td>
<td>us</td>
<td>road</td>
<td>right</td>
<td>knowledge</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>topic 5</th>
<th>topic 6</th>
<th>topic 7</th>
<th>topic 8</th>
<th>topic 9</th>
</tr>
</thead>
<tbody>
<tr>
<td>apple</td>
<td>united</td>
<td>people</td>
<td>like</td>
<td>*/</td>
</tr>
<tr>
<td>likely</td>
<td>war</td>
<td>would</td>
<td>one</td>
<td>die</td>
</tr>
<tr>
<td>company</td>
<td>states</td>
<td>i’m</td>
<td>something</td>
<td>und</td>
</tr>
<tr>
<td>jobs</td>
<td>years</td>
<td>know</td>
<td>think</td>
<td>quantum</td>
</tr>
<tr>
<td>even</td>
<td>would</td>
<td>think</td>
<td>way</td>
<td>play</td>
</tr>
<tr>
<td>steve</td>
<td>american</td>
<td>want</td>
<td>things</td>
<td>noble</td>
</tr>
<tr>
<td>life</td>
<td>president</td>
<td>get</td>
<td>perl</td>
<td>home</td>
</tr>
<tr>
<td>like</td>
<td>human</td>
<td>going</td>
<td>long</td>
<td>dog</td>
</tr>
<tr>
<td>end</td>
<td>must</td>
<td>say</td>
<td>always</td>
<td>student</td>
</tr>
<tr>
<td>small</td>
<td>us</td>
<td>go</td>
<td>really</td>
<td>ist</td>
</tr>
</tbody>
</table>
<p>正如你所看到的那样，引用“虽然Perl Slogan不仅仅是一种方法，我还有10种方法可以做某事。”包含“one”，“way”和“perl”。这就是为什么这个引用主要由主题8组成的原因。</p>
<p>对于下一节，我们按<code>save-model</code>子程序保存模型：</p>
<pre><code class="language-raku" data-lang="raku">sub save-model($model) {
  my @document-topic-matrix := $model.document-topic-matrix;
  my ($document-size, $topic-size) = @document-topic-matrix.shape;
  my $doctopicfh = open &quot;document-topic.txt&quot;, :w;

  $doctopicfh.say: ($document-size, $topic-size).join(&quot; &quot;);
  for ^$document-size -&gt; $doc-i {
    $doctopicfh.say: gather for ^$topic-size -&gt; $topic { take @document-topic-matrix[$doc-i;$topic] }.join(&quot; &quot;);
  }
  $doctopicfh.close;

  my @topic-word-matrix := $model.topic-word-matrix;
  my ($, $word-size) = @topic-word-matrix.shape;
  my $topicwordfh = open &quot;topic-word.txt&quot;, :w;

  $topicwordfh.say: ($topic-size, $word-size).join(&quot; &quot;);
  for ^$topic-size -&gt; $topic-i {
    $topicwordfh.say: gather for ^$word-size -&gt; $word { take @topic-word-matrix[$topic-i;$word] }.join(&quot; &quot;);
  }
  $topicwordfh.close;

  my @vocabulary := $model.vocabulary;
  my $vocabfh = open &quot;vocabulary.txt&quot;, :w;

  $vocabfh.say($_) for @vocabulary;
  $vocabfh.close;
}
</code></pre><h2 id="练习3创建报价搜索引擎">练习3：创建报价搜索引擎</h2>
<p>在本节中，我们创建一个报价搜索引擎，它使用上一节中创建的模型。
更具体地说，我们创建了基于LDA的文档模型（Xing Wei和W. Bruce Croft 2006），并创建了一个可以搜索报价的CLI工具。（注意，“token”和“word”这两个词在本节中是可互换的）</p>
<p>整个源代码是：</p>
<pre><code class="language-raku" data-lang="raku">use v6.c;

sub MAIN(Str :$query!) {
    my \doc-topic-iter = &quot;document-topic.txt&quot;.IO.lines.iterator;
    my \topic-word-iter = &quot;topic-word.txt&quot;.IO.lines.iterator;
    my ($document-size, $topic-size) = doc-topic-iter.pull-one.words;
    my ($, $word-size) = topic-word-iter.pull-one.words;

    my Num @document-topic[$document-size;$topic-size];
    my Num @topic-word[$topic-size;$word-size];

    for ^$document-size -&gt; $doc-i {
        my \maybe-line := doc-topic-iter.pull-one;
        die &quot;Error: Something went wrong&quot; if maybe-line =:= IterationEnd;
        my Num @line = @(maybe-line).words&gt;&gt;.Num;
        for ^@line {
            @document-topic[$doc-i;$_] = @line[$_];
        }
    }

    for ^$topic-size -&gt; $topic-i {
        my \maybe-line := topic-word-iter.pull-one;
        die &quot;Error: Something went wrong&quot; if maybe-line =:= IterationEnd;
        my Num @line = @(maybe-line).words&gt;&gt;.Num;
        for ^@line {
            @topic-word[$topic-i;$_] = @line[$_];
        }
    }

    my %vocabulary = &quot;vocabulary.txt&quot;.IO.lines.pairs&gt;&gt;.antipair.hash;
    my @members = &quot;members.txt&quot;.IO.lines;
    my @documents = &quot;documents.txt&quot;.IO.lines;
    my @docbodies = @documents.map({ my ($, $, *@body) = .words; @body.join(&quot; &quot;) });
    my %doc-to-person = @documents.map({ my ($docid, $personid, $) = .words; %($docid =&gt; $personid) }).hash;
    my @query = $query.words.map(*.lc);

    my @sorted-list = gather for ^$document-size -&gt; $doc-i {
        my Num $log-prob = gather for @query -&gt; $token {
            my Num $log-ml-prob = Pml(@docbodies, $doc-i, $token);
            my Num $log-lda-prob = Plda($token, $topic-size, $doc-i, %vocabulary, @document-topic, @topic-word);
            take log-sum(log(0.2) + $log-ml-prob, log(0.8) + $log-lda-prob);
        }.sum;
        take %(doc-i =&gt; $doc-i, log-prob =&gt; $log-prob);
    }.sort({ $^b&lt;log-prob&gt; &lt;=&gt; $^a&lt;log-prob&gt; });

    for ^10 {
        my $docid = @sorted-list[$_]&lt;doc-i&gt;;
        sprintf(&quot;\&quot;%s\&quot; by %s %f&quot;, @docbodies[$docid], @members[%doc-to-person{$docid}], @sorted-list[$_]&lt;log-prob&gt;).say;
    }

}

sub Pml(@docbodies, $doc-i, $token --&gt; Num) {
    my Int $num-tokens = @docbodies[$doc-i].words.grep({ /:i^ $token $/ }).elems;
    my Int $total-tokens = @docbodies[$doc-i].words.elems;
    return -100e0 if $total-tokens == 0 or $num-tokens == 0;
    log($num-tokens) - log($total-tokens);
}

sub Plda($token, $topic-size, $doc-i, %vocabulary is raw, @document-topic is raw, @topic-word is raw --&gt; Num) {
    gather for ^$topic-size -&gt; $topic {
        if %vocabulary{$token}:exists {
            take @document-topic[$doc-i;$topic] + @topic-word[$topic;%vocabulary{$token}];
        } else {
            take -100e0;
        }
    }.reduce(&amp;log-sum);
}

sub log-sum(Num $log-a, Num $log-b --&gt; Num) {
    if $log-a &lt; $log-b {
        return $log-b + log(1 + exp($log-a - $log-b))
    } else {
        return $log-a + log(1 + exp($log-b - $log-a))
    }
}
</code></pre><p>在beggining，我们加载保存的模型和准备<code>@document-topic</code>，<code>@topic-word</code>，<code>%vocabulary</code>，<code>@documents</code>，<code>@docbodies</code>，<code>%doc-to-person</code>和<code>@members</code></p>
<pre><code class="language-raku" data-lang="raku"> my \doc-topic-iter = &quot;document-topic.txt&quot;.IO.lines.iterator;
    my \topic-word-iter = &quot;topic-word.txt&quot;.IO.lines.iterator;
    my ($document-size, $topic-size) = doc-topic-iter.pull-one.words;
    my ($, $word-size) = topic-word-iter.pull-one.words;

    my Num @document-topic[$document-size;$topic-size];
    my Num @topic-word[$topic-size;$word-size];

    for ^$document-size -&gt; $doc-i {
        my \maybe-line = doc-topic-iter.pull-one;
        die &quot;Error: Something went wrong&quot; if maybe-line =:= IterationEnd;
        my Num @line = @(maybe-line).words&gt;&gt;.Num;
        for ^@line {
            @document-topic[$doc-i;$_] = @line[$_];
        }
    }

    for ^$topic-size -&gt; $topic-i {
        my \maybe-line = topic-word-iter.pull-one;
        die &quot;Error: Something went wrong&quot; if maybe-line =:= IterationEnd;
        my Num @line = @(maybe-line).words&gt;&gt;.Num;
        for ^@line {
            @topic-word[$topic-i;$_] = @line[$_];
        }
    }

    my %vocabulary = &quot;vocabulary.txt&quot;.IO.lines.pairs&gt;&gt;.antipair.hash;
    my @members = &quot;members.txt&quot;.IO.lines;
    my @documents = &quot;documents.txt&quot;.IO.lines;
    my @docbodies = @documents.map({ my ($, $, *@body) = .words; @body.join(&quot; &quot;) });
    my %doc-to-person = @documents.map({ my ($docid, $personid, $) = .words; %($docid =&gt; $personid) }).hash;
</code></pre><p>接下来，我们<code>@query</code>使用选项设置<code>:$query</code>：</p>
<pre><code class="language-raku" data-lang="raku">my @query = $query.words.map(*.lc);
</code></pre><p>之后，我们计算<code>P(query|document)</code>基于Eq 的概率。前面提到的9篇文章（注意我们使用对数来避免不流动并将参数mu设置为零）并对它们进行排序。</p>
<pre><code class="language-raku" data-lang="raku">    my @sorted-list = gather for ^$document-size -&gt; $doc-i {
        my Num $log-prob = gather for @query -&gt; $token {
            my Num $log-ml-prob = Pml(@docbodies, $doc-i, $token);
            my Num $log-lda-prob = Plda($token, $topic-size, $doc-i, %vocabulary, @document-topic, @topic-word);
            take log-sum(log(0.2) + $log-ml-prob, log(0.8) + $log-lda-prob);
        }.sum;
        take %(doc-i =&gt; $doc-i, log-prob =&gt; $log-prob);
    }.sort({ $^b&lt;log-prob&gt; &lt;=&gt; $^a&lt;log-prob&gt; });
</code></pre><p><code>Plda</code>为每个主题添加给定文档概率（即lnP（主题| theta，文档））和单词给定主题概率（即lnP（word | phi，topic））的对数主题，并将它们加起来<code>.reduce(&amp;log-sum);</code>：</p>
<pre><code class="language-raku" data-lang="raku">sub Plda($token, $topic-size, $doc-i, %vocabulary is raw, @document-topic is raw, @topic-word is raw --&gt; Num) {
    gather for ^$topic-size -&gt; $topic {
        if %vocabulary{$token}:exists {
            take @document-topic[$doc-i;$topic] + @topic-word[$topic;%vocabulary{$token}];
        } else {
            take -100e0;
        }
    }.reduce(&amp;log-sum);
}
</code></pre><p>而且 <code>Pml</code>（ml表示最大似然）计数<code>$token</code>并将其标准化为文档中的总标记（注意，此计算也在日志空间中进行）：</p>
<pre><code class="language-raku" data-lang="raku">sub Pml(@docbodies, $doc-i, $token --&gt; Num) {
    my Int $num-tokens = @docbodies[$doc-i].words.grep({ /:i^ $token $/ }).elems;
    my Int $total-tokens = @docbodies[$doc-i].words.elems;
    return -100e0 if $total-tokens == 0 or $num-tokens == 0;
    log($num-tokens) - log($total-tokens);
}
</code></pre><p>好的，那就让我们执行吧！</p>
<p>查询“perl”：</p>
<pre><code>$ raku search-quotation.p6 --query=&quot;perl&quot;
&quot;Perl will always provide the null.&quot; by Larry Wall -3.301156
&quot;Perl programming is an *empirical* science!&quot; by Larry Wall -3.345189
&quot;The whole intent of Perl 5's module system was to encourage the growth of Perl culture rather than the Perl core.&quot; by Larry Wall -3.490238
&quot;I dunno, I dream in Perl sometimes...&quot; by Larry Wall -3.491790
&quot;At many levels, Perl is a 'diagonal' language.&quot; by Larry Wall -3.575779
&quot;Almost nothing in Perl serves a single purpose.&quot; by Larry Wall -3.589218
&quot;Perl has a long tradition of working around compilers.&quot; by Larry Wall -3.674111
&quot;As for whether Raku will replace Perl 5, yeah, probably, in about 40 years or so.&quot; by Larry Wall -3.684454
&quot;Well, I think Perl should run faster than C.&quot; by Larry Wall -3.771155
&quot;It's certainly easy to calculate the average attendance for Perl conferences.&quot; by Larry Wall -3.864075
</code></pre><p>查询“apple”：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">$ raku search-quotation.p6 --query<span class="o">=</span><span class="s2">&#34;apple&#34;</span>
<span class="s2">&#34;Steve Jobs is the&#34;</span>With phones moving to technologies such as Apple Pay, an unwillingness to assure security could create a Target-like exposure that wipes Apple out of the market.<span class="s2">&#34; by Rob Enderle -3.841538
</span><span class="s2">&#34;</span>*:From Joint Apple / HP press release dated <span class="m">1</span> January <span class="m">2004</span> available <span class="o">[</span>http://www.apple.com/pr/library/2004/jan/08hp.html here<span class="o">]</span>.<span class="s2">&#34; by Carly Fiorina -3.904489
</span><span class="s2">&#34;</span>Samsung did to Apple what Apple did to Microsoft, skewering its devoted users and reputation, only better. ... There is a way <span class="k">for</span> Apple to fight back, but the company no longer has that skill, and apparently doesn<span class="s1">&#39;t know where to get it, either.&#34; by Rob Enderle -3.940359
</span><span class="s1">&#34;[W]hen it came to the iWatch, also a name that Apple didn&#39;</span>t own, Apple walked away from it and instead launched the Apple Watch. Certainly, no risk of litigation, but the product<span class="s1">&#39;s sales are a fraction of what they otherwise might have been with the proper name and branding.&#34; by Rob Enderle -4.152145
</span><span class="s1">&#34;[W]hen Apple wanted the name &#34;iPhone&#34; and it was owned by Cisco, Steve Jobs just took it, and his legal team executed so he could keep it. It turned out that doing this was surprisingly inexpensive. And, as the Apple Watch showcased, the Apple Phone likely would not have sold anywhere near as well as the iPhone.&#34; by Rob Enderle -4.187223
</span><span class="s1">&#34;The cause of [Apple v. Qualcomm] appears to be an effort by Apple to pressure Qualcomm into providing a unique discount, largely because Apple has run into an innovation wall, is under increased competition from firms like Samsung, and has moved to a massive cost reduction strategy. (I&#39;</span>ve never known this to end well, as it causes suppliers to create unreliable components and outright fail.<span class="o">)</span><span class="s2">&#34; by Rob Enderle -4.318575
</span><span class="s2">&#34;</span>Apple tends to aggressively work to not discover problems with products that are shipped and certainly not talk about them.<span class="s2">&#34; by Rob Enderle -4.380863
</span><span class="s2">&#34;</span>Apple no longer owns the tablet market, and will likely lose dominance this year or next. ... this level of sustained dominance doesn<span class="s1">&#39;t appear to recur with the same vendor even if it launched the category.&#34; by Rob Enderle -4.397954
</span><span class="s1">&#34;Apple is becoming more and more like a typical tech firm â€” that is, long on technology and short on magic. ... Apple is drifting closer and closer to where it was back in the 1990s. It offers advancements that largely follow those made by others years earlier, product proliferation, a preference for more over simple elegance, and waning excitement.&#34; by Rob Enderle -4.448473
</span><span class="s1">&#34;[T]he litigation between Qualcomm and Apple/Intel ... is weird. What makes it weird is that Intel appears to think that by helping Apple drive down Qualcomm prices, it will gain an advantage, but since its only value is as a lower cost, lower performing, alternative to Qualcomm&#39;</span>s modems, the result would be more aggressively priced better alternatives to Intel<span class="s1">&#39;s offerings from Qualcomm/Broadcom, wiping Intel out of the market. On paper, this is a lose/lose for Intel and even for Apple. The lower prices would flow to Apple competitors as well, lowering the price of competing phones. So, Apple would not get a lasting benefit either.&#34; by Rob Enderle -4.469852 Ronald McDonald of Apple, he is the face.&#34; by Rob Enderle -3.822949
</span><span class="s1">&#34;With phones moving to technologies such as Apple Pay, an unwillingness to assure security could create a Target-like exposure that wipes Apple out of the market.&#34; by Rob Enderle -3.849055
</span><span class="s1">&#34;*:From Joint Apple / HP press release dated 1 January 2004 available [http://www.apple.com/pr/library/2004/jan/08hp.html here].&#34; by Carly Fiorina -3.895163
</span><span class="s1">&#34;Samsung did to Apple what Apple did to Microsoft, skewering its devoted users and reputation, only better. ... There is a way for Apple to fight back, but the company no longer has that skill, and apparently doesn&#39;</span>t know where to get it, either.<span class="s2">&#34; by Rob Enderle -4.052616
</span><span class="s2">&#34;</span>*** The previous line contains the naughty word <span class="s1">&#39;$&amp;&#39;</span>.<span class="se">\n</span> <span class="k">if</span> /<span class="o">(</span>ibm<span class="p">|</span>apple<span class="p">|</span>awk<span class="o">)</span>/<span class="p">;</span> <span class="c1"># :-)&#34; by Larry Wall -4.088445</span>
<span class="s2">&#34;The cause of [Apple v. Qualcomm] appears to be an effort by Apple to pressure Qualcomm into providing a unique discount, largely because Apple has run into an innovation wall, is under increased competition from firms like Samsung, and has moved to a massive cost reduction strategy. (I&#39;ve never known this to end well, as it causes suppliers to create unreliable components and outright fail.)&#34;</span> by Rob Enderle -4.169533
<span class="s2">&#34;[T]he litigation between Qualcomm and Apple/Intel ... is weird. What makes it weird is that Intel appears to think that by helping Apple drive down Qualcomm prices, it will gain an advantage, but since its only value is as a lower cost, lower performing, alternative to Qualcomm&#39;s modems, the result would be more aggressively priced better alternatives to Intel&#39;s offerings from Qualcomm/Broadcom, wiping Intel out of the market. On paper, this is a lose/lose for Intel and even for Apple. The lower prices would flow to Apple competitors as well, lowering the price of competing phones. So, Apple would not get a lasting benefit either.&#34;</span> by Rob Enderle -4.197869
<span class="s2">&#34;Apple tends to aggressively work to not discover problems with products that are shipped and certainly not talk about them.&#34;</span> by Rob Enderle -4.204618
<span class="s2">&#34;Today&#39;s tech companies aren&#39;t built to last, as Apple&#39;s recent earnings report shows all too well.&#34;</span> by Rob Enderle -4.209901
<span class="s2">&#34;[W]hen it came to the iWatch, also a name that Apple didn&#39;t own, Apple walked away from it and instead launched the Apple Watch. Certainly, no risk of litigation, but the product&#39;s sales are a fraction of what they otherwise might have been with the proper name and branding.&#34;</span> by Rob Enderle -4.238582
</code></pre></div><h1 id="结论">结论</h1>
<p>在本文中，我们探索了Wikiquote，并使用Algoritm :: LDA创建了一个LDA模型。
之后我们构建了一个信息检索应用程序。</p>
<p>感谢您阅读我的文章！下次见！</p>
<h1 id="引文">引文</h1>
<ul>
<li>Blei，David M.“Probabilistic topic models。”ACM 55.4（2012）的通讯：77-84。</li>
<li>Wei，Xing和W. Bruce Croft。“基于LDA的文档模型，用于临时检索。”第29届年度国际ACM SIGIR研究与开发信息检索会议论文集。ACM，2006。</li>
</ul>


        

        

        
          

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://ohmysummer.github.io/post/2018-12-23-blin-it-is-christmas-soon/" data-toggle="tooltip" data-placement="top" title="第二十三天 - Blin，很快就到圣诞节了！">&larr; </a>
            </li>
          
          
            <li class="next">
              <a href="https://ohmysummer.github.io/post/2018-12-25-calling-number-names/" data-toggle="tooltip" data-placement="top" title="第二十五天 - 以数之名"> &rarr;</a>
            </li>
          
        </ul>
      


      
        
          
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ohmysummer" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
          
        
        
      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://ohmysummer.github.io/">焉知非鱼</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2020
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://ohmysummer.github.io/">Raku Programming</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://ohmysummer.github.io/js/main.js"></script>
<script src="https://ohmysummer.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://ohmysummer.github.io/js/load-photoswipe.js"></script>



<script>
  (function() {
    var cx = '009072066163920799339:qwme9vkotxk';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>







    
  </body>
</html>

