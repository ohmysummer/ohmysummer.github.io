<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>第十一天-Perl 6 中所有的星号</title>
  <meta property="og:title" content="第十一天-Perl 6 中所有的星号" />
  <meta name="twitter:title" content="第十一天-Perl 6 中所有的星号" />
  <meta name="description" content="All the Stars of Perl 6, or * ** *">
  <meta property="og:description" content="All the Stars of Perl 6, or * ** *">
  <meta name="twitter:description" content="All the Stars of Perl 6, or * ** *">
  <meta name="author" content="焉知非鱼"/>
  <link href='https://ohmysummer.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://ohmysummer.github.io/img/avatar-icon.jpg" />
  <meta name="twitter:image" content="https://ohmysummer.github.io/img/avatar-icon.jpg" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="https://ohmysummer.github.io/post/2017-12-11-%E7%AC%AC%E5%8D%81%E4%B8%80%E5%A4%A9perl6%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E7%9A%84%E6%98%9F%E5%8F%B7/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Young For Perl 6" />

  <meta name="generator" content="Hugo 0.49" />
  <link rel="canonical" href="https://ohmysummer.github.io/post/2017-12-11-%E7%AC%AC%E5%8D%81%E4%B8%80%E5%A4%A9perl6%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89%E7%9A%84%E6%98%9F%E5%8F%B7/" />
  <link rel="alternate" href="https://ohmysummer.github.io/index.xml" type="application/rss+xml" title="Young For Perl 6">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://ohmysummer.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://ohmysummer.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://ohmysummer.github.io/css/codeblock.css" />



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'ohmycloudy', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://ohmysummer.github.io/">Young For Perl 6</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="博客" href="/">博客</a>
            </li>
          
        
          
            <li>
              <a title="归档" href="/categories">归档</a>
            </li>
          
        
          
            <li>
              <a title="关于" href="/page/about/">关于</a>
            </li>
          
        
          
            <li>
              <a title="标签" href="/tags">标签</a>
            </li>
          
        

        

        
          <li>
            <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch" style="outline: none;">
              <span class="hidden-sm hidden-md hidden-lg">Search</span> <span id="searchGlyph" class="glyphicon glyphicon-search"></span>
            </a>
          </li>
        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Young For Perl 6" href="https://ohmysummer.github.io/">
            <img class="avatar-img" src="https://ohmysummer.github.io/img/avatar-icon.jpg" alt="Young For Perl 6" />
          </a>
        
      </div>
    </div>

  </div>
</nav>



  <div id="modalSearch" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Search Young For Perl 6</h4>
        </div>
        <div class="modal-body">
          <gcse:search></gcse:search>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>第十一天-Perl 6 中所有的星号</h1>
                
                  
                    <h2 class="post-subheading">All the Stars of Perl 6, or * ** *</h2>
                  
                
                
                  <span class="post-meta">
  
  
  <i class="fa fa-calendar-o"></i>&nbsp; Posted on December 11, 2017
  
  
  &nbsp;|&nbsp;
  <i class="fa fa-clock-o"></i> 6 minutes (1213 words)
  
  
</span>

                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<p>在今年的 Perl 6 Advent Calendar 中, 雪花被今天的博客文章承包了。 我们将检阅使用了 <code>*</code> 字符的结构。 在 Perl 6 中，根据上下文的不同，您可以叫它星星（或者，如果你愿意的话，可以叫它星号）或者 *whatever*。</p>

<p>Perl 6 不是一个隐秘的编程语言， 在许多方面它的语法比 Perl 5 更加一致。另一方面，有些地方需要花时间来开启对语法的信心。</p>

<p>让我们看看 <code>*</code> 的不同用法，从最简单的开始，旨在了解最烧脑的例如 <code>* ** *</code>。</p>

<p>前两种用法很简单，不需要太多的讨论：</p>

<h2 id="1-乘法">1. 乘法</h2>

<p>单个星号用于乘法。严格来讲, 这是一个中缀操作符 <code>infix:&lt;*&gt;</code>, 它的返回值为 <code>Numeric</code>。</p>

<pre><code class="language-perl">say 20 * 18; # 360
</code></pre>

<h2 id="2-幂">2. 幂</h2>

<p>两个星号 <code>**</code> 是幂操作符。再次, 这是一个中缀操作符 <code>infix:&lt;**&gt;</code>, 它返回 <code>Numeric</code> 结果, 计算两个给定值点幂。</p>

<pre><code class="language-perl">say pi ** e; # 22.4591577183611
</code></pre>

<hr />

<p>正则表达式中同样也使用了两个标记（<code>*</code> 或 <code>**</code>），它们表示不同的东西。 Perl 6 的一个特点是它可以很容易地在不同的语言之间切换。 正则表达式和 grammar 都是这样的内部语言的例子，其中同样的符号在 Perl 6 中可能意味着不同的含义。</p>

<h2 id="3-零或多次重复">3. 零或多次重复</h2>

<p><code>*</code> 号量词这个语法条目和 Perl 5 中点行为类似: 允许原子的零次或多次重复。</p>

<pre><code class="language-perl">my $weather = '*****';
my $snow = $weather ~~ / ('*'*) /;
say 'Snow level is ' ~ $snow.chars; # Snow level is 5
</code></pre>

<p>当然, 我们还在这儿看到了同一个字符的另一种用法, <code>*</code> 字面量。</p>

<h2 id="4-min-到-max-次重复">4. Min 到 Max 次重复</h2>

<p>两个 <code>**</code> 号是另一个量词的一部分，它指定了最小和最大重复次数:</p>

<pre><code class="language-perl">my $operator = '..';
say &quot;'$operator' is a valid Perl 6 operator&quot;
    if $operator ~~ /^ '.' ** 1..3 $/;
</code></pre>

<p>在这个例子中，预计这个点会被重复一次，两次或三次; 不多也不少。</p>

<p>让我们超前一点儿，以 <code>Whatever</code> 符号的角色（剧场中的角色，而不是 Perl 6 的面向对象编程）使用星号：</p>

<pre><code class="language-perl">my $phrase = 'I love you......';
say 'You are so uncertain...'
    if $phrase ~~ / '.' ** 4..* /;
</code></pre>

<p>范围的第二个端点是打开的，这个正则表达式接受所有其中包含四个点以上的短语。</p>

<h2 id="5-吞噬参数">5. 吞噬参数</h2>

<p>在子例程签名的数组参数之前的星号意味着吞噬参数 - 将单独的标量参数吞噬进单个数组中。</p>

<pre><code class="language-perl">list-gifts('chocolade', 'ipad', 'camelia', 'perl6');

sub list-gifts(*@items) {
    say 'Look at my gifts this year:';
    .say for @items;
}
</code></pre>

<p>哈希也允许吞噬参数：</p>

<pre><code class="language-perl">dump(alpha =&gt; 'a', beta =&gt; 'b'); # Prints:
                                 # alpha = a
                                 # beta = b

sub dump(*%data) {
    for %data.kv {say &quot;$^a = $^b&quot;}
}
</code></pre>

<p>请注意，与 Perl 5 不同的是，如果您省略函数签名中的星号，代码将无法编译，因为 Perl 6 就是说一不二：</p>

<pre><code>Too few positionals passed; expected 1 argument but got 0
</code></pre>

<h2 id="6-吨吨吨吨吨吨吨">6. 吨吨吨吨吨吨吨</h2>

<p><code>**@</code> 也能工作，但是当你传递数组或列表的时候请注意其中的区别。</p>

<p>带一颗星星：</p>

<pre><code class="language-perl">my @a = &lt; chocolade ipad &gt;;
my @b = &lt; camelia perl6 &gt;;

all-together(@a, @b);
all-together(['chocolade', 'ipad'], ['camelia', 'perl6']);
all-together(&lt; chocolade ipad &gt;, &lt; camelia perl6 &gt;);

sub all-together(*@items) {
    .say for @items;
}
</code></pre>

<p>目前，无论参数列表传递的方式如何，每个礼物都被单独打印了出来。</p>

<pre><code>chocolade
ipad
camelia
perl6
chocolade
ipad
camelia
perl6
chocolade
ipad
camelia
perl6
</code></pre>

<p>带俩颗星星：</p>

<pre><code class="language-perl">keep-groupped(@a, @b);
keep-groupped(['chocolade', 'ipad'], ['camelia', 'perl6']);
keep-groupped(&lt; chocolade ipad &gt;, &lt; camelia perl6 &gt;);

sub keep-groupped(**@items) {
    .say for @items;
}
</code></pre>

<p>这一次，<code>@items</code> 数组只有两个元素，反映了参数的结构类型：</p>

<pre><code>[chocolade ipad]
[camelia perl6]
</code></pre>

<p>或</p>

<pre><code>(chocolade ipad)
(camelia perl6)
</code></pre>

<h2 id="7-动态作用域">7. 动态作用域</h2>

<p><code>*</code> twigil，引入了动态作用域。 动态变量和全局变量很容易搞混淆，所以最好测试下面的代码。</p>

<pre><code class="language-perl">sub happy-new-year() {
    &quot;Happy new $*year year!&quot;
}

my $*year = 2018;
say happy-new-year(); # 输出 Happy new 2018 year!
</code></pre>

<p>如果你省略了星号, 那么代码就运行不了:</p>

<pre><code class="language-perl">Variable '$year' is not declared
</code></pre>

<p>更正它的唯一方法是将 <code>$year</code> 的定义移到函数定义的上面。 使用动态变量 <code>$*year</code>，函数被调用的地方定义了结果。 <code>$*year</code> 变量在子例程的外部作用域中是不可见的，但是在动态作用域内是可见的。</p>

<p>对于动态变量，将新值赋给现有变量还是创建新变量并不重要：</p>

<pre><code class="language-perl">sub happy-new-year() {
    &quot;Happy new $*year year!&quot;
}

my $*year = 2018;
say happy-new-year();

{
    $*year = 2019;        # New value
    say happy-new-year(); # 2019
}

{
    my $*year = 2020;     # New variable
    say happy-new-year(); # 2020
}
</code></pre>

<h2 id="8-编译变量">8. 编译变量</h2>

<p>Perl 6 提供了许多伪动态常量, 例如:</p>

<pre><code class="language-perl">say $*PERL;      # Perl 6 (6.c)
say @*ARGS;      # Prints command-line arguments
say %*ENV&lt;HOME&gt;; # Prints home directory
</code></pre>

<h2 id="9-all-methods">9. All methods</h2>

<p><code>.*</code> postfix 伪操作符调用给定名称的所有方法，名称可以在给定的对象中找到，并返回一个结果列表。 在微不足道的情况下，你会得到一个学术上荒诞不羁的代码：</p>

<pre><code class="language-perl">6.*perl.*say; # (6 Int.new)
</code></pre>

<p>带星号的代码与不带星号代码有些不同：</p>

<pre><code class="language-perl">pi.perl.say; # 3.14159265358979e0 (notice the scientific
             # format, unlike pi.say)
</code></pre>

<p><code>.*</code> postfix 的真正威力来自于继承。 它有时有助于揭示真相：</p>

<pre><code class="language-perl">class Present {
    method giver() {
        'parents'
    }
}

class ChristmasPresent is Present {
    method giver() {
        'Santa Claus'
    }
}

my ChristmasPresent $present;

$present.giver.say;             # Santa Claus
$present.*giver.join(', ').say; # Santa Claus, parents
</code></pre>

<p>一个星号就差别很大!</p>

<hr />

<p>现在，到了 Perl 6 最神秘的部分。接下来的两个概念，<code>Whatever</code> 和 <code>WhateverCode</code> 类，很容易混淆在一起。 让我们试着做对吧。</p>

<h2 id="10-whatever">10. Whatever</h2>

<p>单个星号 <code>*</code> 能表示任何东西(<code>Whatever</code>)。 <code>Whatever</code> 在 Perl 6 中是一个预定义好的类, 它在某些有用的场景下引入了一些规定好的行为。</p>

<p>例如，在范围和序列中，最后的 <code>*</code> 表示无穷大。 我们今天已经看到了一个例子。 这是另一个：</p>

<pre><code class="language-perl">.say for 1 .. *;
</code></pre>

<p>这个单行程序具有非常高的能量转换效率，因为它产生了一个递增整数的无限列表。 如果你要继续，请按 <code>Ctrl + C</code>。</p>

<p>范围 <code>1 .. *</code> 与 <code>1 .. Inf</code> 相同。 您可以清楚地看到，如果您跳转到 Rakudo Perl 6 源文件并在 <a href="https://github.com/rakudo/rakudo/blob/master/src/core/Range.pm">src/core/Range.pm</a> 文件的 <code>Range</code> 类的实现中找到如下定义：</p>

<pre><code class="language-perl">multi method new(Whatever \min,Whatever \max,:$excludes-min,:$excludes-max){
    nqp::create(self)!SET-SELF(-Inf,Inf,$excludes-min,$excludes-max,1);
}
multi method new(Whatever \min, \max, :$excludes-min, :$excludes-max) {
    nqp::create(self)!SET-SELF(-Inf,max,$excludes-min,$excludes-max,1);
}
multi method new(\min, Whatever \max, :$excludes-min, :$excludes-max) {
    nqp::create(self)!SET-SELF(min,Inf,$excludes-min,$excludes-max,1);
}
</code></pre>

<p>这三个 multi 构造函数描述了三种情况：<code>* .. *</code>，<code>* .. $n</code> 和 <code>$n .. *</code>，它们被立即转换为 <code>-Inf .. Inf</code>，<code>-Inf .. $n</code> 和 <code>$n .. Inf</code>。</p>

<blockquote>
<p>作为一个圣诞故事，这里有一个小小的插曲，表明 <code>*</code> 不仅仅是一个 <code>Inf</code>。 有两个到 <a href="https://github.com/rakudo/rakudo/blob/master/src/core/Whatever.pm">src/core/Whatever.pm</a> 的提交：</p>

<p>首先，2015年9月16日，&rdquo;<a href="https://github.com/rakudo/rakudo/commit/425845d723afb60d80dcca55b509ff1c1f9b303c#diff-ac169f9e5137f98d305f3cae4c0c4d07">MakeWhatever.new == Inf True</a>:&rdquo;</p>
</blockquote>

<pre><code>  my class Whatever {
      multi method ACCEPTS(Whatever:D: $topic) { True }
      multi method perl(Whatever:D:) { '*' }
+     multi method Numeric(Whatever:D:) { Inf }
  }
</code></pre>

<blockquote>
<p>几周之后, 在2015年10月23日，&rdquo;<a href="https://github.com/rakudo/rakudo/commit/4e35e807c5f0c8ac134e1ed87b4b9343966d0d8d#diff-ac169f9e5137f98d305f3cae4c0c4d07">* no longer defaults to Inf</a>&ldquo;，这是为了保护其他 dwimmy 情况下的扩展性:</p>
</blockquote>

<pre><code>  my class Whatever {
      multi method ACCEPTS(Whatever:D: $topic) { True }
      multi method perl(Whatever:D:) { '*' }
-     multi method Numeric(Whatever:D:) { Inf }
  }
</code></pre>

<p>回到我们更实际的问题，让我们创建自己的使用 whatever 符号 <code>*</code> 的类，。 下面是一个简单的例子，它带有一个接收 <code>Int</code> 值或者 <code>Whatever</code> 的 multi-方法。</p>

<pre><code class="language-perl">class N {
    multi method display(Int $n) {
        say $n;
    }

    multi method display(Whatever) {
        say 2000 + 100.rand.Int;
    }
}
</code></pre>

<p>在第一种情况下，该方法只是打印该值。 第二种方法是打印一个在 2000 到 2100 之间的随机数。 因为第二种方法的唯一参数是 <code>Whatever</code>，所以签名中不需要变量。</p>

<p>下面是你如何使用这个类：</p>

<pre><code class="language-perl">my $n = N.new;
$n.display(2018);
$n.display(*);
</code></pre>

<p>第一个调用回显它的参数，而第二个调用打印某些随机的东西。</p>

<p><code>Whatever</code> 符号可以作为一个裸的 <code>Whatever</code>。 假如，你创建一个 <code>echo</code> 函数，并将 <code>*</code> 传递给它：</p>

<pre><code class="language-perl">sub echo($x) {
    say $x;
}

echo(2018); # 2018
echo(*);    # *
</code></pre>

<p>这一次，没有魔术发生，该程序打印一个星号。</p>

<p>现在我们正处在一个四两拨千斤的节骨眼上。</p>

<h2 id="11-whatevercode">11. WhateverCode</h2>

<p>最后, 我们来谈谈 <code>WhateverCode</code>。</p>

<p>取一个数组然后打印出它的最后一个元素。如果你使用 Perl 5 的风格来做, 你会键入 <code>@a[-1]</code> 那样的东西。在 Perl 6 中, 那会产生错误:</p>

<pre><code>Unsupported use of a negative -1 subscript
to index from the end; in Perl 6 please
use a function such as *-1
</code></pre>

<p>编译器建议使用一个函数, 例如 <code>*-1</code>。它是函数吗？是的, 更准确的说, 它是一个 <code>WhateverCode</code> 块:</p>

<pre><code class="language-perl">say (*-1).WHAT; # (WhateverCode)
</code></pre>

<p>现在, 打印数组的后半部分:</p>

<pre><code class="language-perl">my @a = &lt; one two three four five six &gt;;
say @a[3..*]; # (four five six)
</code></pre>

<p>数组的索引的范围是 <code>3 .. *</code>。 <code>Whatever</code> 作为 range 的右端意味着从数组中取出所有剩余的元素。 <code>3 .. *</code> 的类型是 <code>Range</code>:</p>

<pre><code class="language-perl">say (3..*).WHAT; # (Range)
</code></pre>

<p>最后，减少一个元素。 我们已经看到，要指定最后一个元素，必须要使用诸如 <code>*-1</code> 的函数。 在 range 的右端可以做同样的事情：</p>

<pre><code class="language-perl">say @a[3 .. *-2]; # (four five)
</code></pre>

<p>在这个时候，发生了所谓的 <code>Whatever-柯里化</code>，<code>Range</code> 变成了 <code>WhateverCode</code>:</p>

<pre><code class="language-perl">say (3 .. *-2).WHAT; # (WhateverCode)
</code></pre>

<p><code>WhateverCode</code> 是一个内置的 Perl 6 类名称; 它可以很容易地用于方法分派。 让我们更新上一节中的代码，并添加一个方法变体，它需要一个 <code>WhateverCode</code> 参数：</p>

<pre><code class="language-perl">class N {
    multi method display(Int $n) {
        say $n;
    }

    multi method display(Whatever) {
        say 2000 + 100.rand.Int;
    }

    multi method display(WhateverCode $code) {
        say $code(2000 + 100.rand.Int);
    }
}
</code></pre>

<p>现在，参数列表中的星号要么落入 <code>display(Whatever)</code>, 要么落入 <code>display(WhateverCode)</code>:</p>

<pre><code class="language-perl">N.display(2018);     # display(Int $n)

N.display(*);        # display(Whatever)

N.display(* / 2);    # display(WhateverCode $code)
N.display(* - 1000); # display(WhateverCode $code)
</code></pre>

<p>我们再来看看 <code>display</code> 方法中的签名:</p>

<pre><code class="language-perl">multi method display(WhateverCode $code)
</code></pre>

<p><code>$code</code> 参数被用作方法内的函数引用:</p>

<pre><code class="language-perl">say $code(2000 + 100.rand.Int);
</code></pre>

<p>该函数需要一个参数，但它会去哪里？ 或者换句话说，函数体是什么，在哪里？ 我们将该方法调用为 <code>N.display(* / 2)</code> 或 <code>N.display(* - 1000)</code>。 答案是 <code>* / 2</code> 和 <code>* - 1000</code> 都是函数！ 还记得编译器关于使用诸如 <code>*-1</code> 之类的函数的提示吗？</p>

<p>这里的星号成为第一个函数参数，因此 <code>* / 2</code> 相当于 <code>{$^a / 2}</code>，而 <code>*-1000</code> 相当于 <code>{$^a - 1000}</code>。</p>

<p>这是否意味着可以在 <code>$^a</code> 的旁边使用 <code>$^b</code>? 当然！ 使 <code>WhateverCode</code> 块接受两个参数。 你如何指出其中的第二个？ 毫不惊喜，再用一个星号！ 让我们将 <code>display</code> 方法的第四个变体添加到我们的类中：</p>

<pre><code class="language-perl">multi method display(WhateverCode $code 
                     where {$code.arity == 2}) {
    say $code(2000, 100.rand.Int);
}
</code></pre>

<p>这里，使用 <code>where</code> 块来缩小调度范围，只选择那些有两个参数的 <code>WhateverCode</code> 块。 完成此操作后，方法调用中将允许含有两个雪花：</p>

<pre><code class="language-perl">N.display( * + * );
N.display( * - * );
</code></pre>

<p>这些调用定义了用于计算结果的函数 <code>$code</code>。 所以，<code>N.display(* + *)</code> 背后的实际操作如下：<code>2000 + 100.rand.Int</code>。</p>

<p>需要更多的雪花吗？ 多添加点星星：</p>

<pre><code class="language-perl">N.display( * * * );
N.display( * ** * );
</code></pre>

<p>类似地, 里面实际的计算是:</p>

<pre><code class="language-perl">2000 * 100.rand.Int
</code></pre>

<p>和</p>

<pre><code class="language-perl">2000 ** 100.rand.Int
</code></pre>

<p>恭喜！ 你现在可以像编译器那样毫不费力地解析 <code>* ** *</code> 结构了。</p>

<h2 id="作业">作业</h2>

<p>到目前为止，Perl 6 给了我们很多圣诞礼物。 让我们回过头来做一下练习并回答一下问题：下面代码中的每个星号在意味着什么？</p>

<pre><code class="language-perl">my @n = 
    ((0, 1, * + * ... *).grep: *.is-prime).map: * * * * *;
.say for @n[^5];
</code></pre>

<p>D&rsquo;哦。 我建议我们从转换代码开始来摆脱所有的星号，并使用不同的语法。</p>

<p>序列运算符 <code>...</code> 之后的 <code>*</code> 意味着无限地生成序列，所以用 <code>Inf</code> 来代替它:</p>

<pre><code class="language-perl">((0, 1, * + * ... Inf).grep: *.is-prime).map: * * * * *
</code></pre>

<p>生成器函数中的两个星号 <code>* + *</code> 可以用一个带有两个显式参数的 lambda 函数来替换：</p>

<pre><code class="language-perl">((0, 1, -&gt; $x, $y {$x + $y} ... Inf).grep: 
    *.is-prime).map: * * * * *
</code></pre>

<p>现在，简单的语法交替。 用带圆括号的方法调用替换 <code>.grep</code>。 它的参数 <code>*.is-prime</code> 变成一个代码块，并且星号被替换为默认变量 <code>$_</code>。 请注意，代码使用 <code>*</code> 时不需要花括号。</p>

<pre><code class="language-perl">(0, 1, -&gt; $x, $y {$x + $y} ... Inf).grep({
    $_.is-prime
}).map: * * * * *
</code></pre>

<p>最后，与 <code>.map</code> 相同的技巧：但是这次这个方法有三个参数，因此，你可以编写 <code>{$^a * $^b * $^c}</code> 而不是 <code>* * * * *</code>，这里是新的 完整程序的变体：</p>

<pre><code class="language-perl">my @n = (0, 1, -&gt; $x, $y {$x + $y} ... Inf).grep({
        $_.is-prime
    }).map({
        $^a * $^b * $^c
    });
.say for @n[^5];
</code></pre>

<p>现在很明显，代码打印了三个斐波那契素数组积的前五个。</p>

<h2 id="附加题">附加题</h2>

<p>在教科书中，最具挑战性的任务是用 <code>*</code> 标记的。 这里有几个由你自己来解决。</p>

<ul>
<li>1. Perl 6 中的 <code>chdir('/')</code> 和 <code>＆*chdir('/')</code> 有什么区别？</li>
<li>2. 解释下面的 Perl 6 代码并修改它以展示其优点：<code>.say for 1 ... **</code>。</li>
</ul>

<p>❄❄❄</p>

<p>今天就这样了。 我希望你喜欢 Perl 6 的强大功能和表现力。今天，我们只谈到了一个 ASCII 字符。 想象一下，如果考虑到该语言在当今编程语言中提供了最好的 Unicode 支持，Perl 6 的 Universe 是多么的庞大。</p>

<p>今天享受 Perl 6，并传播这个词！ 请继续关注 Perl 6 Advent Calendar; 更多的文章正在等待你的关注，明天就要来了。</p>

<p>Andrew Shitov</p>

<p><a href="https://perl6advent.wordpress.com/2017/12/11/all-the-stars-of-perl-6/">Day 11 — All the Stars of Perl 6, or * ** *</a></p>


        
          <div class="blog-tags">
            
              <a href="https://ohmysummer.github.io//tags/whatever/">Whatever</a>&nbsp;
            
          </div>
        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://ohmysummer.github.io/post/2017-12-10-%E7%AC%AC%E5%8D%81%E5%A4%A9wrapping-rats/" data-toggle="tooltip" data-placement="top" title="第十天 – Wrapping Rats">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://ohmysummer.github.io/post/2017-12-12-%E7%AC%AC%E5%8D%81%E4%BA%8C%E5%A4%A9the-year-of-perl-6-books/" data-toggle="tooltip" data-placement="top" title="第十二天 – The Year of Perl 6 Books">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
          <div class="disqus-comments">
            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ohmysummer" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          <li>
            
            <a href="https://ohmysummer.github.io/index.xml" title="RSS">
            
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://ohmysummer.github.io/">焉知非鱼</a>
            
          

          <span style="color: red;">❤</span>&nbsp;Perl 6
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.49</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://ohmysummer.github.io/js/main.js"></script>
<script src="https://ohmysummer.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="https://ohmysummer.github.io/js/load-photoswipe.js"></script>


<script>
  (function() {
    var cx = '009072066163920799339:qwme9vkotxk';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>





  </body>
</html>

