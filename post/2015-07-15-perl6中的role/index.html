<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="ohmysummer">
    <meta name="description" content="ohmysummer&#39;s personal website">
    <meta name="keywords" content="Perl6,Rakudo">

    <base href="http://ohmysummer.github.io/">
    <title>
  Perl 6 中的 Role · 焉知非鱼
</title>

    <link rel="canonical" href="http://ohmysummer.github.io/post/2015-07-15-perl6%E4%B8%AD%E7%9A%84role/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.cd087ace86754b082dec94545567f8361cba42e84f8e15edbc4a9f6e52bd1f6a.css" integrity="sha256-zQh6zoZ1Swgt7JRUVWf4Nhy6QuhPjhXtvEqfblK9H2o=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://ohmysummer.github.io/css/style.css">
    

    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://ohmysummer.github.io/">
      焉知非鱼
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/post">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/page/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags">标签</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Perl 6 中的 Role</h1>
    </header>

    

<ul>
<li>Composition and mix-ins</li>
<li>Sigils</li>
<li>Typed data structures</li>
<li>Traits</li>
</ul>

<p>所以到底什么是 <code>role</code> 呢？ role 是零个或多个方法和属性的集合。</p>

<p>role 不像 class，它不能被实例化（如果你尝试了，会生成一个 class）。Perl 6 中 Classes 是可变的，而 roles 是不可变的。</p>

<h2 id="申明-roles-就像申明-class-一样">申明 Roles 就像申明 Class 一样：</h2>

<hr />

<p>使用关键字 <code>role</code>来引入 role, 在 role 中声明属性和方法就像在 Perl 6 的类中声明属性和方法那样。</p>

<pre><code class="language-perl6">role DebugLog {
    has @.log_lines;
    has $.log_size is rw = 100;
    method log_message($message) {
        @!log_lines.shift if
        @!log_lines.elems &gt;= $!log_size;
        @!log_lines.push($message);
    }
}
</code></pre>

<h2 id="role-composition">Role Composition</h2>

<hr />

<ul>
<li>使用 <code>does</code> trait 将 role 组合到 Class 中：</li>
</ul>

<pre><code class="language-perl6">class WebCrawler does DebugLog {
    ...
}
</code></pre>

<ul>
<li>这会把方法和属性添加到 class WebCrawler 里面去。</li>
<li>结果就像它们起初被写到 class 中一样。</li>
</ul>

<h2 id="mix-ins">Mix-ins</h2>

<hr />

<ul>
<li>允许 role 的功能被添加到每个对象的根基上</li>
<li>不影响其它的类实例</li>
<li>role 中的方法总是覆盖对象中已经存在的方法</li>
</ul>

<h2 id="mix-ins-example">Mix-ins Example</h2>

<hr />

<ul>
<li>假设我们想跟踪某个对象发生了什么</li>
<li>Mix in the DebugLog role</li>
</ul>

<pre><code class="language-perl6">$acount does DebugLog;
</code></pre>

<ul>
<li>然后, 我们可以输出被登记的行</li>
</ul>

<pre><code class="language-perl6">$account.log_lines».say;
</code></pre>

<ul>
<li>现在我们只需给<code>log_message</code>方法添加调用</li>
<li>我们可以使用<code>.?</code>操作符, 这会调用某个方法, 如果方法存在的话</li>
</ul>

<pre><code class="language-perl6">class Account {
    method change_password($new) {
        self.?log_message(
            &quot;changing password to $new&quot;;
        )
        ...
    }
}
</code></pre>

<h2 id="sigil-接口协定">Sigil = 接口协定</h2>

<hr />

<ul>
<li>在 Perl 6 中, 符号表明接口协定</li>
<li>这个接口协定由 role 定义</li>
<li>你可以只把东西放在带有符号的变量中, 如果该变量遵守(<code>does</code>)了要求的 role 的话</li>
<li>例外: 带有 <code>$</code>的变量可以存储任何东西(如果没有使用类型约束的话)</li>
</ul>

<h2 id="positional">@ = Positional</h2>

<hr />

<ul>
<li><code>@</code>符号表明它是一个 <code>Positional</code>role</li>
<li>保证会有一个方法后环缀让你能调用</li>
<li>This is that gets called when you do an index positionally into something</li>
</ul>

<pre><code class="language-perl6">say @fact[1];
say @fact.postcircumfix:&lt;[ ]&gt;(1);
</code></pre>

<ul>
<li>注意: 优化器(如果有的话)可能发出更轻量级的东西</li>
</ul>

<h2 id="associative">% = Associative</h2>

<hr />

<ul>
<li><code>%</code> 表明它是一个关联型(Associative)的 role</li>
<li>要有一个方法后环缀 <code>postcircumfix:&lt;{}&gt;</code>让你调用</li>
<li>This is that gets called when you do an index associatively into something</li>
</ul>

<pre><code class="language-perl6">say %price&lt;Cheese&gt;;
say %price.postcircumfix:&lt;{ }&gt;('Cheese');
</code></pre>

<h2 id="callable">&amp; = Callable</h2>

<hr />

<ul>
<li><code>&amp;</code>表明它是一个 Callable 的 role</li>
<li>东西要能被调用</li>
<li>这个 role 被诸如 <code>Block</code>、<code>Sub</code>、<code>Method</code>之类的东西遵守</li>
<li>要求实现后环缀 <code>postcircumfix:&lt;()&gt;</code></li>
</ul>

<p>使用带有 block 的 class 关键字引入一个类：</p>

<pre><code class="language-perl6">class Puppy {
    ...
}
</code></pre>

<p> 或使用</p>

<pre><code class="language-perl6">class Puppy;

...

1;
</code></pre>

<p>把类相关的东西单独写进一个文件</p>

<h2 id="role-也可以被初始化">Role 也可以被初始化</h2>

<hr />

<pre><code class="language-perl">
role BarChart {
    has Int @.bar-values;
    has $.b is rw;
    method plot {
        say @.bar-values;
    }
}

my $chart = BarChart.new(bar-values =&gt; [1,2,3], b =&gt; &quot;Camelia&quot;);
say $chart.b;
say $chart.bar-values;
$chart.b = &quot;Rakudo&quot;;
say $chart.b;
say BarChart.^methods;
</code></pre>

<p>如果你初始化了 role, 那么它就变为类了。</p>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>ohmysummer ❤ Perl 6</p>
    
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
