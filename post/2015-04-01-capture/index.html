<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="ohmysummer">
    <meta name="description" content="ohmysummer&#39;s personal website">
    <meta name="keywords" content="Perl6,Rakudo">

    <base href="http://ohmysummer.github.io/">
    <title>
  Capture · 焉知非鱼
</title>

    <link rel="canonical" href="http://ohmysummer.github.io/post/2015-04-01-capture/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.cd087ace86754b082dec94545567f8361cba42e84f8e15edbc4a9f6e52bd1f6a.css" integrity="sha256-zQh6zoZ1Swgt7JRUVWf4Nhy6QuhPjhXtvEqfblK9H2o=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://ohmysummer.github.io/css/style.css">
    

    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://ohmysummer.github.io/">
      焉知非鱼
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/post">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/page/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags">标签</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>Capture</h1>
    </header>

    

<p><a href="http://doc.perl6.org/type/Capture">Capture</a> 的定义:</p>

<pre><code class="language-perl">class Capture does Positional does Associative { }
</code></pre>

<p>Capture 是一个用于给 code 对象传递参数的容器。Captures 是签名的另一面 — Captures 在调用方定义实参, 而签名(Signatures) 在被调用方定义形式参数。</p>

<p>当你调用 <code>print $a, $b</code> 时, <code>$a, $b</code> 这部分就是一个 Capture。<code>$a, $b</code> 在这儿是实参。</p>

<p>Captures 包含一个 list-like 部分的位置参数和一个 hash-like 部分的具名参数。对于具名参数, Captures 使用一种略微不同的语法而不是普通的 List。有两种简单的方法生成一个具名参数：</p>

<ul>
<li>使用一个未引起的键命名一个形参, 后面跟着 <code>=&gt;</code>, 然后跟着参数</li>
<li>使用以形参命名的冒号对儿字面量</li>
</ul>

<pre><code class="language-perl">say unique 1, -2, 2, 3, as =&gt; { abs $_ }; # 1, -2, 3
# ... is the same thing as:
say unique 1, -2, 2, 3, :as({ abs $_ });  # 1, -2, 3
# Be careful not to quote the name of a named parameter:
say unique 1, -2, 2, 3, 'as' =&gt; { abs $_ }; # 1, -2, 2, 3, &quot;as&quot; =&gt; { ... }
</code></pre>

<p>单个独立的 Capture 也能被生成, 存储, 然后供之后使用。 在项(term)那儿前置一个反斜线 <code>\</code> 能生成一个字面的 Capture。通常, 这个 term 会是一个 terms 的列表, 在这个列表里面, 任何 Pair 字面值会被放在 Capture 的具名部分, 而其它 terms 会被放在Capture 的位置(positional) 部分。</p>

<pre><code class="language-perl">my $c = \(42);               # 带有一个 positional 部分的 Capture        
$c = \(1, 2, a =&gt; 'b');      # 带有两个 positional 部分和一个具名部分的 Capture
</code></pre>

<p>要使用这样的 Capture, 在函数调用里你可以在这个 Capture 前面使用 <code>|</code> , 那么它看起来会像这个 Capture 中的所有值都被作为实参直接传递这个函数了 — 具名参数作为具名参数传递, 而位置参数会作为位置参数传递。 只要你愿意, 你可以重用这个 Capture 任意次, 甚至使用不同的函数。</p>

<pre><code class="language-perl">my $c = \(4,2,3);
reverse(|$c).say; # 3 2 4
sort(5,|$c).say;  # 2 3 4 5
</code></pre>

<p>在签名( Signature) 里面, 可以在不含符号的形参那儿前置一个竖线 <code>|</code> 来创建一个 Capture。这会把余下的参数列表打包到那个形参中：</p>

<pre><code class="language-perl">sub f($a, |c) {
    say c;
}
f(1, 2, 3, a =&gt; 4, b =&gt; 5); # c  is  \(2, 3, a =&gt; 4, b =&gt; 5)
</code></pre>

<p>请注意，Capture 仍然是列表，因为它们可能包含容器，而不只是值:</p>

<pre><code class="language-perl">my $b = 1;
my $c = \(4,2,$b,3);
sort(|$c).say;        # 1 2 3 4
$b = 6;
sort(|$c).say;        # 2 3 4 6
</code></pre>

<p>在 <a href="https://docs.perl6.org/routine/Capture">Captute</a> 定义中,</p>

<h3 id="capture-方法-from-mu">Capture 方法(From Mu)</h3>

<p>定义为</p>

<pre><code class="language-perl6">method Capture(Mu:D: --&gt; Capture:D)
</code></pre>

<p>返回与调用者的公共属性相对应的命名参数的 <a href="https://docs.perl6.org/type/Capture">Capture</a>：</p>

<pre><code class="language-perl6">class Foo {
    has $.foo = 42;
    has $.bar = 70;
    method bar { 'something else' }
}.new.Capture.say; # OUTPUT: «\(:bar(&quot;something else&quot;), :foo(42))␤» 
</code></pre>

<h3 id="cpature-方法-from-list">Cpature 方法(from List)</h3>

<p>定义为：</p>

<pre><code class="language-perl6">method Capture(--&gt; Capture:D)
</code></pre>

<p>返回一个 <a href="https://docs.perl6.org/type/Capture">Capture</a>，其中列表中的每个 <a href="https://docs.perl6.org/type/Pair">Pair</a>（如果有）已转换为命名参数（使用Pair string的键）。列表中的所有其他元素按照它们被发现的顺序转换为位置参数，即列表中的第一个非 pair item 成为第一个位置参数，其获得索引 0，第二个非 pair item 成为第二个位置参数，索引为 1 等。</p>

<pre><code class="language-perl6">my $list = (7, 5, a =&gt; 2, b =&gt; 17);
my $capture = $list.Capture;
say $capture.keys;                                # OUTPUT: «(0 1 a b)␤» 
my-sub(|$capture);                                # RESULT: «7, 5, 2, 17» 
 
sub my-sub($first, $second, :$a, :$b) {
    say &quot;$first, $second, $a, $b&quot;
}
</code></pre>

<p>一个更高级的例子是所返回的 <code>Capture</code> 与 <a href="https://docs.perl6.org/type/Signature">签名</a> 进行智能匹配。</p>

<pre><code class="language-perl6">my $list = (7, 5, a =&gt; 2, b =&gt; 17);
say so $list.Capture ~~ :($ where * == 7,$,:$a,:$b); # OUTPUT: «True␤» 
 
$list = (8, 5, a =&gt; 2, b =&gt; 17);
say so $list.Capture ~~ :($ where * == 7,$,:$a,:$b); # OUTPUT: «False␤» 
</code></pre>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>ohmysummer ❤ Perl 6</p>
    
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
