<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="ohmysummer">
    <meta name="description" content="ohmysummer&#39;s personal website">
    <meta name="keywords" content="Perl6,Rakudo">

    <base href="http://ohmysummer.github.io/">
    <title>
  第七天 – Test All The Things · 焉知非鱼
</title>

    <link rel="canonical" href="http://ohmysummer.github.io/post/2017-12-07-%E7%AC%AC%E4%B8%83%E5%A4%A9test-all-the-things/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="/css/coder.min.cd087ace86754b082dec94545567f8361cba42e84f8e15edbc4a9f6e52bd1f6a.css" integrity="sha256-zQh6zoZ1Swgt7JRUVWf4Nhy6QuhPjhXtvEqfblK9H2o=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="http://ohmysummer.github.io/css/style.css">
    

    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://ohmysummer.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.49" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://ohmysummer.github.io/">
      焉知非鱼
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/post">博客</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/categories">归档</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/page/about/">关于</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/tags">标签</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1>第七天 – Test All The Things</h1>
    </header>

    

<p><a href="https://perl6advent.wordpress.com/2017/12/07/day-7-test-all-the-things/">https://perl6advent.wordpress.com/2017/12/07/day-7-test-all-the-things/</a></p>

<p>Perl 6 与其大姐姐 Perl 5一样，具有很悠久的测试传统。当您安装任何 Perl 模块时，安装程​​序通常会运行该模块的测试套件。当然，作为新兴的 Perl 6 模块作者，您需要创建自己的测试套件。或者，也许你会在创建模块<strong>之前</strong>勇于创建测试套件。这实际上有几个好处，其中最主要的是你的第一个用户，甚至在它被写之前。</p>

<p>但在实际代码之前，我想提一下我经常使用的两个 shell 别名 -</p>

<pre><code class="language-shell">alias 6='perl6 -Ilib'
alias 6p=&quot;prove -e'perl6 -Ilib'&quot;
</code></pre>

<p>这些别名使我可以快速运行测试文件，而不必去安装我的代码。如果我在项目目录中，我可以运行</p>

<pre><code class="language-shell">$ 6 t/01-core.t
ok 1 - call with number
ok 2 - call with text
ok 3 - call with formatted string
1..3
</code></pre>

<p>它会告诉我我运行了哪些测试以及它们是否全部通过。就像它的大姐姐Perl 5一样，Perl 6使用&rsquo;t /&lsquo;目录作为测试文件，并按照惯例使用后缀&rsquo;.t&rsquo;来区分测试文件和软件包或脚本。它还有一个内置的单元测试模块，我们在上面使用。如果我们正在测试sprintf（）内部，它可能看起来像</p>

<pre><code class="language-perl6">use Test;

ok sprintf(1), 'call with number';
ok sprintf(&quot;text&quot;), 'call with text';
ok sprintf(&quot;%d&quot;,1), 'call with formatted string';

done-testing;
</code></pre>

<p>ok和done-testing功能会自动导出给我们。我在这里使用规范的Perl 6风格，而不是太依赖括号。在这种情况下，我确实需要使用圆括号来确保sprintf（）不会“认为”“空调用”是它的参数。</p>

<p>OK只需要两个参数，你想要测试的真实性，以及一个可选的消息。如果第一个参数是任何评估为True的东西，则测试通过。否则&hellip;&hellip;你知道。该消息只是描述测试的文本。它纯粹是可选的，但当测试失败时它可以很方便，因为您可以在测试文件中搜索该字符串并快速找到问题。不过，如果你像作者一样，行号更有价值，所以当你看到的时候</p>

<pre><code class="language-perl6">not ok 1 - call with number
# Failed test 'call with number'
# at test.t line 4
ok 2 - call with text
ok 3 - call with formatted string
1..3
</code></pre>

<p>在您的测试中，您可以立即跳转到测试文件的第4行并开始编辑以找出问题所在。当你的测试文件变得越来越大时，这会变得更有用，例如我正在编写的Common Lisp版本（格式）的测试，每个测试文件超过200个测试并且不断增长。</p>

<p>最后，完成测试只是告诉测试模块我们已经完成了测试，没有更多的测试来了。当你刚刚开始时，这很方便，你不断尝试你的API，添加和更新测试。没有测试计数器来更新每次或任何其他机制来跟踪。</p>

<p>当然，这是可选的，但其他工具可能会在最后使用&rsquo;1..3&rsquo;来证明您的测试实际上已经完成。 Jenkins的单元测试和其他系统也可能需要这个工具。</p>

<h2 id="it-depends">It depends…</h2>

<p>你对&rsquo;是&rsquo;的定义是什么。如果你只关心某件事情的真实性，好的测试是好的，但有时你需要深入一点。 Perl 6就像它的大姐姐一样可以帮助你。</p>

<pre><code class="language-perl6">is 1 + 1, 2, 'prop. 54.43, Principia Mathematica';
</code></pre>

<p>不只是检查你的测试的真实性，它会检查它的价值。虽然你可以很容易地写这个</p>

<pre><code>ok 1 + 1 == 2, 'prop. 54.43, Principia Mathematica';
</code></pre>

<p>使用是使你的意图明确，你关注的是表达式1 + 1是否等于2;与同一语句的ok版本一样，目前还不清楚您是在测试&rsquo;1 + 1&rsquo;部分还是&rsquo;==&lsquo;运算符。</p>

<p>这两个测试本身可能占据您测试需求的80％，处理基本列表和哈希时相对安全，如果您真的需要复杂的测试，那么它的大姐姐正在站在脚边，准备处理复杂的哈希阵列组合。</p>

<h2 id="懒惰和不耐烦">懒惰和不耐烦</h2>

<p>有时你会有一个巨大的字符串，你只需要检查一下它。</p>

<pre><code>ok 'Lake Char­gogg­a­gogg­man­chaugg­a­gogg­chau­bun­a­gung­a­maugg' ~~ 'manchau', 'my side';
</code></pre>

<p>你当然可以在这里使用~~运算符。就像&rsquo;1 + 1 == 2&rsquo;一样，但是你的意图可能并不明确。你可以使用类似的方法来明确你的意图。</p>

<pre><code>like 'Lake Char­gogg­a­gogg­man­chaugg­a­gogg­chau­bun­a­gung­a­maugg',
     /manchau/, 'my side';
</code></pre>

<p>并没有~~悬在你的船边。</p>

<h2 id="晾干">晾干</h2>

<p>在美丽的Lake Chargoggagoggmanchauggagoggchaubunagungamaugg度过一段时间后，你可能想把你的衣服拧干。测试文件往往会增长，特别是回归测试。你可能会发现自己写作</p>

<pre><code>is sprintf( &quot;%s&quot;, '1' ), '1', &quot;%s formats numbers&quot;;
is sprintf( &quot;%s&quot;, '⅑' ), '⅑', &quot;%s formats fractions&quot;;
is sprintf( &quot;%s&quot;, 'Ⅷ' ), 'Ⅷ', &quot;%s formats graphemes&quot;;
is sprintf( &quot;%s&quot;, '三' ), '三', &quot;%s formats CJKV&quot;;
</code></pre>

<p>这很好，复制和粘贴（特别是从StackOverflow）是一个悠久的传统，没有错。不过考虑一下，当你使用“％d”而不是“％s”添加更多测试时会发生什么情况，并且由于所有这些字符串都是数字，因此您只需复制并粘贴该块，将“％s”更改为“％d”，然后继续。</p>

<pre><code>is sprintf( &quot;%s&quot;, '1' ), '1', &quot;%s formats numbers';
# ...

is sprintf( &quot;%d, '1' ), '1', &quot;%d formats numbers';
# ...
</code></pre>

<p>所以现在你已经有了两组测试，名称相同。而不是编辑所有新的“％d”测试，如果我们不必首先重复自己的话，这会不会很好？</p>

<pre><code class="language-perl6">subtest '%s', {
    is sprintf( &quot;%s&quot;, '1' ), '1', &quot;formats numbers&quot;;
    is sprintf( &quot;%s&quot;, '⅑' ), '⅑', &quot;formats fractions&quot;;
    is sprintf( &quot;%s&quot;, 'Ⅷ' ), 'Ⅷ', &quot;formats graphemes&quot;;
    is sprintf( &quot;%s&quot;, '三' ), '三', &quot;formats CJKV&quot;;
};
</code></pre>

<p>现在你只需要在两个地方而不是三个地方进行编辑。如果这激发了您对测试的兴趣，我鼓励您在我的个人网站上查看<a href="http://theperlfisher.blogspot.cz/2017/11/test-all-things.html">测试所有事情</a>以获得更高级的测试范例和更高级的 Perl 6 代码。另外不要忘记关注明天的 Perl 6 Advent 发布！</p>

<p>谢谢你，快乐的黑客！</p>

<p>DrForr 又名 Jeff Goff，<a href="http://theperlfisher.blogspot.cz/">Perl Fisher</a></p>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    
      <p>ohmysummer ❤ Perl 6</p>
    
    
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
